<!doctype html>
<head><meta charset="utf-8"><meta property="og:image" content="https://tc39.es/ecmarkup/ecma-logo.png"><meta property="og:title" content="JavaScript Structs"><meta property="og:description" content="Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives
  We extend the JS language with fixed-layout objects both for unshared and shared uses, unsafe blocks to syntactically limit the scope of where racy accesses may be performed, and high-level synchronization primitive APIs. Th">
<title>JavaScript Structs</title><script src="ecmarkup.js?cache=OBMrWeVs" defer=""></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><link rel="stylesheet" href="ecmarkup.css"><link rel="stylesheet" href="print.css" media="print"><style>
    @media print {
      @page :left {
        @bottom-right {
          content: '© Ecma International 2024';
        }
      }
      @page :right {
        @bottom-left {
          content: '© Ecma International 2024';
        }
      }
      @page :first {
        @bottom-left {
          content: '';
        }
        @bottom-right {
          content: '';
        }
      }
      @page :blank {
        @bottom-left {
          content: '';
        }
        @bottom-right {
          content: '';
        }
      }
    }
    </style></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
  <li><span>Toggle pinning of the current clause</span><code>p</code></li>
  <li><span>Jump to <i>n</i>th pin</span><code>1-9</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120" width="54" height="54">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer" class="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins<button class="unpin-all">clear</button></div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#intro" title="Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives">Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives</a></li><li><span class="item-toggle">+</span><a href="#sec-structs" title="Structs"><span class="secnum">1</span> Structs</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-structs-syntax-and-eval" title="Syntax"><span class="secnum">1.1</span> Syntax</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-early-errors" title="Static Semantics: Early Errors"><span class="secnum">1.1.1</span> SS: Early Errors</a></li><li><span class="item-toggle-none"></span><a href="#sec-definestructfield" title="DefineStructField ( receiver, fieldRecord )"><span class="secnum">1.1.2</span> DefineStructField ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-initializestructinstancefieldsandbrands" title="InitializeStructInstanceFieldsAndBrand ( receiver, constructor )"><span class="secnum">1.1.3</span> InitializeStructInstanceFieldsAndBrand ( <var>receiver</var>, <var>constructor</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runfieldinitializer" title="RunFieldInitializer ( receiver, fieldRecord )"><span class="secnum">1.1.4</span> RunFieldInitializer ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runstructinstancefieldinitializers" title="RunStructInstanceFieldInitializers ( receiver, constructor )"><span class="secnum">1.1.5</span> RunStructInstanceFieldInitializers ( <var>receiver</var>, <var>constructor</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-structdefinitionevaluation" title="Runtime Semantics: StructDefinitionEvaluation"><span class="secnum">1.1.6</span> RS: StructDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" title="Runtime Semantics: BindingStructDeclarationEvaluation"><span class="secnum">1.1.7</span> RS: BindingStructDeclarationEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.1.8</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-struct-method-exotic-objects" title="Struct Method Exotic Objects"><span class="secnum">1.2</span> Struct Method Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist" title="[[Call]] ( thisArgument, argumentsList )"><span class="secnum">1.2.1</span> <var class="field">[[Call]]</var> ( <var>thisArgument</var>, <var>argumentsList</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-structmethodcreate" title="StructMethodCreate ( targetMethod )"><span class="secnum">1.2.2</span> StructMethodCreate ( <var>targetMethod</var> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#changes-to-language-expressions" title="Changes to ECMAScript Language: Expressions"><span class="secnum">1.3</span> Changes to ECMAScript Language: Expressions</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-super-keyword-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.3.1</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">+</span><a href="#changes-to-language-functions-and-classes" title="Changes to ECMAScript Language: Functions and Classes"><span class="secnum">1.4</span> Changes to ECMAScript Language: Functions and Classes</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-definemethod" title="Runtime Semantics: DefineMethod"><span class="secnum">1.4.1</span> RS: DefineMethod</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-modules" title="Changes to Modules"><span class="secnum">1.5</span> Changes to Modules</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-exports-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">1.5.1</span> RS: Evaluation</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-shared-structs" title="Shared Structs"><span class="secnum">2</span> Shared Structs</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-shared-struct-exotic-objects" title="Shared Struct Exotic Objects"><span class="secnum">2.1</span> Shared Struct Exotic Objects</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-fictional-criticalsection" title="Critical Section for Shared Struct Creation"><span class="secnum">2.1.1</span> Critical Section for Shared Struct Creation</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-entersharedstructcreationcriticalsection" title="EnterSharedStructCreationCriticalSection ( )"><span class="secnum">2.1.1.1</span> EnterSharedStructCreationCriticalSection ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-leavesharedstructcreationcriticalsection" title="LeaveSharedStructCreationCriticalSection ( )"><span class="secnum">2.1.1.2</span> LeaveSharedStructCreationCriticalSection ( )</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-sharedstructcreate" title="SharedStructCreate ( initializer [ , internalSlotsList ] )"><span class="secnum">2.1.2</span> SharedStructCreate ( <var>initializer</var> [ , <var>internalSlotsList</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-readsharedstructfield" title="ReadSharedStructField ( struct, field, order )"><span class="secnum">2.1.3</span> ReadSharedStructField ( <var>struct</var>, <var>field</var>, <var>order</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-writesharedstructfield" title="WriteSharedStructField ( struct, field, value, order )"><span class="secnum">2.1.4</span> WriteSharedStructField ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>order</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-getownproperty" title="[[GetOwnProperty]] ( P )"><span class="secnum">2.1.5</span> <var class="field">[[GetOwnProperty]]</var> ( <var>P</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-defineownproperty" title="[[DefineOwnProperty]] ( P, Desc )"><span class="secnum">2.1.6</span> <var class="field">[[DefineOwnProperty]]</var> ( <var>P</var>, <var>Desc</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-hasproperty" title="[[HasProperty]] ( P )"><span class="secnum">2.1.7</span> <var class="field">[[HasProperty]]</var> ( <var>P</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-get" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">2.1.8</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <var>unsafe</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-set" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">2.1.9</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <var>unsafe</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-delete" title="[[Delete]] ( P )"><span class="secnum">2.1.10</span> <var class="field">[[Delete]]</var> ( <var>P</var> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-shared-structs-syntax-and-eval" title="Syntax"><span class="secnum">2.2</span> Syntax</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier" title="Static Semantics: ContainsInstancePrivateIdentifier"><span class="secnum">2.2.1</span> SS: ContainsInstancePrivateIdentifier</a></li><li><span class="item-toggle-none"></span><a href="#sec-struct-definitions-static-semantics-containsinstancemethod" title="Static Semantics: ContainsInstanceMethod"><span class="secnum">2.2.2</span> SS: ContainsInstanceMethod</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-definitions-static-semantics-early-errors" title="Static Semantics: Early Errors"><span class="secnum">2.2.3</span> SS: Early Errors</a></li><li><span class="item-toggle-none"></span><a href="#sec-canbesharedacrossagents" title="CanBeSharedAcrossAgents ( val )"><span class="secnum">2.2.4</span> CanBeSharedAcrossAgents ( <var>val</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-definesharedstructfield" title="DefineSharedStructField ( receiver, fieldRecord )"><span class="secnum">2.2.5</span> DefineSharedStructField ( <var>receiver</var>, <var>fieldRecord</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" title="Runtime Semantics: SharedStructDefinitionEvaluation"><span class="secnum">2.2.6</span> RS: SharedStructDefinitionEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-runtime-semantics-bindingsharedstructdeclarationevaluation" title="Runtime Semantics: BindingStructDeclarationEvaluation"><span class="secnum">2.2.7</span> RS: BindingStructDeclarationEvaluation</a></li><li><span class="item-toggle-none"></span><a href="#sec-shared-struct-definitions-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">2.2.8</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-atomics-object" title="Changes to the Atomics Object"><span class="secnum">2.3</span> Changes to the Atomics Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomiccompareexchangeinsharedstruct" title="AtomicCompareExchangeInSharedStruct ( struct, field, expectedValue, replacementValue )"><span class="secnum">2.3.1</span> AtomicCompareExchangeInSharedStruct ( <var>struct</var>, <var>field</var>, <var>expectedValue</var>, <var>replacementValue</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomicreadmodifywriteinsharedstruct" title="AtomicReadModifyWriteInSharedStruct ( struct, field, value, op )"><span class="secnum">2.3.2</span> AtomicReadModifyWriteInSharedStruct ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>op</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.compareexchange-struct" title="Atomics.compareExchange ( typedArraytypedArrayOrStruct, indexindexOrField, expectedValue, replacementValue )"><span class="secnum">2.3.3</span> Atomics.compareExchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>expectedValue</var>, <var>replacementValue</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.exchange-struct" title="Atomics.exchange ( typedArraytypedArrayOrStruct, indexindexOrField, value )"><span class="secnum">2.3.4</span> Atomics.exchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.load-struct" title="Atomics.load ( typedArraytypedArrayOrStruct, indexindexOrField )"><span class="secnum">2.3.5</span> Atomics.load ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.store-struct" title="Atomics.store ( typedArraytypedArrayOrStruct, indexindexOrField, value )"><span class="secnum">2.3.6</span> Atomics.store ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-the-reflect-object-shared-structs" title="Changes to the Reflect Object"><span class="secnum">2.4</span> Changes to the Reflect Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-reflect.canBeShared" title="Reflect.canBeShared ( val )"><span class="secnum">2.4.1</span> Reflect.canBeShared ( <var>val</var> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-memory-model" title="Changes to the Memory Model"><span class="secnum">2.5</span> Changes to the Memory Model</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-memory-model-fundamentals" title="Memory Model Fundamentals"><span class="secnum">2.5.1</span> Memory Model Fundamentals</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-shared-arrays" title="Shared Array Object"><span class="secnum">3</span> Shared Array Object</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-shared-array-constructor" title="The SharedArray Constructor"><span class="secnum">3.1</span> The SharedArray Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-sharedarraycreate" title="SharedArrayCreate ( length )"><span class="secnum">3.1.1</span> SharedArrayCreate ( <var>length</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-sharedarray" title="SharedArray ( ...values )"><span class="secnum">3.1.2</span> SharedArray ( ...<var>values</var> )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-unsafe-block" title="The unsafe Block"><span class="secnum">4</span> The <code>unsafe</code> Block</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-isunsafe" title="Static Semantics: IsUnsafe ( node )"><span class="secnum">4.1</span> SS: IsUnsafe ( <var>node</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-unsafe-block-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">4.2</span> RS: Evaluation</a></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-reference-records" title="Changes to Reference Records"><span class="secnum">4.3</span> Changes to Reference Records</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-reference-record-specification-type" title="The Reference Record Specification Type"><span class="secnum">4.3.1</span> The Reference Record Specification Type</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-getvalue" title="GetValue ( V )"><span class="secnum">4.3.1.1</span> GetValue ( <var>V</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-putvalue" title="PutValue ( V, W )"><span class="secnum">4.3.1.2</span> PutValue ( <var>V</var>, <var>W</var> )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-the-object-type" title="Changes to the Object Type"><span class="secnum">4.4</span> Changes to the Object Type</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-object-internal-methods-and-internal-slots" title="Object Internal Methods and Internal Slots"><span class="secnum">4.4.1</span> Object Internal Methods and Internal Slots</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-ordinary-and-exotic-objects-behaviours" title="Changes to Ordinary and Exotic Objects Behaviours"><span class="secnum">4.5</span> Changes to Ordinary and Exotic Objects Behaviours</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-ordinary-object-internal-methods-and-internal-slots" title="Ordinary Object Internal Methods and Internal Slots"><span class="secnum">4.5.1</span> Ordinary Object Internal Methods and Internal Slots</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-ordinary-object-internal-methods-and-internal-slots-get-p-receiver" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">4.5.1.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-ordinaryget" title="OrdinaryGet ( O, P, Receiver, unsafe )"><span class="secnum">4.5.1.1.1</span> OrdinaryGet ( <var>O</var>, <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-ordinary-object-internal-methods-and-internal-slots-set-p-v-receiver" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">4.5.1.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-ordinaryset" title="OrdinarySet ( O, P, V, Receiver, unsafe )"><span class="secnum">4.5.1.2.1</span> OrdinarySet ( <var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-ordinarysetwithowndescriptor" title="OrdinarySetWithOwnDescriptor ( O, P, V, Receiver, ownDesc, unsafe )"><span class="secnum">4.5.1.2.2</span> OrdinarySetWithOwnDescriptor ( <var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>, <var>ownDesc</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-built-in-exotic-object-internal-methods-and-slots" title="Built-in Exotic Object Internal Methods and Slots"><span class="secnum">4.5.2</span> Built-in Exotic Object Internal Methods and Slots</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-arguments-exotic-objects" title="Arguments Exotic Objects"><span class="secnum">4.5.2.1</span> Arguments Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-arguments-exotic-objects-get-p-receiver" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">4.5.2.1.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-arguments-exotic-objects-set-p-v-receiver" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">4.5.2.1.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-typedarray-exotic-objects" title="TypedArray Exotic Objects"><span class="secnum">4.5.2.2</span> TypedArray Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-typedarray-get" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">4.5.2.2.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-typedarray-set" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">4.5.2.2.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-module-namespace-exotic-objects" title="Module Namespace Exotic Objects"><span class="secnum">4.5.2.3</span> Module Namespace Exotic Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-module-namespace-exotic-objects-get-p-receiver" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">4.5.2.3.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-module-namespace-exotic-objects-set-p-v-receiver" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">4.5.2.3.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-proxy-object-internal-methods-and-internal-slots" title="Proxy Object Internal Methods and Internal Slots"><span class="secnum">4.5.3</span> Proxy Object Internal Methods and Internal Slots</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-proxy-object-internal-methods-and-internal-slots-get-p-receiver" title="[[Get]] ( P, Receiver, unsafe )"><span class="secnum">4.5.3.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-proxy-object-internal-methods-and-internal-slots-set-p-v-receiver" title="[[Set]] ( P, V, Receiver, unsafe )"><span class="secnum">4.5.3.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-changes-to-ecmascript-language-expressions" title="Changes to Expressions"><span class="secnum">4.6</span> Changes to Expressions</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-left-hand-side-expressions" title="Left-Hand-Side Expressions"><span class="secnum">4.6.1</span> Left-Hand-Side Expressions</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-property-accessors" title="Property Accessors"><span class="secnum">4.6.1.1</span> Property Accessors</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-property-accessors-runtime-semantics-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">4.6.1.1.1</span> RS: Evaluation</a></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-evaluate-property-access-with-expression-key" title="EvaluatePropertyAccessWithExpressionKey ( baseValue, expression, strict, unsafe )"><span class="secnum">4.6.1.2</span> EvaluatePropertyAccessWithExpressionKey ( <var>baseValue</var>, <var>expression</var>, <var>strict</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-evaluate-property-access-with-identifier-key" title="EvaluatePropertyAccessWithIdentifierKey ( baseValue, identifierName, strict, unsafe )"><span class="secnum">4.6.1.3</span> EvaluatePropertyAccessWithIdentifierKey ( <var>baseValue</var>, <var>identifierName</var>, <var>strict</var>, <ins><var>unsafe</var></ins> )</a></li><li><span class="item-toggle">+</span><a href="#sec-optional-chains" title="Optional Chains"><span class="secnum">4.6.1.4</span> Optional Chains</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-optional-chaining-evaluation" title="Runtime Semantics: Evaluation"><span class="secnum">4.6.1.4.1</span> RS: Evaluation</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-optional-chaining-chain-evaluation" title="Runtime Semantics: ChainEvaluation"><span class="secnum">4.6.1.4.1.1</span> RS: ChainEvaluation</a></li></ol></li></ol></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#changes-to-reflection" title="Changes to Reflection"><span class="secnum">4.7</span> Changes to Reflection</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-reflect-object" title="The Reflect Object"><span class="secnum">4.7.1</span> The Reflect Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-reflect.get" title="Reflect.get ( target, propertyKey [ , receiver ] )"><span class="secnum">4.7.1.1</span> Reflect.get ( <var>target</var>, <var>propertyKey</var> [ , <var>receiver</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-reflect.set" title="Reflect.set ( target, propertyKey, V [ , receiver ] )"><span class="secnum">4.7.1.2</span> Reflect.set ( <var>target</var>, <var>propertyKey</var>, <var>V</var> [ , <var>receiver</var> ] )</a></li></ol></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-synchronization-primitives" title="Synchronization Primitives"><span class="secnum">5</span> Synchronization Primitives</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-abstract-operations-for-mutex" title="Abstract Operations for Mutex Objects"><span class="secnum">5.1</span> Abstract Operations for Mutex Objects</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-unlocktokencreateifneeded" title="UnlockTokenCreateIfNeeded ( token, mutex )"><span class="secnum">5.1.1</span> UnlockTokenCreateIfNeeded ( <var>token</var>, <var>mutex</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-lockmutex" title="LockMutex ( mutex, tMillis )"><span class="secnum">5.1.2</span> LockMutex ( <var>mutex</var>, <var>tMillis</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-unlockmutex" title="UnlockMutex ( mutex )"><span class="secnum">5.1.3</span> UnlockMutex ( <var>mutex</var> )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-mutex-object" title="The Mutex Constructor"><span class="secnum">5.2</span> The Mutex Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex" title="Atomics.Mutex ( )"><span class="secnum">5.2.1</span> Atomics.Mutex ( )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-properties-of-the-mutex-constructor" title="Properties of the Mutex Constructor"><span class="secnum">5.3</span> Properties of the Mutex Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.unlocktoken-prop" title="Atomics.Mutex.UnlockToken ( )"><span class="secnum">5.3.1</span> Atomics.Mutex.UnlockToken ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.lock" title="Atomics.Mutex.lock ( mutex [ , unlockToken ] )"><span class="secnum">5.3.2</span> Atomics.Mutex.lock ( <var>mutex</var> [ , <var>unlockToken</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.lockifavailable" title="Atomics.Mutex.lockIfAvailable ( mutex, timeout [ , unlockToken ] )"><span class="secnum">5.3.3</span> Atomics.Mutex.lockIfAvailable ( <var>mutex</var>, <var>timeout</var> [ , <var>unlockToken</var> ] )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-unlocktoken-objects" title="UnlockToken Objects"><span class="secnum">5.4</span> UnlockToken Objects</a><ol class="toc"><li><span class="item-toggle">+</span><a href="#sec-unlocktoken-constructor" title="The UnlockToken Constructor"><span class="secnum">5.4.1</span> The UnlockToken Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.unlocktoken" title="Atomics.Mutex.UnlockToken ( )"><span class="secnum">5.4.1.1</span> Atomics.Mutex.UnlockToken ( )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-properties-of-the-unlocktoken-constructor" title="Properties of the UnlockToken Constructor"><span class="secnum">5.4.2</span> Properties of the UnlockToken Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.unlocktoken.prototype" title="Atomics.Mutex.UnlockToken.prototype"><span class="secnum">5.4.2.1</span> Atomics.Mutex.UnlockToken.prototype</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-properties-of-the-unlocktoken-prototype" title="Properties of the UnlockToken Prototype Object"><span class="secnum">5.4.3</span> Properties of the UnlockToken Prototype Object</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-get-atomics.mutex.unlocktoken.prototype.locked" title="get Atomics.Mutex.UnlockToken.prototype.locked"><span class="secnum">5.4.3.1</span> get Atomics.Mutex.UnlockToken.prototype.locked</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.unlocktoken.prototype.unlock" title="Atomics.Mutex.UnlockToken.prototype.unlock ( )"><span class="secnum">5.4.3.2</span> Atomics.Mutex.UnlockToken.prototype.unlock ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.mutex.unlocktoken.prototype.%symbol.dispose%" title="Atomics.Mutex.UnlockToken.prototype [ %Symbol.dispose% ] ( )"><span class="secnum">5.4.3.3</span> Atomics.Mutex.UnlockToken.prototype [ %Symbol.dispose% ] ( )</a></li></ol></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-condition-object" title="The Condition Constructor"><span class="secnum">5.5</span> The Condition Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.condition" title="Atomics.Condition ( )"><span class="secnum">5.5.1</span> Atomics.Condition ( )</a></li></ol></li><li><span class="item-toggle">+</span><a href="#sec-properties-of-the-condition-constructor" title="Properties of the Condition Constructor"><span class="secnum">5.6</span> Properties of the Condition Constructor</a><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-atomics.condition.wait" title="Atomics.Condition.wait ( cv, mutexUnlockToken )"><span class="secnum">5.6.1</span> Atomics.Condition.wait ( <var>cv</var>, <var>mutexUnlockToken</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.condition.waitFor" title="Atomics.Condition.waitFor ( cv, mutexUnlockToken, timeout [ , predicate ] )"><span class="secnum">5.6.2</span> Atomics.Condition.waitFor ( <var>cv</var>, <var>mutexUnlockToken</var>, <var>timeout</var> [ , <var>predicate</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-atomics.condition.notify" title="Atomics.Condition.notify ( cv [ , count ] )"><span class="secnum">5.6.3</span> Atomics.Condition.notify ( <var>cv</var> [ , <var>count</var> ] )</a></li></ol></li></ol></li><li><span class="item-toggle-none"></span><a href="#sec-copyright-and-software-license" title="Copyright &amp; Software License"><span class="secnum">A</span> Copyright &amp; Software License</a></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 2 Draft / November 14, 2024</h1><h1 class="title">JavaScript Structs</h1>

<emu-intro id="intro">
  <h1>Structs, Shared Structs, Unsafe Blocks, and Synchronization Primitives</h1>
  <p>We extend the JS language with fixed-layout objects both for unshared and shared uses, unsafe blocks to syntactically limit the scope of where racy accesses may be performed, and high-level synchronization primitive APIs. This spec draft is organized by logical feature.</p>
</emu-intro>

<emu-clause id="sec-structs">
  <h1><span class="secnum">1</span> Structs</h1>
  <p>Structs are fixed-layout objects. They are constructed with the integrity level <emu-const>sealed</emu-const>, and have all declared fields initialized before the instance is made available to user code. They may only extend other structs. Their instance methods are non-generic, and throw <emu-val>TypeError</emu-val> exceptions when the <emu-val>this</emu-val> value is not either an instance of the struct declaration within which the method was declared, or a subclass of that struct declaration.</p>

  <emu-clause id="sec-structs-syntax-and-eval">
    <h1><span class="secnum">1.1</span> Syntax</h1>

    <ins class="block">
    <emu-grammar type="definition"><emu-production name="StructDeclaration" params="Yield, Await, Default">
    <emu-nt params="Yield, Await, Default"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[Yield, Await, Default]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="gllzxqf2" id="prod-e2ZCr45r">
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_210"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="2blgvvy1" constraints="+Default" id="prod-sut0XC0z"><emu-constraints>[+Default]</emu-constraints>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" id="_ref_211"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="StructTail" params="Yield, Await" id="prod-StructTail">
    <emu-nt params="Yield, Await"><a href="#prod-StructTail">StructTail</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="kgpn8rwq" id="prod-EyLs88eE">
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt params="?Yield, ?Await" optional="" id="_ref_212"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
<emu-production name="StructBody" params="Yield, Await" id="prod-StructBody">
    <emu-nt params="Yield, Await"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="hi6rf-a8">
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>A struct definition is always <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.es/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>.</p>
    </div></emu-note>

    <emu-clause id="sec-struct-definitions-static-semantics-early-errors">
      <h1><span class="secnum">1.1.1</span> Static Semantics: Early Errors</h1>
      <emu-grammar><emu-production name="StructBody" collapsed="">
    <emu-nt><a href="#prod-StructBody">StructBody</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="1y1dunax"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <ul>
        <li>
          It is a SyntaxError if <emu-xref aoid="PrototypePropertyNameList"><a href="https://tc39.es/ecma262/#sec-static-semantics-prototypepropertynamelist">PrototypePropertyNameList</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains more than one occurrence of <emu-val>"constructor"</emu-val>.
        </li>
        <li>
          It is a Syntax Error if the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains any duplicate entries, unless the name is used once for a getter and once for a setter and in no other entries, and the getter and setter are either both static or both non-static.
        </li>
      </ul>
    </emu-clause>

    <emu-clause id="sec-definestructfield" type="abstract operation" aoid="DefineStructField">
      <h1><span class="secnum">1.1.2</span> DefineStructField ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation DefineStructField takes arguments <var>receiver</var> (an Object) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>fieldName</var> be <var>fieldRecord</var>.<var class="field">[[Name]]</var>.</li><li>If <var>fieldName</var> is a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref>, then<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateFieldAdd"><a href="https://tc39.es/ecma262/#sec-privatefieldadd">PrivateFieldAdd</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <emu-val>undefined</emu-val>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Perform !&nbsp;<emu-xref aoid="DefinePropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-definepropertyorthrow">DefinePropertyOrThrow</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, PropertyDescriptor { <var class="field">[[Value]]</var>: <emu-val>undefined</emu-val>, <var class="field">[[Writable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Configurable]]</var>: <emu-val>false</emu-val>&nbsp;}).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-initializestructinstancefieldsandbrands" type="abstract operation" aoid="InitializeStructInstanceFieldsAndBrand">
      <h1><span class="secnum">1.1.3</span> InitializeStructInstanceFieldsAndBrand ( <var>receiver</var>, <var>constructor</var> )</h1>
      <p>The abstract operation InitializeStructInstanceFieldsAndBrand takes arguments <var>receiver</var> (an Object) and <var>constructor</var> (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>constructor</var>.<var class="field">[[ConstructorKind]]</var> is <emu-const>derived</emu-const>, then<ol><li>Let <var>parent</var> be !&nbsp;<var>constructor</var>.<var class="field">[[GetPrototypeOf]]</var>().</li><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_15"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>receiver</var>, <var>parent</var>).</li></ol></li><li>If <var>constructor</var> has a <var class="field">[[StructBrand]]</var> internal slot, then<ol><li>Prepend <var>constructor</var>.<var class="field">[[StructBrand]]</var> to <var>receiver</var>.<var class="field">[[StructBrands]]</var>.</li><li>NOTE: <emu-xref href="#shared-struct-exotic-object" id="_ref_16"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructors</a></emu-xref> do not have a <var class="field">[[StructBrand]]</var> internal slot because per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes is currently an open design question and are not included in this draft. Without per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, <emu-xref href="#shared-struct-exotic-object" id="_ref_17"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> cannot have methods, and there are no users of <emu-xref href="#shared-struct-exotic-object" id="_ref_18"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> brands.</li></ol></li><li>Let <var>methods</var> be the value of <var>constructor</var>.<var class="field">[[PrivateMethods]]</var>.</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>methods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>receiver</var>, <var>method</var>).</li></ol></li><li>Let <var>fields</var> be the value of <var>constructor</var>.<var class="field">[[Fields]]</var>.</li><li>For each element <var>fieldRecord</var> of <var>fields</var>, do<ol><li>Perform <emu-xref aoid="DefineStructField" id="_ref_19"><a href="#sec-definestructfield">DefineStructField</a></emu-xref>(<var>receiver</var>, <var>fieldRecord</var>).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runfieldinitializer" type="abstract operation" aoid="RunFieldInitializer">
      <h1><span class="secnum">1.1.4</span> RunFieldInitializer ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation RunFieldInitializer takes arguments <var>receiver</var> (an Object) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>fieldName</var> be <var>fieldRecord</var>.<var class="field">[[Name]]</var>.</li><li>Let <var>initializer</var> be <var>fieldRecord</var>.<var class="field">[[Initializer]]</var>.</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Let <var>initValue</var> be ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>receiver</var>).</li><li>If <var>fieldName</var> is a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="PrivateSet"><a href="https://tc39.es/ecma262/#sec-privateset" class="e-user-code">PrivateSet</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <var>initValue</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="DefinePropertyOrThrow"><a href="https://tc39.es/ecma262/#sec-definepropertyorthrow" class="e-user-code">DefinePropertyOrThrow</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, PropertyDescriptor { <var class="field">[[Value]]</var>: <var>initValue</var>, <var class="field">[[Writable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Configurable]]</var>: <emu-val>false</emu-val>&nbsp;}).</li></ol></li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runstructinstancefieldinitializers" type="abstract operation" aoid="RunStructInstanceFieldInitializers">
      <h1><span class="secnum">1.1.5</span> RunStructInstanceFieldInitializers ( <var>receiver</var>, <var>constructor</var> )</h1>
      <p>The abstract operation RunStructInstanceFieldInitializers takes arguments <var>receiver</var> (an Object) and <var>constructor</var> (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>constructor</var>.<var class="field">[[ConstructorKind]]</var> is <emu-const>derived</emu-const>, then<ol><li>Let <var>parent</var> be !&nbsp;<var>constructor</var>.<var class="field">[[GetPrototypeOf]]</var>().</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_20"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>receiver</var>, <var>parent</var>).</li></ol></li><li>Let <var>fields</var> be the value of <var>constructor</var>.<var class="field">[[Fields]]</var>.</li><li>For each element <var>fieldRecord</var> of <var>fields</var>, do<ol><li>Perform ?&nbsp;<emu-xref aoid="RunFieldInitializer" id="_ref_21"><a href="#sec-runfieldinitializer" class="e-user-code">RunFieldInitializer</a></emu-xref>(<var>receiver</var>, <var>fieldRecord</var>).</li></ol></li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-structdefinitionevaluation" type="sdo" aoid="StructDefinitionEvaluation">
      <h1><span class="secnum">1.1.6</span> Runtime Semantics: StructDefinitionEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> StructDefinitionEvaluation takes arguments <var>structBinding</var> (a String or <emu-val>undefined</emu-val>) and <var>structName</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="StructTail" collapsed="">
    <emu-nt><a href="#prod-StructTail">StructTail</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="cktgtla1" id="prod-COgM9bSC">
        <emu-nt optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt optional="" id="_ref_213"><a href="#prod-StructBody">StructBody</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>env</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>structEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>env</var>).</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.CreateImmutableBinding(<var>structBinding</var>, <emu-val>true</emu-val>).</li></ol></li><li>Let <var>outerPrivateEnvironment</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>Let <var>classPrivateEnvironment</var> be <emu-xref aoid="NewPrivateEnvironment"><a href="https://tc39.es/ecma262/#sec-newprivateenvironment">NewPrivateEnvironment</a></emu-xref>(<var>outerPrivateEnvironment</var>).</li><li>If <emu-nt id="_ref_214"><a href="#prod-StructBody">StructBody</a></emu-nt> is present, then<ol><li>For each String <var>dn</var> of the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt id="_ref_215"><a href="#prod-StructBody">StructBody</a></emu-nt>, do<ol><li>If <var>classPrivateEnvironment</var>.<var class="field">[[Names]]</var> contains a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> <var>pn</var> such that <var>pn</var>.<var class="field">[[Description]]</var> is <var>dn</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: This is only possible for getter/setter pairs.</li></ol></li><li>Else,<ol><li>Let <var>name</var> be a new <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> whose <var class="field">[[Description]]</var> is <var>dn</var>.</li><li>Append <var>name</var> to <var>classPrivateEnvironment</var>.<var class="field">[[Names]]</var>.</li></ol></li></ol></li></ol></li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is not present, then<ol><li>Let <var>protoParent</var> be <emu-xref href="#sec-properties-of-the-object-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-object-prototype-object">%Object.prototype%</a></emu-xref>.</li><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else,<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>NOTE: The <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment is <var>outerPrivateEnvironment</var> when evaluating <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>.</li><li>Let <var>superclassRef</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>).</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Let <var>superclass</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_22"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(? <var>superclassRef</var>).</li><li>If <var>superclass</var> is <emu-val>null</emu-val>, then<ol><li>Let <var>protoParent</var> be <emu-val>null</emu-val>.</li><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else if <var>superclass</var> does not have a <var class="field">[[IsStructConstructor]]</var> internal slot, then<ol><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Else,<ol><li>Let <var>protoParent</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p" class="e-user-code">Get</a></emu-xref>(<var>superclass</var>, <emu-val>"prototype"</emu-val>).</li><li>If <var>protoParent</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref> and <var>protoParent</var> is not <emu-val>null</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>constructorParent</var> be <var>superclass</var>.</li></ol></li></ol></li><li>Let <var>proto</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<var>protoParent</var>, « <var class="field">[[StructBrand]]</var>&nbsp;»).</li><li>Let <var>structSerial</var> be the value of GlobalStructSerial.</li><li>Set <var>proto</var>.<var class="field">[[StructBrand]]</var> to <var>structSerial</var>.</li><li>Set GlobalStructSerial to GlobalStructSerial + 1.</li><li>NOTE: GlobalStructSerial is a monotonically increasing <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> that is globally available. It is shared by all <emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">realms</a></emu-xref>. Prior to the evaluation of any ECMAScript code, it is initialized to 0.</li><li>NOTE: Structs have one-shot construction, with the user-defined "<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>" method performing post-construction initialization. By the time ECMAScript code has access to a struct instance, it already has all of its declared fields as own properties.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>classPrivateEnvironment</var>.</li><li>If <emu-nt id="_ref_216"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>initializerParseNode</var> be <emu-const>empty</emu-const>.</li><li>Else, let <var>initializerParseNode</var> be <emu-xref aoid="ConstructorMethod"><a href="https://tc39.es/ecma262/#sec-static-semantics-constructormethod">ConstructorMethod</a></emu-xref> of <emu-nt id="_ref_217"><a href="#prod-StructBody">StructBody</a></emu-nt>.</li><li>If <var>initializerParseNode</var> is <emu-const>empty</emu-const>, then<ol><li>Let <var>initializer</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>initializerInfo</var> be ?&nbsp;<emu-xref aoid="DefineMethod" id="_ref_23"><a href="#sec-runtime-semantics-definemethod" class="e-user-code">DefineMethod</a></emu-xref> of <var>initializerParseNode</var> with arguments <var>proto</var> and <var>constructorParent</var>.</li><li>Let <var>initializer</var> be <var>initializerInfo</var>.<var class="field">[[Closure]]</var>.</li><li>Perform <emu-xref aoid="SetFunctionName"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>initializer</var>, <var>structName</var>).</li></ol></li><li>Let <var>constructor</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>initializer</var> and <var>structSerial</var> and performs the following steps when called:<ol><li>Let <var>args</var> be the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of arguments that was passed to this function by <var class="field">[[Call]]</var> or <var class="field">[[Construct]]</var>.</li><li>Let <var>F</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>If NewTarget is not <var>F</var>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="OrdinaryCreateFromConstructor"><a href="https://tc39.es/ecma262/#sec-ordinarycreatefromconstructor" class="e-user-code">OrdinaryCreateFromConstructor</a></emu-xref>(NewTarget, <emu-val>"%Object.prototype%"</emu-val>, « <var class="field">[[StructBrands]]</var>&nbsp;»).</li><li>Set <var>result</var>.<var class="field">[[StructBrands]]</var> to « <var>structSerial</var>&nbsp;».</li><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_24"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>Perform !&nbsp;<var>result</var>.<var class="field">[[PreventExtensions]]</var>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>result</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_25"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>result</var>).</li></ol></li><li>Return <var>result</var>.</li></ol></li><li>Let <var>F</var> be <emu-xref aoid="CreateBuiltinFunction"><a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>constructor</var>, 0, structName, « <var class="field">[[ConstructorKind]]</var>, <var class="field">[[SourceText]]</var>, <var class="field">[[StructBrand]]</var>, <var class="field">[[StructInitializer]]</var>, <var class="field">[[IsStructConstructor]]</var>&nbsp;», <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>, <var>constructorParent</var>).</li><li>Perform <emu-xref aoid="MakeConstructor"><a href="https://tc39.es/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>, <emu-val>false</emu-val>, <var>proto</var>).</li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is present, set <var>F</var>.<var class="field">[[ConstructorKind]]</var> to <emu-const>derived</emu-const>.</li><li>Set <var>F</var>.<var class="field">[[StructInitializer]]</var> to <var>initializer</var>.</li><li>Set <var>F</var>.<var class="field">[[StructBrand]]</var> to <var>structSerial</var>.</li><li>Set <var>F</var>.<var class="field">[[IsStructConstructor]]</var> to <emu-val>true</emu-val>.</li><li>If <emu-nt id="_ref_218"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>elements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Else, let <var>elements</var> be <emu-xref aoid="NonConstructorElements"><a href="https://tc39.es/ecma262/#sec-static-semantics-nonconstructorelements">NonConstructorElements</a></emu-xref> of <emu-nt id="_ref_219"><a href="#prod-StructBody">StructBody</a></emu-nt>.</li><li>Let <var>instancePrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticPrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>instanceFields</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticElements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <var>e</var> of <var>elements</var>, do<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>proto</var>).</li></ol></li><li>Else,<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>F</var>).</li></ol></li><li>If <var>element</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>element</var>.</li></ol></li><li>Set <var>element</var> to !&nbsp;<var>element</var>.</li><li>If <var>element</var> is a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.<var class="field">[[Kind]]</var> is either <emu-const>method</emu-const> or <emu-const>accessor</emu-const>.</li><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, let <var>container</var> be <var>instancePrivateMethods</var>.</li><li>Else, let <var>container</var> be <var>staticPrivateMethods</var>.</li><li>If <var>container</var> contains a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>pe</var> such that <var>pe</var>.<var class="field">[[Key]]</var> is <var>element</var>.<var class="field">[[Key]]</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.<var class="field">[[Kind]]</var> and <var>pe</var>.<var class="field">[[Kind]]</var> are both <emu-const>accessor</emu-const>.</li><li>If <var>element</var>.<var class="field">[[Get]]</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { <var class="field">[[Key]]</var>: <var>element</var>.<var class="field">[[Key]]</var>, <var class="field">[[Kind]]</var>: <emu-const>accessor</emu-const>, <var class="field">[[Get]]</var>: <var>pe</var>.<var class="field">[[Get]]</var>, <var class="field">[[Set]]</var>: <var>element</var>.<var class="field">[[Set]]</var>&nbsp;}.</li></ol></li><li>Else,<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { <var class="field">[[Key]]</var>: <var>element</var>.<var class="field">[[Key]]</var>, <var class="field">[[Kind]]</var>: <emu-const>accessor</emu-const>, <var class="field">[[Get]]</var>: <var>element</var>.<var class="field">[[Get]]</var>, <var class="field">[[Set]]</var>: <var>pe</var>.<var class="field">[[Set]]</var>&nbsp;}.</li></ol></li><li>Replace <var>pe</var> in <var>container</var> with <var>combined</var>.</li></ol></li><li>Else,<ol><li>Append <var>element</var> to <var>container</var>.</li></ol></li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, append <var>element</var> to <var>instanceFields</var>.</li><li>Else, append <var>element</var> to <var>staticElements</var>.</li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>, then<ol><li>Append <var>element</var> to <var>staticElements</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.InitializeBinding(<var>structBinding</var>, <var>F</var>).</li></ol></li><li>Set <var>F</var>.<var class="field">[[PrivateMethods]]</var> to <var>instancePrivateMethods</var>.</li><li>Set <var>F</var>.<var class="field">[[Fields]]</var> to <var>instanceFields</var>.</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>staticPrivateMethods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>F</var>, <var>method</var>).</li></ol></li><li>For each element <var>elementRecord</var> of <var>staticElements</var>, do<ol><li>If <var>elementRecord</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="DefineField"><a href="https://tc39.es/ecma262/#sec-definefield" class="e-user-code">DefineField</a></emu-xref>(<var>F</var>, <var>elementRecord</var>)).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>elementRecord</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>elementRecord</var>.<var class="field">[[BodyFunction]]</var>, <var>F</var>)).</li></ol></li><li>If <var>result</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>result</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Perform !&nbsp;<emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>proto</var>, <emu-const>sealed</emu-const>).</li><li>Return <var>F</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-bindingstructdeclarationevaluation" type="sdo" aoid="BindingStructDeclarationEvaluation">
      <h1><span class="secnum">1.1.7</span> Runtime Semantics: BindingStructDeclarationEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> BindingStructDeclarationEvaluation takes no arguments and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="7oevws9p" id="prod-s2PPFPsU">
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_220"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_26"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_221"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.<var class="field">[[SourceText]]</var> to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_222"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<var>structName</var>, <var>value</var>, <var>env</var>).</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="ybqt6rv-" id="prod-3t_ysv4H">
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_223"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="StructDefinitionEvaluation" id="_ref_27"><a href="#sec-runtime-semantics-structdefinitionevaluation" class="e-user-code">StructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_224"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>"default"</emu-val>.</li><li>Set <var>value</var>.<var class="field">[[SourceText]]</var> to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_225"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-struct-definitions-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.1.8</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="7oevws9p" id="prod-CJdKR16y">
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_226"><a href="#prod-StructTail">StructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_28"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of this <emu-nt id="_ref_227"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-struct-method-exotic-objects">
    <h1><span class="secnum">1.2</span> Struct Method Exotic Objects</h1>
    <ins class="block">

    <p>A <emu-xref href="#struct-method-exotic-object" id="_ref_29"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> is an <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref> that wraps another method. A <emu-xref href="#struct-method-exotic-object" id="_ref_30"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> is callable (it has a <var class="field">[[Call]]</var> internal method). Calling a <emu-xref href="#struct-method-exotic-object" id="_ref_31"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> checks if the <emu-val>this</emu-val> value is a struct instance constructed by the same struct declaration that defined the method, then in calls its wrapped method.</p>

    <p>An object is a <dfn id="struct-method-exotic-object" variants="struct method exotic objects" tabindex="-1">struct method exotic object</dfn> if its <var class="field">[[Call]]</var> internal method uses the following implementation, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots" id="_ref_0"><a href="#sec-ordinary-object-internal-methods-and-internal-slots">4.5.1</a></emu-xref>. These methods are installed in <emu-xref aoid="StructMethodCreate" id="_ref_32"><a href="#sec-structmethodcreate">StructMethodCreate</a></emu-xref>.</p>

    <p><emu-xref href="#struct-method-exotic-object" id="_ref_33"><a href="#struct-method-exotic-object">Struct method exotic objects</a></emu-xref> do not have the internal slots of ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function objects</a></emu-xref> listed in <emu-xref href="#table-internal-slots-of-ecmascript-function-objects"><a href="https://tc39.es/ecma262/#table-internal-slots-of-ecmascript-function-objects">Table 30</a></emu-xref>. Instead they have the internal slots listed in <emu-xref href="#table-internal-slots-of-struct-method-exotic-objects" id="_ref_1"><a href="#table-internal-slots-of-struct-method-exotic-objects">Table 1</a></emu-xref>, in addition to <var class="field">[[Prototype]]</var> and <var class="field">[[Extensible]]</var>.</p>
    <emu-table id="table-internal-slots-of-struct-method-exotic-objects" caption="Internal Slots of Struct Method Exotic Objects"><figure><figcaption>Table 1: Internal Slots of Struct Method Exotic Objects</figcaption>
      <table>
        <thead>
          <tr>
            <th>
              Internal Slot
            </th>
            <th>
              Type
            </th>
            <th>
              Description
            </th>
          </tr>
        </thead>
        <tbody><tr>
          <td>
            <var class="field">[[BoundTargetMethod]]</var>
          </td>
          <td>
            a callable Object
          </td>
          <td>
            The wrapped method object.
          </td>
        </tr>
      </tbody></table>
    </figure></emu-table>

    <emu-clause id="sec-struct-method-exotic-objects-call-thisargument-argumentslist" type="internal method">
      <h1><span class="secnum">1.2.1</span> <var class="field">[[Call]]</var> ( <var>thisArgument</var>, <var>argumentsList</var> )</h1>
      <p>The <var class="field">[[Call]]</var> internal method of a <emu-xref href="#struct-method-exotic-object" id="_ref_34"><a href="#struct-method-exotic-object">struct method exotic object</a></emu-xref> <var>F</var> takes arguments <var>thisArgument</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>argumentsList</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language values</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>target</var> be <var>F</var>.<var class="field">[[BoundTargetMethod]]</var>.</li><li>Let <var>homeObject</var> be <var>target</var>.<var class="field">[[HomeObject]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>homeObject</var> is not <emu-val>undefined</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>homeObject</var> has a <var class="field">[[StructBrand]]</var> internal slot.</li><li>If <var>thisArgument</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>thisArgument</var> does not have a <var class="field">[[StructBrands]]</var> internal slot, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>thisArgument</var>.<var class="field">[[StructBrands]]</var> does not contain <var>homeObject</var>.<var class="field">[[StructBrand]]</var>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>target</var>, <var>thisArgument</var>, <var>argumentsList</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-structmethodcreate" type="abstract operation" aoid="StructMethodCreate">
      <h1><span class="secnum">1.2.2</span> StructMethodCreate ( <var>targetMethod</var> )</h1>
      <p>The abstract operation StructMethodCreate takes argument <var>targetMethod</var> (a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It is used to specify the creation of new <emu-xref href="#struct-method-exotic-object" id="_ref_35"><a href="#struct-method-exotic-object">struct method exotic objects</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>proto</var> be ?&nbsp;<span class="e-user-code"><var>targetMethod</var>.<var class="field">[[GetPrototypeOf]]</var></span>().</li><li>Let <var>internalSlotsList</var> be the <emu-xref href="#list-concatenation"><a href="https://tc39.es/ecma262/#list-concatenation">list-concatenation</a></emu-xref> of « <var class="field">[[Prototype]]</var>, <var class="field">[[Extensible]]</var>&nbsp;» and the internal slots listed in <emu-xref href="#table-internal-slots-of-struct-method-exotic-objects" id="_ref_2"><a href="#table-internal-slots-of-struct-method-exotic-objects">Table 1</a></emu-xref>.</li><li>Let <var>obj</var> be <emu-xref aoid="MakeBasicObject"><a href="https://tc39.es/ecma262/#sec-makebasicobject">MakeBasicObject</a></emu-xref>(<var>internalSlotsList</var>).</li><li>Set <var>obj</var>.<var class="field">[[Prototype]]</var> to <var>proto</var>.</li><li>Set <var>obj</var>.<var class="field">[[Call]]</var> as described in <emu-xref href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist" id="_ref_3"><a href="#sec-struct-method-exotic-objects-call-thisargument-argumentslist">1.2.1</a></emu-xref>.</li><li>Set <var>obj</var>.<var class="field">[[BoundTargetMethod]]</var> to <var>targetMethod</var>.</li><li>Return <var>obj</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="changes-to-language-expressions">
    <h1><span class="secnum">1.3</span> Changes to ECMAScript Language: Expressions</h1>
    <emu-clause id="sec-super-keyword-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.3.1</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="SuperCall" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-SuperCall">SuperCall</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="qdmdlzzo">
        <emu-t>super</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
        <emu-alg><ol><li>Let <var>newTarget</var> be <emu-xref aoid="GetNewTarget"><a href="https://tc39.es/ecma262/#sec-getnewtarget">GetNewTarget</a></emu-xref>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>newTarget</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>Let <var>func</var> be <emu-xref aoid="GetSuperConstructor"><a href="https://tc39.es/ecma262/#sec-getsuperconstructor">GetSuperConstructor</a></emu-xref>().</li><li>Let <var>argList</var> be ?&nbsp;<emu-xref aoid="ArgumentListEvaluation"><a href="https://tc39.es/ecma262/#sec-runtime-semantics-argumentlistevaluation" class="e-user-code">ArgumentListEvaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>.</li><li>If <emu-xref aoid="IsConstructor"><a href="https://tc39.es/ecma262/#sec-isconstructor">IsConstructor</a></emu-xref>(<var>func</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li><ins>If <var>func</var> has a <var class="field">[[StructInitializer]]</var> internal slot, then</ins><ol><li><ins>If <var>func</var>.<var class="field">[[StructInitializer]]</var> is not <emu-const>empty</emu-const>, then</ins><ol><li><ins>Let <var>envRec</var> be <emu-xref aoid="GetThisEnvironment"><a href="https://tc39.es/ecma262/#sec-getthisenvironment">GetThisEnvironment</a></emu-xref>().</ins></li><li><ins>Let <var>thisValue</var> be <var>envRec</var>.GetThisBinding().</ins></li><li><ins>Return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>func</var>.<var class="field">[[StructInitializer]]</var>, <var>thisValue</var>).</ins></li></ol></li><li><ins>Else,</ins><ol><li><ins>Return <emu-val>undefined</emu-val>.</ins></li></ol></li></ol></li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="Construct"><a href="https://tc39.es/ecma262/#sec-construct" class="e-user-code">Construct</a></emu-xref>(<var>func</var>, <var>argList</var>, <var>newTarget</var>).</li><li>Let <var>thisER</var> be <emu-xref aoid="GetThisEnvironment"><a href="https://tc39.es/ecma262/#sec-getthisenvironment">GetThisEnvironment</a></emu-xref>().</li><li>Perform ?&nbsp;<var>thisER</var>.BindThisValue(<var>result</var>).</li><li>Let <var>F</var> be <var>thisER</var>.<var class="field">[[FunctionObject]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>F</var> is an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeInstanceElements"><a href="https://tc39.es/ecma262/#sec-initializeinstanceelements" class="e-user-code">InitializeInstanceElements</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>Return <var>result</var>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="changes-to-language-functions-and-classes">
    <h1><span class="secnum">1.4</span> Changes to ECMAScript Language: Functions and Classes</h1>
    <emu-clause id="sec-runtime-semantics-definemethod" type="sdo" aoid="DefineMethod">
      <h1><span class="secnum">1.4.1</span> Runtime Semantics: DefineMethod</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> DefineMethod takes argument <var>object</var> (an Object) and optional argument <var>functionPrototype</var> (an Object) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> with fields <var class="field">[[Key]]</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and <var class="field">[[Closure]]</var> (an ECMAScript <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref>) or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="MethodDefinition" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="f2ayx1_q">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementName">ClassElementName</a></emu-nt>
        <emu-t>(</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>
        <emu-t>)</emu-t>
        <emu-t>{</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>propKey</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementName">ClassElementName</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Let <var>privateEnv</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>If <var>functionPrototype</var> is present, then<ol><li>Let <var>prototype</var> be <var>functionPrototype</var>.</li></ol></li><li>Else,<ol><li>Let <var>prototype</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Let <var>sourceText</var> be the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>.</li><li>Let <var>closure</var> be <emu-xref aoid="OrdinaryFunctionCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryfunctioncreate">OrdinaryFunctionCreate</a></emu-xref>(<var>prototype</var>, <var>sourceText</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-UniqueFormalParameters">UniqueFormalParameters</a></emu-nt>, <emu-nt><a href="https://tc39.es/ecma262/#prod-FunctionBody">FunctionBody</a></emu-nt>, <emu-const>non-lexical-this</emu-const>, <var>env</var>, <var>privateEnv</var>).</li><li>Perform <emu-xref aoid="MakeMethod"><a href="https://tc39.es/ecma262/#sec-makemethod">MakeMethod</a></emu-xref>(<var>closure</var>, <var>object</var>).</li><li><ins>If <var>object</var> has a <var class="field">[[StructBrand]]</var> internal slot, then</ins><ol><li><ins>NOTE: Struct instance methods' home object have a <var class="field">[[StructBrand]]</var> internal slot.</ins></li><li><ins>Set <var>closure</var> to ?&nbsp;<emu-xref aoid="StructMethodCreate" id="_ref_36"><a href="#sec-structmethodcreate" class="e-user-code">StructMethodCreate</a></emu-xref>(<var>closure</var>).</ins></li></ol></li><li>Return the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref> { <var class="field">[[Key]]</var>: <var>propKey</var>, <var class="field">[[Closure]]</var>: <var>closure</var>&nbsp;}.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-modules">
    <h1><span class="secnum">1.5</span> Changes to Modules</h1>

    <emu-grammar type="definition"><emu-production name="ExportDeclaration" id="prod-ExportDeclaration">
    <emu-nt><a href="#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="4kqfdugp">
        <emu-t>export</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ExportFromClause">ExportFromClause</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FromClause">FromClause</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="j2lh_kda">
        <emu-t>export</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-NamedExports">NamedExports</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="rudz_osj">
        <emu-t>export</emu-t>
        <emu-nt params="~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-VariableStatement">VariableStatement</a><emu-mods><emu-params>[~Yield, +Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="cshvsnoo">
        <emu-t>export</emu-t>
        <emu-nt params="~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-Declaration">Declaration</a><emu-mods><emu-params>[~Yield, +Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="pkwjy2r6">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default"><a href="https://tc39.es/ecma262/#prod-HoistableDeclaration">HoistableDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="hf5nsghg">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default"><a href="https://tc39.es/ecma262/#prod-ClassDeclaration">ClassDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <ins><emu-rhs a="f-1gjiqg">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt params="~Yield, +Await, +Default" id="_ref_228"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[~Yield, +Await, +Default]</emu-params></emu-mods></emu-nt>
    </emu-rhs></ins>
    <emu-rhs a="33r7jf_e">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-gann>[lookahead ∉ { <emu-t>function</emu-t>, <emu-t>async</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>function</emu-t>, <emu-t>class</emu-t> }]</emu-gann>
        <emu-nt params="+In, ~Yield, +Await"><a href="https://tc39.es/ecma262/#prod-AssignmentExpression">AssignmentExpression</a><emu-mods><emu-params>[+In, ~Yield, +Await]</emu-params></emu-mods></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>

    <emu-clause id="sec-exports-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">1.5.1</span> Runtime Semantics: Evaluation</h1>
      <ins class="block">
      <emu-grammar><emu-production name="ExportDeclaration" collapsed="">
    <emu-nt><a href="#prod-ExportDeclaration">ExportDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="i25bct0k">
        <emu-t>export</emu-t>
        <emu-t>default</emu-t>
        <emu-nt id="_ref_229"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_37"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of <emu-nt id="_ref_230"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>structName</var> be the sole element of the <emu-xref aoid="BoundNames"><a href="https://tc39.es/ecma262/#sec-static-semantics-boundnames">BoundNames</a></emu-xref> of <emu-nt id="_ref_231"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>If <var>structName</var> is <emu-val>"*default*"</emu-val>, then<ol><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<emu-val>"*default*"</emu-val>, <var>value</var>, <var>env</var>).</li></ol></li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
      </ins>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-shared-structs">
  <h1><span class="secnum">2</span> Shared Structs</h1>

  <emu-clause id="sec-shared-struct-exotic-objects">
    <h1><span class="secnum">2.1</span> Shared Struct Exotic Objects</h1>
    <ins class="block">
    <p><emu-xref href="#shared-struct-exotic-object" id="_ref_38"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> are fixed-layout <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic objects</a></emu-xref> that can be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref> and be accessed in parallel from multiple <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. They are like structs with more restricted behaviour so as to be possible to be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. They cannot contain methods or private fields. Their fields can only hold primitives or other shared values. Accessing their fields is unordered by default and is governed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref>. Such accesses can be made sequentially consistent by using newly overloaded Atomics methods.</p>
    <p>An object is a <dfn id="shared-struct-exotic-object" variants="Shared Structs" tabindex="-1">Shared Struct</dfn> if its <var class="field">[[GetOwnProperty]]</var>, <var class="field">[[DefineOwnProperty]]</var>, <var class="field">[[HasProperty]]</var>, <var class="field">[[Get]]</var>, <var class="field">[[Set]]</var>, and <var class="field">[[Delete]]</var> internal methods use the definitions in this section, and its other essential internal methods use the definitions found in <emu-xref href="#sec-ordinary-object-internal-methods-and-internal-slots" id="_ref_4"><a href="#sec-ordinary-object-internal-methods-and-internal-slots">4.5.1</a></emu-xref>.</p>

    <emu-clause id="sec-fictional-criticalsection">
      <h1><span class="secnum">2.1.1</span> Critical Section for Shared Struct Creation</h1>

      <emu-clause id="sec-entersharedstructcreationcriticalsection" type="abstract operation" aoid="EnterSharedStructCreationCriticalSection">
        <h1><span class="secnum">2.1.1.1</span> EnterSharedStructCreationCriticalSection ( )</h1>
        <p>The abstract operation EnterSharedStructCreationCriticalSection takes no arguments and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
        <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is not in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_39"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Wait until no <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_40"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation, then enter the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_41"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation (without allowing any other <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agent</a></emu-xref> to enter).</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-leavesharedstructcreationcriticalsection" type="abstract operation" aoid="LeaveSharedStructCreationCriticalSection">
        <h1><span class="secnum">2.1.1.2</span> LeaveSharedStructCreationCriticalSection ( )</h1>
        <p>The abstract operation LeaveSharedStructCreationCriticalSection takes no arguments and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
        <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_42"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Leave the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_43"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
      </emu-clause>

      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>This <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> is a specification semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to prohibit the nondeterministic read in <emu-xref aoid="ReadSharedStructField" id="_ref_44"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref> from manifesting <emu-xref href="#shared-struct-exotic-object" id="_ref_45"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> values that are partially initialized.</p>
        <p>This <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> does not provide any ordering guarantees.</p>
        <p>In implementations, this <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> is not needed. Implementations must not allow out-of-thin-air reads.</p>
      </div></emu-note>
    </emu-clause>

    <emu-clause id="sec-sharedstructcreate" type="abstract operation" aoid="SharedStructCreate">
      <h1><span class="secnum">2.1.2</span> SharedStructCreate ( <var>initializer</var> [ , <var>internalSlotsList</var> ] )</h1>
      <p>The abstract operation SharedStructCreate takes argument <var>initializer</var> (an <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with one parameter) and optional argument <var>internalSlotsList</var> (a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of internal slot names) and returns a <emu-xref href="#shared-struct-exotic-object" id="_ref_46"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>internalSlotsList</var> is not present, set <var>internalSlotsList</var> to a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_47"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>result</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-val>null</emu-val>, <var>internalSlotsList</var>).</li><li>Set <var>result</var>.<var class="field">[[GetOwnProperty]]</var> as specified in <emu-xref href="#sec-shared-struct-getownproperty" id="_ref_5"><a href="#sec-shared-struct-getownproperty">2.1.5</a></emu-xref>.</li><li>Set <var>result</var>.<var class="field">[[DefineOwnProperty]]</var> as specified in <emu-xref href="#sec-shared-struct-defineownproperty" id="_ref_6"><a href="#sec-shared-struct-defineownproperty">2.1.6</a></emu-xref>.</li><li>Set <var>result</var>.<var class="field">[[HasProperty]]</var> as specified in <emu-xref href="#sec-shared-struct-hasproperty" id="_ref_7"><a href="#sec-shared-struct-hasproperty">2.1.7</a></emu-xref>.</li><li>Set <var>result</var>.<var class="field">[[Get]]</var> as specified in <emu-xref href="#sec-shared-struct-get" id="_ref_8"><a href="#sec-shared-struct-get">2.1.8</a></emu-xref>.</li><li>Set <var>result</var>.<var class="field">[[Set]]</var> as specified in <emu-xref href="#sec-shared-struct-set" id="_ref_9"><a href="#sec-shared-struct-set">2.1.9</a></emu-xref>.</li><li>Set <var>result</var>.<var class="field">[[Delete]]</var> as specified in <emu-xref href="#sec-shared-struct-delete" id="_ref_10"><a href="#sec-shared-struct-delete">2.1.10</a></emu-xref>.</li><li>Perform <var>initializer</var>(<var>result</var>).</li><li>Perform !&nbsp;<var>result</var>.<var class="field">[[PreventExtensions]]</var>().</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_48"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>result</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Return <var>result</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-readsharedstructfield" type="abstract operation" aoid="ReadSharedStructField">
      <h1><span class="secnum">2.1.3</span> ReadSharedStructField ( <var>struct</var>, <var>field</var>, <var>order</var> )</h1>
      <p>The abstract operation ReadSharedStructField takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_49"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), and <var>order</var> (<emu-const>seq-cst</emu-const> or <emu-const>unordered</emu-const>) and returns an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>execution</var> be the <var class="field">[[CandidateExecution]]</var> field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.<var class="field">[[EventsRecords]]</var> whose <var class="field">[[AgentSignifier]]</var> is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_50"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { <var class="field">[[Struct]]</var>: <var>struct</var>, <var class="field">[[Field]]</var>: <var>field</var>&nbsp;}.</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_51"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_52"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_53"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>Let <var>readEvent</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_54"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> { <var class="field">[[Order]]</var>: <var>order</var>, <var class="field">[[NoTear]]</var>: <emu-val>true</emu-val>, <var class="field">[[Storage]]</var>: <var>storage</var>&nbsp;} to <var>eventsRecord</var>.<var class="field">[[EventList]]</var>.</li><li>Append <var>readEvent</var> to <var>eventsRecord</var>.<var class="field">[[EventList]]</var>.</li><li>NOTE: Shared struct field accesses can never tear.</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { <var class="field">[[Event]]</var>: <var>readEvent</var>, <var class="field">[[ChosenValue]]</var>: <var>rawLanguageValue</var>&nbsp;} to <var>execution</var>.<var class="field">[[ChosenValues]]</var>.</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-writesharedstructfield" type="abstract operation" aoid="WriteSharedStructField">
      <h1><span class="secnum">2.1.4</span> WriteSharedStructField ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>order</var> )</h1>
      <p>The abstract operation WriteSharedStructField takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_55"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>value</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>order</var> (<emu-const>seq-cst</emu-const>, <emu-const>unordered</emu-const>, or <emu-const>init</emu-const>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_56"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>true</emu-val>.</li><li>Let <var>execution</var> be the <var class="field">[[CandidateExecution]]</var> field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.<var class="field">[[EventsRecords]]</var> whose <var class="field">[[AgentSignifier]]</var> is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_57"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { <var class="field">[[Struct]]</var>: <var>struct</var>, <var class="field">[[Field]]</var>: <var>field</var>&nbsp;}.</li><li>Append <emu-xref href="#sec-memory-model-fundamentals" id="_ref_58"><a href="#sec-memory-model-fundamentals">WriteSharedMemory</a></emu-xref> { <var class="field">[[Order]]</var>: <var>order</var>, <var class="field">[[NoTear]]</var>: <emu-val>true</emu-val>, <var class="field">[[Storage]]</var>: <var>storage</var>, <var class="field">[[Payload]]</var>: <var>value</var>&nbsp;} to <var>eventsRecord</var>.<var class="field">[[EventList]]</var>.</li><li>NOTE: Shared struct field accesses can never tear.</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-getownproperty" type="internal method">
      <h1><span class="secnum">2.1.5</span> <var class="field">[[GetOwnProperty]]</var> ( <var>P</var> )</h1>
      <p>The <var class="field">[[GetOwnProperty]]</var> internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_59"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> either a <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref> or <emu-val>undefined</emu-val>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>undefined</emu-val>.</li><li>Let <var>D</var> be a newly created <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref> with no fields.</li><li>Let <var>X</var> be <var>O</var>'s own property whose key is <var>P</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>X</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref>.</li><li>Set <var>D</var>.<var class="field">[[Value]]</var> to <emu-xref aoid="ReadSharedStructField" id="_ref_60"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref>(<var>O</var>, <var>P</var>, <emu-const>unordered</emu-const>).</li><li>Set <var>D</var>.<var class="field">[[Writable]]</var> to <emu-val>false</emu-val>.</li><li>Set <var>D</var>.<var class="field">[[Enumerable]]</var> to <emu-val>true</emu-val>.</li><li>Set <var>D</var>.<var class="field">[[Configurable]]</var> to <emu-val>false</emu-val>.</li><li>Return <var>D</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-defineownproperty" type="internal method">
      <h1><span class="secnum">2.1.6</span> <var class="field">[[DefineOwnProperty]]</var> ( <var>P</var>, <var>Desc</var> )</h1>
      <p>The <var class="field">[[DefineOwnProperty]]</var> internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_61"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and <var>Desc</var> (a <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: !&nbsp;<emu-xref aoid="TestIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-testintegritylevel">TestIntegrityLevel</a></emu-xref>(<var>O</var>, <emu-const>sealed</emu-const>) is <emu-val>true</emu-val>.</li><li>Let <var>current</var> be !&nbsp;<var>O</var>.<var class="field">[[GetOwnProperty]]</var>(<var>P</var>).</li><li>If <var>current</var> is <emu-val>undefined</emu-val>, return <emu-val>false</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>current</var>) is <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.<var class="field">[[Enumerable]]</var> is <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.<var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>current</var>.<var class="field">[[Writable]]</var> is <emu-val>true</emu-val>.</li><li>If <var>Desc</var> has a <var class="field">[[Enumerable]]</var> field and <var>Desc</var>.<var class="field">[[Enumerable]]</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a <var class="field">[[Configurable]]</var> field and <var>Desc</var>.<var class="field">[[Configurable]]</var> is <emu-val>true</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a <var class="field">[[Writable]]</var> field and <var>Desc</var>.<var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Desc</var> has a <var class="field">[[Value]]</var> field, then<ol><li>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_62"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>Desc</var>.<var class="field">[[Value]]</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_63"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>O</var>, <var>P</var>, <var>Desc</var>.<var class="field">[[Value]]</var>, <emu-const>unordered</emu-const>).</li></ol></li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-hasproperty" type="internal method">
      <h1><span class="secnum">2.1.7</span> <var class="field">[[HasProperty]]</var> ( <var>P</var> )</h1>
      <p>The <var class="field">[[HasProperty]]</var> internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_64"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>false</emu-val>.</li><li>NOTE: <var class="field">[[GetOwnPropertyDescriptor]]</var> is not used to avoid an unnecessary <emu-xref href="#sec-memory-model-fundamentals" id="_ref_65"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> event.</li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-get" type="internal method">
      <h1><span class="secnum">2.1.8</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <var>unsafe</var> )</h1>
      <p>The <var class="field">[[Get]]</var> internal method of a shared Struct <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>unsafe</var> (a Boolean) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-val>undefined</emu-val> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>undefined</emu-val>.</li><li>If <var>unsafe</var> is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>ownDesc</var> be !&nbsp;<var>O</var>.<var class="field">[[GetOwnProperty]]</var>(<var>P</var>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>ownDesc</var> is not <emu-val>undefined</emu-val>.</li><li>Return _ownDesc.<var class="field">[[Value]]</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-set" type="internal method">
      <h1><span class="secnum">2.1.9</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <var>unsafe</var> )</h1>
      <p>The <var class="field">[[Set]]</var> internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_66"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>unsafe</var> (a Boolean) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>O</var> does not have an own property with key <var>P</var>, return <emu-val>false</emu-val>.</li><li>NOTE: <var class="field">[[GetOwnPropertyDescriptor]]</var> is not used to avoid an unnecessary <emu-xref href="#sec-memory-model-fundamentals" id="_ref_67"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> event.</li><li>If <var>unsafe</var> is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>desc</var> be PropertyDescriptor { <var class="field">[[Value]]</var>: <var>V</var>, <var class="field">[[Writable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Configurable]]</var>: <emu-val>false</emu-val>&nbsp;}.</li><li>Return ?&nbsp;<var>O</var>.<var class="field">[[DefineOwnProperty]]</var>(<var>P</var>, <var>desc</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-delete" type="internal method">
      <h1><span class="secnum">2.1.10</span> <var class="field">[[Delete]]</var> ( <var>P</var> )</h1>
      <p>The <var class="field">[[Delete]]</var> internal method of a <emu-xref href="#shared-struct-exotic-object" id="_ref_68"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <var>O</var> takes argument <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-val>false</emu-val>. It performs the following steps when called:</p>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-shared-structs-syntax-and-eval">
    <h1><span class="secnum">2.2</span> Syntax</h1>

    <ins class="block">
    <emu-grammar type="definition"><emu-production name="StructDeclaration" params="Yield, Await, Default" id="prod-StructDeclaration">
    <emu-nt params="Yield, Await, Default"><a href="#prod-StructDeclaration">StructDeclaration</a><emu-mods><emu-params>[Yield, Await, Default]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="m8kl-wsa" id="prod-OXIfDnE4">
        <emu-t>shared</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
        <emu-nt params="?Yield, ?Await" id="_ref_232"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <emu-rhs a="ctiyx4zt" constraints="+Default"><emu-constraints>[+Default]</emu-constraints>
        <emu-t>shared</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-t>struct</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await" id="_ref_233"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
<emu-production name="SharedStructTail" params="Yield, Await" id="prod-SharedStructTail">
    <emu-nt params="Yield, Await"><a href="#prod-SharedStructTail">SharedStructTail</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="gfsakt6f" id="prod-6RgYaWnz">
        <emu-nt params="?Yield, ?Await" optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt params="?Yield, ?Await" optional="" id="_ref_234"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
<emu-production name="SharedStructBody" params="Yield, Await" id="prod-SharedStructBody">
    <emu-nt params="Yield, Await"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-params>[Yield, Await]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="hi6rf-a8">
        <emu-nt params="?Yield, ?Await"><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a><emu-mods><emu-params>[?Yield, ?Await]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>A shared struct definition is always <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.es/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>.</p>
    </div></emu-note>

    <emu-clause id="sec-struct-definitions-static-semantics-containsinstanceprivateidentifier" type="sdo" aoid="ContainsInstancePrivateIdentifier">
      <h1><span class="secnum">2.2.1</span> Static Semantics: ContainsInstancePrivateIdentifier</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> ContainsInstancePrivateIdentifier takes no arguments and returns a Boolean. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="crvluhmw"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_69"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="msulavvt">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_70"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>, return <emu-val>true</emu-val>.</li><li>Return <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_71"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="bwbyf1-5">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt> <emu-xref aoid="Contains"><a href="https://tc39.es/ecma262/#sec-static-semantics-contains">Contains</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="s8ilfl9g"><emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt> <emu-xref aoid="Contains"><a href="https://tc39.es/ecma262/#sec-static-semantics-contains">Contains</a></emu-xref> <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="cpyv1xvc">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="-ljgtrpo">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="2ui-f2qn">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassStaticBlock">ClassStaticBlock</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="sg2sawim">
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-struct-definitions-static-semantics-containsinstancemethod" type="sdo" aoid="ContainsInstanceMethod">
      <h1><span class="secnum">2.2.2</span> Static Semantics: ContainsInstanceMethod</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> ContainsInstanceMethod takes no arguments and returns a Boolean. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="crvluhmw"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-xref aoid="ContainsInstanceMethod" id="_ref_72"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElementList" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="msulavvt">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ContainsInstanceMethod" id="_ref_73"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt>, return <emu-val>true</emu-val>.</li><li>Return <emu-xref aoid="ContainsInstanceMethod" id="_ref_74"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="s8ilfl9g"><emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>If <emu-xref aoid="ClassElementKind"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementkind">ClassElementKind</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> is <emu-const>constructor-method</emu-const>, return <emu-val>false</emu-val>.</li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>

      <emu-grammar><emu-production name="ClassElement">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="bwbyf1-5">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="cpyv1xvc">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-FieldDefinition">FieldDefinition</a></emu-nt>
        <emu-t>;</emu-t>
    </emu-rhs>
    <emu-rhs a="-ljgtrpo">
        <emu-t>static</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MethodDefinition">MethodDefinition</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="2ui-f2qn">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassStaticBlock">ClassStaticBlock</a></emu-nt>
    </emu-rhs>
    <emu-rhs a="sg2sawim">
        <emu-t>;</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-definitions-static-semantics-early-errors">
      <h1><span class="secnum">2.2.3</span> Static Semantics: Early Errors</h1>
      <emu-grammar><emu-production name="SharedStructBody" collapsed="">
    <emu-nt><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="1y1dunax"><emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt></emu-rhs>
</emu-production>
</emu-grammar>
      <ul>
        <li>
          It is a SyntaxError if <emu-xref aoid="PrototypePropertyNameList"><a href="https://tc39.es/ecma262/#sec-static-semantics-prototypepropertynamelist">PrototypePropertyNameList</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> contains more than one occurrence of <emu-val>"constructor"</emu-val>.
        </li>
        <li>
          It is a Syntax Error if <emu-xref aoid="ContainsInstancePrivateIdentifier" id="_ref_75"><a href="#sec-struct-definitions-static-semantics-containsinstanceprivateidentifier">ContainsInstancePrivateIdentifier</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> is <emu-val>true</emu-val>.
        </li>
        <li>
          It is a SyntaxError if <emu-xref aoid="ContainsInstanceMethod" id="_ref_76"><a href="#sec-struct-definitions-static-semantics-containsinstancemethod">ContainsInstanceMethod</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElementList">ClassElementList</a></emu-nt> is <emu-val>true</emu-val>.
        </li>
      </ul>
      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>EDITOR'S NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will allow methods.</p>
      </div></emu-note>
    </emu-clause>

    <emu-clause id="sec-canbesharedacrossagents" type="abstract operation" aoid="CanBeSharedAcrossAgents">
      <h1><span class="secnum">2.2.4</span> CanBeSharedAcrossAgents ( <var>val</var> )</h1>
      <p>The abstract operation CanBeSharedAcrossAgents takes argument <var>val</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns a Boolean.</p>
          <p>Returns whether ECMAScript language language values can be shared across <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>. Primitives can always be shared.</p>
        
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>val</var> is <emu-val>undefined</emu-val>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> is <emu-val>null</emu-val>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is a String</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-boolean-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-boolean-type">is a Boolean</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-number-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-number-type">is a Number</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-bigint-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-bigint-type">is a BigInt</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>If <var>val</var> <emu-xref href="#sec-ecmascript-language-types-symbol-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-symbol-type">is a Symbol</a></emu-xref>, return <emu-val>true</emu-val>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>val</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>If <var>val</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_77"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> <emu-xref href="#exotic-object"><a href="https://tc39.es/ecma262/#exotic-object">exotic object</a></emu-xref>, return <emu-val>true</emu-val>.</li><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-definesharedstructfield" type="abstract operation" aoid="DefineSharedStructField">
      <h1><span class="secnum">2.2.5</span> DefineSharedStructField ( <var>receiver</var>, <var>fieldRecord</var> )</h1>
      <p>The abstract operation DefineSharedStructField takes arguments <var>receiver</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_78"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>) and <var>fieldRecord</var> (a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> is in the <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">critical section</a></emu-xref> for <emu-xref href="#shared-struct-exotic-object" id="_ref_79"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> creation.</li><li>Let <var>fieldName</var> be <var>fieldRecord</var>.<var class="field">[[Name]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>fieldName</var> is a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>.</li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <var>fieldName</var> of object <var>receiver</var> whose <var class="field">[[Value]]</var> is <emu-val>undefined</emu-val>, <var class="field">[[Writable]]</var> is <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var> is <emu-val>true</emu-val>, and <var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_80"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>receiver</var>, <var>fieldName</var>, <emu-val>undefined</emu-val>, <emu-const>init</emu-const>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-sharedstructdefinitionevaluation" type="sdo" aoid="SharedStructDefinitionEvaluation">
      <h1><span class="secnum">2.2.6</span> Runtime Semantics: SharedStructDefinitionEvaluation</h1>
      <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> SharedStructDefinitionEvaluation takes arguments <var>structBinding</var> (a String or <emu-val>undefined</emu-val>) and <var>structName</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#function-object"><a href="https://tc39.es/ecma262/#function-object">function object</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
      <emu-grammar><emu-production name="SharedStructTail" collapsed="">
    <emu-nt><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="rfhztyzb" id="prod-BhzXWGRY">
        <emu-nt optional=""><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>{</emu-t>
        <emu-nt optional="" id="_ref_235"><a href="#prod-SharedStructBody">SharedStructBody</a><emu-mods><emu-opt>opt</emu-opt></emu-mods></emu-nt>
        <emu-t>}</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>env</var> be the LexicalEnvironment of the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>.</li><li>Let <var>structEnv</var> be <emu-xref aoid="NewDeclarativeEnvironment"><a href="https://tc39.es/ecma262/#sec-newdeclarativeenvironment">NewDeclarativeEnvironment</a></emu-xref>(<var>env</var>).</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.CreateImmutableBinding(<var>structBinding</var>, <emu-val>true</emu-val>).</li></ol></li><li>Let <var>outerPrivateEnvironment</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment.</li><li>Let <var>classPrivateEnvironment</var> be <emu-xref aoid="NewPrivateEnvironment"><a href="https://tc39.es/ecma262/#sec-newprivateenvironment">NewPrivateEnvironment</a></emu-xref>(<var>outerPrivateEnvironment</var>).</li><li>If <emu-nt id="_ref_236"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> is present, then<ol><li>For each String <var>dn</var> of the <emu-xref aoid="PrivateBoundIdentifiers"><a href="https://tc39.es/ecma262/#sec-static-semantics-privateboundidentifiers">PrivateBoundIdentifiers</a></emu-xref> of <emu-nt id="_ref_237"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>, do<ol><li>If <var>classPrivateEnvironment</var>.<var class="field">[[Names]]</var> contains a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> <var>pn</var> such that <var>pn</var>.<var class="field">[[Description]]</var> is <var>dn</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: This is only possible for getter/setter pairs.</li></ol></li><li>Else,<ol><li>Let <var>name</var> be a new <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref> whose <var class="field">[[Description]]</var> is <var>dn</var>.</li><li>Append <var>name</var> to <var>classPrivateEnvironment</var>.<var class="field">[[Names]]</var>.</li></ol></li></ol></li></ol></li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is not present, then<ol><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else,<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Let <var>superclassRef</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt>).</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Let <var>superclass</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_81"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(? <var>superclassRef</var>).</li><li>If <var>superclass</var> is <emu-val>null</emu-val>, then<ol><li>Let <var>constructorParent</var> be <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li></ol></li><li>Else if <var>superclass</var> does not have a <var class="field">[[IsSharedStructConstructor]]</var> internal slot, then<ol><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Else,<ol><li>Let <var>constructorParent</var> be <var>superclass</var>.</li></ol></li></ol></li><li>Let <var>proto</var> be <emu-val>null</emu-val>.</li><li>NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will allow prototypes.</li><li>NOTE: <emu-xref href="#shared-struct-exotic-object" id="_ref_82"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> have one-shot construction, with the user-defined "<emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>" method performing post-construction initialization. By the time ECMAScript code has access to a <emu-xref href="#shared-struct-exotic-object" id="_ref_83"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> instance, it already has all of its declared fields as own properties.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>structEnv</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>classPrivateEnvironment</var>.</li><li>If <emu-nt id="_ref_238"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt> is not present, let <var>initializerParseNode</var> be <emu-const>empty</emu-const>.</li><li>Else, let <var>initializerParseNode</var> be <emu-xref aoid="ConstructorMethod"><a href="https://tc39.es/ecma262/#sec-static-semantics-constructormethod">ConstructorMethod</a></emu-xref> of <emu-nt id="_ref_239"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>.</li><li>If <var>initializerParseNode</var> is <emu-const>empty</emu-const>, then<ol><li>Let <var>initializer</var> be <emu-const>empty</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>initializerInfo</var> be ?&nbsp;<emu-xref aoid="DefineMethod" id="_ref_84"><a href="#sec-runtime-semantics-definemethod" class="e-user-code">DefineMethod</a></emu-xref> of <var>initializerParseNode</var> with arguments <var>proto</var> and <var>constructorParent</var>.</li><li>Let <var>initializer</var> be <var>initializerInfo</var>.<var class="field">[[Closure]]</var>.</li><li>Perform <emu-xref aoid="SetFunctionName"><a href="https://tc39.es/ecma262/#sec-setfunctionname">SetFunctionName</a></emu-xref>(<var>initializer</var>, <var>structName</var>).</li></ol></li><li>Let <var>constructor</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with no parameters that captures <var>initializer</var> and performs the following steps when called:<ol><li>Let <var>args</var> be the <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of arguments that was passed to this function by <var class="field">[[Call]]</var> or <var class="field">[[Construct]]</var>.</li><li>Let <var>F</var> be the <emu-xref href="#active-function-object"><a href="https://tc39.es/ecma262/#active-function-object">active function object</a></emu-xref>.</li><li>If NewTarget is not <var>F</var>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>createInitializer</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with parameters (<var>newSharedStruct</var>) that captures <var>F</var> and performs the following steps when called:<ol><li>Perform <emu-xref aoid="InitializeStructInstanceFieldsAndBrand" id="_ref_85"><a href="#sec-initializestructinstancefieldsandbrands">InitializeStructInstanceFieldsAndBrand</a></emu-xref>(<var>newSharedStruct</var>, <var>F</var>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>Let <var>result</var> be <emu-xref aoid="SharedStructCreate" id="_ref_86"><a href="#sec-sharedstructcreate">SharedStructCreate</a></emu-xref>(<var>createInitializer</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="RunStructInstanceFieldInitializers" id="_ref_87"><a href="#sec-runstructinstancefieldinitializers" class="e-user-code">RunStructInstanceFieldInitializers</a></emu-xref>(<var>result</var>, <var>F</var>).</li><li>If <var>initializer</var> is not <emu-const>empty</emu-const>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>initializer</var>, <var>result</var>).</li></ol></li><li>Return <var>result</var>.</li></ol></li><li>Let <var>F</var> be <emu-xref aoid="CreateBuiltinFunction"><a href="https://tc39.es/ecma262/#sec-createbuiltinfunction">CreateBuiltinFunction</a></emu-xref>(<var>constructor</var>, 0, structName, « <var class="field">[[ConstructorKind]]</var>, <var class="field">[[SourceText]]</var>, <var class="field">[[StructInitializer]]</var>, <var class="field">[[IsSharedStructConstructor]]</var>&nbsp;», <emu-xref href="#current-realm"><a href="https://tc39.es/ecma262/#current-realm">the current Realm Record</a></emu-xref>, <var>constructorParent</var>).</li><li>Perform <emu-xref aoid="MakeConstructor"><a href="https://tc39.es/ecma262/#sec-makeconstructor">MakeConstructor</a></emu-xref>(<var>F</var>, <emu-val>false</emu-val>, <var>proto</var>).</li><li>If <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassHeritage">ClassHeritage</a></emu-nt> is present, set <var>F</var>.<var class="field">[[ConstructorKind]]</var> to <emu-const>derived</emu-const>.</li><li>Set <var>F</var>.<var class="field">[[StructInitializer]]</var> to <var>initializer</var>.</li><li>Set <var>F</var>.<var class="field">[[IsSharedStructConstructor]]</var> to <emu-val>true</emu-val>.</li><li>If <emu-nt id="_ref_240"><a href="#prod-StructBody">StructBody</a></emu-nt> is not present, let <var>elements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Else, let <var>elements</var> be <emu-xref aoid="NonConstructorElements"><a href="https://tc39.es/ecma262/#sec-static-semantics-nonconstructorelements">NonConstructorElements</a></emu-xref> of <emu-nt id="_ref_241"><a href="#prod-SharedStructBody">SharedStructBody</a></emu-nt>.</li><li>Let <var>staticPrivateMethods</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>instanceFields</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>Let <var>staticElements</var> be a new empty <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref>.</li><li>For each <emu-nt><a href="https://tc39.es/ecma262/#prod-ClassElement">ClassElement</a></emu-nt> <var>e</var> of <var>elements</var>, do<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, then<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>proto</var>).</li></ol></li><li>Else,<ol><li>Let <var>element</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="ClassElementEvaluation"><a href="https://tc39.es/ecma262/#sec-static-semantics-classelementevaluation" class="e-user-code">ClassElementEvaluation</a></emu-xref> of <var>e</var> with argument <var>F</var>).</li></ol></li><li>If <var>element</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>element</var>.</li></ol></li><li>Set <var>element</var> to !&nbsp;<var>element</var>.</li><li>If <var>element</var> is a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.<var class="field">[[Kind]]</var> is either <emu-const>method</emu-const> or <emu-const>accessor</emu-const>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>true</emu-val>.</li><li>Let <var>container</var> be <var>staticPrivateMethods</var>.</li><li>If <var>container</var> contains a <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>pe</var> such that <var>pe</var>.<var class="field">[[Key]]</var> is <var>element</var>.<var class="field">[[Key]]</var>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>element</var>.<var class="field">[[Kind]]</var> and <var>pe</var>.<var class="field">[[Kind]]</var> are both <emu-const>accessor</emu-const>.</li><li>If <var>element</var>.<var class="field">[[Get]]</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { <var class="field">[[Key]]</var>: <var>element</var>.<var class="field">[[Key]]</var>, <var class="field">[[Kind]]</var>: <emu-const>accessor</emu-const>, <var class="field">[[Get]]</var>: <var>pe</var>.<var class="field">[[Get]]</var>, <var class="field">[[Set]]</var>: <var>element</var>.<var class="field">[[Set]]</var>&nbsp;}.</li></ol></li><li>Else,<ol><li>Let <var>combined</var> be <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> { <var class="field">[[Key]]</var>: <var>element</var>.<var class="field">[[Key]]</var>, <var class="field">[[Kind]]</var>: <emu-const>accessor</emu-const>, <var class="field">[[Get]]</var>: <var>element</var>.<var class="field">[[Get]]</var>, <var class="field">[[Set]]</var>: <var>pe</var>.<var class="field">[[Set]]</var>&nbsp;}.</li></ol></li><li>Replace <var>pe</var> in <var>container</var> with <var>combined</var>.</li></ol></li><li>Else,<ol><li>Append <var>element</var> to <var>container</var>.</li></ol></li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>If <emu-xref aoid="IsStatic"><a href="https://tc39.es/ecma262/#sec-static-semantics-isstatic">IsStatic</a></emu-xref> of <var>e</var> is <emu-val>false</emu-val>, append <var>element</var> to <var>instanceFields</var>.</li><li>Else, append <var>element</var> to <var>staticElements</var>.</li></ol></li><li>Else if <var>element</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>, then<ol><li>Append <var>element</var> to <var>staticElements</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment to <var>env</var>.</li><li>If <var>structBinding</var> is not <emu-val>undefined</emu-val>, then<ol><li>Perform !&nbsp;<var>structEnv</var>.InitializeBinding(<var>structBinding</var>, <var>F</var>).</li></ol></li><li>Set <var>F</var>.<var class="field">[[Fields]]</var> to <var>instanceFields</var>.</li><li>For each <emu-xref href="#sec-privateelement-specification-type"><a href="https://tc39.es/ecma262/#sec-privateelement-specification-type">PrivateElement</a></emu-xref> <var>method</var> of <var>staticPrivateMethods</var>, do<ol><li>Perform !&nbsp;<emu-xref aoid="PrivateMethodOrAccessorAdd"><a href="https://tc39.es/ecma262/#sec-privatemethodoraccessoradd">PrivateMethodOrAccessorAdd</a></emu-xref>(<var>F</var>, <var>method</var>).</li></ol></li><li>For each element <var>elementRecord</var> of <var>staticElements</var>, do<ol><li>If <var>elementRecord</var> is a <emu-xref href="#sec-classfielddefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classfielddefinition-record-specification-type">ClassFieldDefinition Record</a></emu-xref>, then<ol><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="DefineField"><a href="https://tc39.es/ecma262/#sec-definefield" class="e-user-code">DefineField</a></emu-xref>(<var>F</var>, <var>elementRecord</var>)).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>elementRecord</var> is a <emu-xref href="#sec-classstaticblockdefinition-record-specification-type"><a href="https://tc39.es/ecma262/#sec-classstaticblockdefinition-record-specification-type">ClassStaticBlockDefinition Record</a></emu-xref>.</li><li>Let <var>result</var> be <emu-xref aoid="Completion"><a href="https://tc39.es/ecma262/#sec-completion-ao">Completion</a></emu-xref>(<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>elementRecord</var>.<var class="field">[[BodyFunction]]</var>, <var>F</var>)).</li></ol></li><li>If <var>result</var> is an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>, then<ol><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Return ?&nbsp;<var>result</var>.</li></ol></li></ol></li><li>Set the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s PrivateEnvironment to <var>outerPrivateEnvironment</var>.</li><li>Perform !&nbsp;<emu-xref aoid="SetIntegrityLevel"><a href="https://tc39.es/ecma262/#sec-setintegritylevel">SetIntegrityLevel</a></emu-xref>(<var>F</var>, <emu-const>sealed</emu-const>).</li><li>Return <var>F</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-runtime-semantics-bindingsharedstructdeclarationevaluation" type="" sdo"="">
      <h1><span class="secnum">2.2.7</span> Runtime Semantics: BindingStructDeclarationEvaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oovofrol">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_242"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>structName</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>.</li><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_88"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_243"><a href="#prod-StructTail">StructTail</a></emu-nt> with arguments <var>structName</var> and <var>structName</var>.</li><li>Set <var>value</var>.<var class="field">[[SourceText]]</var> to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_244"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Let <var>env</var> be the <emu-xref href="#running-execution-context"><a href="https://tc39.es/ecma262/#running-execution-context">running execution context</a></emu-xref>'s LexicalEnvironment.</li><li>Perform ?&nbsp;<emu-xref aoid="InitializeBoundName"><a href="https://tc39.es/ecma262/#sec-initializeboundname" class="e-user-code">InitializeBoundName</a></emu-xref>(<var>structName</var>, <var>value</var>, <var>env</var>).</li><li>Return <var>value</var>.</li></ol></emu-alg>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oczmzkvc">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt id="_ref_245"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Let <var>value</var> be ?&nbsp;<emu-xref aoid="SharedStructDefinitionEvaluation" id="_ref_89"><a href="#sec-runtime-semantics-sharedstructdefinitionevaluation" class="e-user-code">SharedStructDefinitionEvaluation</a></emu-xref> of <emu-nt id="_ref_246"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt> with arguments <emu-val>undefined</emu-val> and <emu-val>"default"</emu-val>.</li><li>Set <var>value</var>.<var class="field">[[SourceText]]</var> to the <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">source text matched by</a></emu-xref> <emu-nt id="_ref_247"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <var>value</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-shared-struct-definitions-runtime-semantics-evaluation" type="sdo">
      <h1><span class="secnum">2.2.8</span> Runtime Semantics: Evaluation</h1>
      <emu-grammar><emu-production name="StructDeclaration" collapsed="">
    <emu-nt><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="oovofrol" id="prod-a7FVdFNf">
        <emu-t>shared</emu-t>
        <emu-t>struct</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-BindingIdentifier">BindingIdentifier</a></emu-nt>
        <emu-nt id="_ref_248"><a href="#prod-SharedStructTail">SharedStructTail</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="BindingStructDeclarationEvaluation" id="_ref_90"><a href="#sec-runtime-semantics-bindingstructdeclarationevaluation" class="e-user-code">BindingStructDeclarationEvaluation</a></emu-xref> of this <emu-nt id="_ref_249"><a href="#prod-StructDeclaration">StructDeclaration</a></emu-nt>.</li><li>Return <emu-const>empty</emu-const>.</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-changes-to-atomics-object">
    <h1><span class="secnum">2.3</span> Changes to the Atomics Object</h1>

    <ins class="block">
    <emu-clause id="sec-atomiccompareexchangeinsharedstruct" type="abstract operation" aoid="AtomicCompareExchangeInSharedStruct">
      <h1><span class="secnum">2.3.1</span> AtomicCompareExchangeInSharedStruct ( <var>struct</var>, <var>field</var>, <var>expectedValue</var>, <var>replacementValue</var> )</h1>
      <p>The abstract operation AtomicCompareExchangeInSharedStruct takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_91"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>expectedValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>replacementValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_92"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>replacementValue</var>) is <emu-val>true</emu-val>.</li><li>Let <var>execution</var> be the <var class="field">[[CandidateExecution]]</var> field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.<var class="field">[[EventsRecords]]</var> whose <var class="field">[[AgentSignifier]]</var> is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_93"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_94"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_95"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>NOTE: The comparison of the expected value and the read value is performed outside of the <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> to avoid needlessly strong synchronization when the expected value is not equal to the read value.</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_96"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { <var class="field">[[Struct]]</var>: <var>struct</var>, <var class="field">[[Field]]</var>: <var>field</var>&nbsp;}.</li><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>expectedValue</var>, <var>replacementValue</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>second</var> be a new <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> with parameters (<var>oldValue</var>, <var>newValue</var>) that captures nothing and performs the following steps atomically when called:<ol><li>Return <var>newValue</var>.</li></ol></li><li>Let <var>event</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_97"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> { <var class="field">[[Order]]</var>: <emu-const>seq-cst</emu-const>, <var class="field">[[NoTear]]</var>: <emu-val>true</emu-val>, <var class="field">[[Storage]]</var>: <var>storage</var>, <var class="field">[[Payload]]</var>: <var>replacementValue</var>, <var class="field">[[ModifyOp]]</var>: <var>second</var>&nbsp;}.</li></ol></li><li>Else,<ol><li>Let <var>event</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_98"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> { <var class="field">[[Order]]</var>: <emu-const>seq-cst</emu-const>, <var class="field">[[NoTear]]</var>: <emu-val>true</emu-val>, <var class="field">[[Storage]]</var>: <var>storage</var>&nbsp;}.</li></ol></li><li>Append <var>event</var> to <var>eventsRecord</var>.<var class="field">[[EventList]]</var>.</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { <var class="field">[[Event]]</var>: <var>event</var>, <var class="field">[[ChosenValue]]</var>: <var>rawLanguageValue</var>&nbsp;} to <var>execution</var>.<var class="field">[[ChosenValues]]</var>.</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomicreadmodifywriteinsharedstruct" type="abstract operation" aoid="AtomicReadModifyWriteInSharedStruct">
      <h1><span class="secnum">2.3.2</span> AtomicReadModifyWriteInSharedStruct ( <var>struct</var>, <var>field</var>, <var>value</var>, <var>op</var> )</h1>
      <p>The abstract operation AtomicReadModifyWriteInSharedStruct takes arguments <var>struct</var> (a <emu-xref href="#shared-struct-exotic-object" id="_ref_99"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>), <var>field</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>value</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <var>op</var> (a <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>, or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li>If <var>field</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_100"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>struct</var> does not have an own property with key <var>field</var>, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>execution</var> be the <var class="field">[[CandidateExecution]]</var> field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>eventsRecord</var> be the <emu-xref href="#sec-agent-event-records"><a href="https://tc39.es/ecma262/#sec-agent-event-records">Agent Events Record</a></emu-xref> of <var>execution</var>.<var class="field">[[EventsRecords]]</var> whose <var class="field">[[AgentSignifier]]</var> is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Perform <emu-xref aoid="EnterSharedStructCreationCriticalSection" id="_ref_101"><a href="#sec-entersharedstructcreationcriticalsection">EnterSharedStructCreationCriticalSection</a></emu-xref>().</li><li>Let <var>rawLanguageValue</var> be a nondeterministically chosen <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> such that <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_102"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>rawLanguageValue</var>) is <emu-val>true</emu-val>.</li><li>Perform <emu-xref aoid="LeaveSharedStructCreationCriticalSection" id="_ref_103"><a href="#sec-leavesharedstructcreationcriticalsection">LeaveSharedStructCreationCriticalSection</a></emu-xref>().</li><li>NOTE: In implementations, <var>rawLanguageValue</var> is the result of a non-atomic or atomic read instruction on the underlying hardware. The nondeterminism is a semantic prescription of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> to describe observable behaviour of hardware with weak consistency.</li><li>Let <var>storage</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_104"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> { <var class="field">[[Struct]]</var>: <var>struct</var>, <var class="field">[[Field]]</var>: <var>field</var>&nbsp;}.</li><li>Let <var>rmwEvent</var> be <emu-xref href="#sec-memory-model-fundamentals" id="_ref_105"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> { <var class="field">[[Order]]</var>: <emu-const>seq-cst</emu-const>, <var class="field">[[NoTear]]</var>: <emu-val>true</emu-val>, <var class="field">[[Storage]]</var>: <var>storage</var>, <var class="field">[[Payload]]</var>: <var>rawLanguageValue</var>, <var class="field">[[ModifyOp]]</var>: <var>op</var>&nbsp;}.</li><li>Append <var>rmwEvent</var> to <var>eventsRecord</var>.<var class="field">[[EventList]]</var>.</li><li>Append <emu-xref href="#sec-chosen-value-records"><a href="https://tc39.es/ecma262/#sec-chosen-value-records">Chosen Value Record</a></emu-xref> { <var class="field">[[Event]]</var>: <var>rmwEvent</var>, <var class="field">[[ChosenValue]]</var>: <var>rawLanguageValue</var>&nbsp;} to <var>execution</var>.<var class="field">[[ChosenValues]]</var>.</li><li>Return <var>rawLanguageValue</var>.</li></ol></emu-alg>
    </emu-clause>
    </ins>

    <emu-clause id="sec-atomics.compareexchange-struct">
      <h1><span class="secnum">2.3.3</span> Atomics.compareExchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>expectedValue</var>, <var>replacementValue</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_106"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_107"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>replacementValue</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Return <emu-xref aoid="AtomicCompareExchangeInSharedStruct" id="_ref_108"><a href="#sec-atomiccompareexchangeinsharedstruct">AtomicCompareExchangeInSharedStruct</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>expectedValue</var>, <var>replacementValue</var>).</ins></li></ol></li><li><ins>Let <var>typedArray</var> be <var>typedArrayOrStruct</var>.</ins></li><li><ins>Let <var>index</var> be <var>indexOrField</var>.</ins></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.<var class="field">[[ViewedArrayBuffer]]</var>.</li><li>Let <var>block</var> be <var>buffer</var>.<var class="field">[[ArrayBufferData]]</var>.</li><li>If <var>typedArray</var>.<var class="field">[[ContentType]]</var> is <emu-const>bigint</emu-const>, then<ol><li>Let <var>expected</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>expectedValue</var>).</li><li>Let <var>replacement</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>replacementValue</var>).</li></ol></li><li>Else,<ol><li>Let <var>expected</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>expectedValue</var>)).</li><li>Let <var>replacement</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>replacementValue</var>)).</li></ol></li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Let <var>elementSize</var> be <emu-xref aoid="TypedArrayElementSize"><a href="https://tc39.es/ecma262/#sec-typedarrayelementsize">TypedArrayElementSize</a></emu-xref>(<var>typedArray</var>).</li><li>Let <var>isLittleEndian</var> be the value of the <var class="field">[[LittleEndian]]</var> field of the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref>'s <emu-xref href="#agent-record"><a href="https://tc39.es/ecma262/#agent-record">Agent Record</a></emu-xref>.</li><li>Let <var>expectedBytes</var> be <emu-xref aoid="NumericToRawBytes"><a href="https://tc39.es/ecma262/#sec-numerictorawbytes">NumericToRawBytes</a></emu-xref>(<var>elementType</var>, <var>expected</var>, <var>isLittleEndian</var>).</li><li>Let <var>replacementBytes</var> be <emu-xref aoid="NumericToRawBytes"><a href="https://tc39.es/ecma262/#sec-numerictorawbytes">NumericToRawBytes</a></emu-xref>(<var>elementType</var>, <var>replacement</var>, <var>isLittleEndian</var>).</li><li>If <emu-xref aoid="IsSharedArrayBuffer"><a href="https://tc39.es/ecma262/#sec-issharedarraybuffer">IsSharedArrayBuffer</a></emu-xref>(<var>buffer</var>) is <emu-val>true</emu-val>, then<ol><li>Let <var>rawBytesRead</var> be <emu-xref aoid="AtomicCompareExchangeInSharedBlock"><a href="https://tc39.es/ecma262/#sec-atomiccompareexchangeinsharedblock">AtomicCompareExchangeInSharedBlock</a></emu-xref>(<var>block</var>, <var>byteIndexInBuffer</var>, <var>elementSize</var>, <var>expectedBytes</var>, <var>replacementBytes</var>).</li></ol></li><li>Else,<ol><li>Let <var>rawBytesRead</var> be a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of length <var>elementSize</var> whose elements are the sequence of <var>elementSize</var> bytes starting with <var>block</var>[<var>byteIndexInBuffer</var>].</li><li>If <emu-xref aoid="ByteListEqual"><a href="https://tc39.es/ecma262/#sec-bytelistequal">ByteListEqual</a></emu-xref>(<var>rawBytesRead</var>, <var>expectedBytes</var>) is <emu-val>true</emu-val>, then<ol><li>Store the individual bytes of <var>replacementBytes</var> into <var>block</var>, starting at <var>block</var>[<var>byteIndexInBuffer</var>].</li></ol></li></ol></li><li>Return <emu-xref aoid="RawBytesToNumeric"><a href="https://tc39.es/ecma262/#sec-rawbytestonumeric">RawBytesToNumeric</a></emu-xref>(<var>elementType</var>, <var>rawBytesRead</var>, <var>isLittleEndian</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.exchange-struct">
      <h1><span class="secnum">2.3.4</span> Atomics.exchange ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>Let <var>second</var> be a new <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref> with parameters (<del><var>oldBytes</var></del><ins><var>oldValue</var></ins>, <del><var>newBytes</var></del><ins><var>newValue</var></ins>) that captures nothing and performs the following steps atomically when called:<ol><li>Return <del><var>newBytes</var></del><ins><var>newValue</var></ins>.</li></ol></li><li><ins>If _typedArrayOrStruct is a <emu-xref href="#shared-struct-exotic-object" id="_ref_109"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>Return ?&nbsp;<emu-xref aoid="AtomicReadModifyWriteInSharedStruct" id="_ref_110"><a href="#sec-atomicreadmodifywriteinsharedstruct">AtomicReadModifyWriteInSharedStruct</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>value</var>, <var>second</var>).</ins></li></ol></li><li><ins>Let <var>typedArray</var> be <var>typedArrayOrStruct</var>.</ins></li><li><ins>Let <var>index</var> be <var>indexOrField</var>.</ins></li><li>Return ?&nbsp;<emu-xref aoid="AtomicReadModifyWrite"><a href="https://tc39.es/ecma262/#sec-atomicreadmodifywrite" class="e-user-code">AtomicReadModifyWrite</a></emu-xref>(<var>typedArray</var>, <var>index</var>, <var>value</var>, <var>second</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.load-struct">
      <h1><span class="secnum">2.3.5</span> Atomics.load ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_111"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Return <emu-xref aoid="ReadSharedStructField" id="_ref_112"><a href="#sec-readsharedstructfield">ReadSharedStructField</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <emu-const>seq-cst</emu-const>).</ins></li></ol></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.<var class="field">[[ViewedArrayBuffer]]</var>.</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Return <emu-xref aoid="GetValueFromBuffer"><a href="https://tc39.es/ecma262/#sec-getvaluefrombuffer">GetValueFromBuffer</a></emu-xref>(<var>buffer</var>, <var>byteIndexInBuffer</var>, <var>elementType</var>, <emu-val>true</emu-val>, <emu-const>seq-cst</emu-const>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.store-struct">
      <h1><span class="secnum">2.3.6</span> Atomics.store ( <del><var>typedArray</var></del><ins><var>typedArrayOrStruct</var></ins>, <del><var>index</var></del><ins><var>indexOrField</var></ins>, <var>value</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li><ins>If <var>typedArrayOrStruct</var> is a <emu-xref href="#shared-struct-exotic-object" id="_ref_113"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref>, then</ins><ol><li><ins>If <var>indexOrField</var> is not a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_114"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>value</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</ins></li><li><ins>If <var>typedArrayOrStruct</var> does not have an own property with key <var>indexOrField</var>, throw a <emu-val>RangeError</emu-val> exception.</ins></li><li><ins>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_115"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>typedArrayOrStruct</var>, <var>indexOrField</var>, <var>value</var>, <emu-const>seq-cst</emu-const>).</ins></li><li><ins>Return <var>value</var>.</ins></li></ol></li><li>Let <var>byteIndexInBuffer</var> be ?&nbsp;<emu-xref aoid="ValidateAtomicAccessOnIntegerTypedArray"><a href="https://tc39.es/ecma262/#sec-validateatomicaccessonintegertypedarray" class="e-user-code">ValidateAtomicAccessOnIntegerTypedArray</a></emu-xref>(<var>typedArray</var>, <var>index</var>).</li><li>If <var>typedArray</var>.<var class="field">[[ContentType]]</var> is <emu-const>bigint</emu-const>, let <var>v</var> be ?&nbsp;<emu-xref aoid="ToBigInt"><a href="https://tc39.es/ecma262/#sec-tobigint" class="e-user-code">ToBigInt</a></emu-xref>(<var>value</var>).</li><li>Otherwise, let <var>v</var> be <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(? <emu-xref aoid="ToIntegerOrInfinity"><a href="https://tc39.es/ecma262/#sec-tointegerorinfinity" class="e-user-code">ToIntegerOrInfinity</a></emu-xref>(<var>value</var>)).</li><li>Perform ?&nbsp;<emu-xref aoid="RevalidateAtomicAccess"><a href="https://tc39.es/ecma262/#sec-revalidateatomicaccess">RevalidateAtomicAccess</a></emu-xref>(<var>typedArray</var>, <var>byteIndexInBuffer</var>).</li><li>Let <var>buffer</var> be <var>typedArray</var>.<var class="field">[[ViewedArrayBuffer]]</var>.</li><li>Let <var>elementType</var> be <emu-xref aoid="TypedArrayElementType"><a href="https://tc39.es/ecma262/#sec-typedarrayelementtype">TypedArrayElementType</a></emu-xref>(<var>typedArray</var>).</li><li>Perform <emu-xref aoid="SetValueInBuffer"><a href="https://tc39.es/ecma262/#sec-setvalueinbuffer">SetValueInBuffer</a></emu-xref>(<var>buffer</var>, <var>byteIndexInBuffer</var>, <var>elementType</var>, <var>v</var>, <emu-val>true</emu-val>, <emu-const>seq-cst</emu-const>).</li><li>Return <var>v</var>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-the-reflect-object-shared-structs">
    <h1><span class="secnum">2.4</span> Changes to the Reflect Object</h1>
    <ins class="block">
    <emu-clause id="sec-reflect.canBeShared">
      <h1><span class="secnum">2.4.1</span> Reflect.canBeShared ( <var>val</var> )</h1>
      <p></p>
      <emu-alg><ol><li>Return <emu-xref aoid="CanBeSharedAcrossAgents" id="_ref_116"><a href="#sec-canbesharedacrossagents">CanBeSharedAcrossAgents</a></emu-xref>(<var>val</var>).</li></ol></emu-alg>
    </emu-clause>
    </ins>
  </emu-clause>

  <emu-clause id="sec-changes-to-memory-model">
    <h1><span class="secnum">2.5</span> Changes to the Memory Model</h1>
    <emu-clause id="sec-memory-model-fundamentals">
      <h1><span class="secnum">2.5.1</span> Memory Model Fundamentals</h1>
      <p>Shared memory accesses (reads and writes) are divided into two groups, atomic accesses and data accesses, defined below. Atomic accesses are sequentially consistent, i.e., there is a strict total ordering of events agreed upon by all <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref> in an <emu-xref href="#sec-agent-clusters"><a href="https://tc39.es/ecma262/#sec-agent-clusters">agent cluster</a></emu-xref>. Non-atomic accesses do not have a strict total ordering agreed upon by all <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref>, i.e., unordered.</p>
      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>No orderings weaker than sequentially consistent and stronger than unordered, such as release-acquire, are supported.</p>
      </div></emu-note>
      <ins class="block">
      <p>A <dfn variants="Shared Memory Storage Records" tabindex="-1">Shared Memory Storage Record</dfn> is either a <dfn tabindex="-1">SharedBlockStorage</dfn> or <dfn tabindex="-1">SharedStructStorage</dfn> <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>.</p>

      <emu-table id="table-sharedblockstorage-fields" caption="SharedBlockStorage Fields"><figure><figcaption>Table 2: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_117"><a href="#sec-memory-model-fundamentals">SharedBlockStorage</a></emu-xref> Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
            <tr>
              <td><var class="field">[[Block]]</var></td>
              <td>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></td>
              <td>The block the event operates on.</td>
            </tr>
            <tr>
              <td><var class="field">[[ByteIndex]]</var></td>
              <td>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></td>
              <td>The byte address of the access in <var class="field">[[Block]]</var>.</td>
            </tr>
            <tr>
              <td><var class="field">[[ElementSize]]</var></td>
              <td>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></td>
              <td>The size of the access.</td>
            </tr>
          </thead>
        </table>
      </figure></emu-table>

      <emu-table id="table-sharedstructstorage-fields" caption="SharedStructStorage Fields"><figure><figcaption>Table 3: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_118"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
            <tr>
              <td><var class="field">[[Struct]]</var></td>
              <td>a <emu-xref href="#shared-struct-exotic-object" id="_ref_119"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref></td>
              <td>The shared struct the event operates on.</td>
            </tr>
            <tr>
              <td><var class="field">[[Field]]</var></td>
              <td>a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref></td>
              <td>The field that is accessed in <var class="field">[[Struct]]</var>.</td>
            </tr>
          </thead>
        </table>
      </figure></emu-table>
      </ins>

      <p>A <dfn variants="Shared Data Block events" tabindex="-1">Shared Data Block event</dfn> is either a <dfn tabindex="-1">ReadSharedMemory</dfn>, <dfn tabindex="-1">WriteSharedMemory</dfn>, or <dfn tabindex="-1">ReadModifyWriteSharedMemory</dfn> <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">Record</a></emu-xref>.</p>

      <emu-table id="table-readsharedmemory-fields" caption="ReadSharedMemory Event Fields"><figure><figcaption>Table 4: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_120"><a href="#sec-memory-model-fundamentals">ReadSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td><var class="field">[[Order]]</var></td>
            <td><emu-const>seq-cst</emu-const> or <emu-const>unordered</emu-const></td>
            <td>The weakest ordering guaranteed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> for the event.</td>
          </tr>
          <tr>
            <td><var class="field">[[NoTear]]</var></td>
            <td>a Boolean</td>
            <td>Whether this event is allowed to read from multiple write events with equal range as this event.</td>
          </tr>
          <tr>
            <td><del><var class="field">[[Block]]</var></del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ByteIndex]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the read in <var class="field">[[Block]]</var>.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ElementSize]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the read.</del></td>
          </tr>
          <tr>
            <td><ins><var class="field">[[Storage]]</var></ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_121"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory that is read.</ins></td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <emu-table id="table-writesharedmemory-fields" caption="WriteSharedMemory Event Fields"><figure><figcaption>Table 5: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_122"><a href="#sec-memory-model-fundamentals">WriteSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td><var class="field">[[Order]]</var></td>
            <td><emu-const>seq-cst</emu-const>, <emu-const>unordered</emu-const>, or <emu-const>init</emu-const></td>
            <td>The weakest ordering guaranteed by the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> for the event.</td>
          </tr>
          <tr>
            <td><var class="field">[[NoTear]]</var></td>
            <td>a Boolean</td>
            <td>Whether this event is allowed to be read from multiple read events with equal range as this event.</td>
          </tr>
          <tr>
            <td><del><var class="field">[[Block]]</var></del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ByteIndex]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the write in <var class="field">[[Block]]</var>.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ElementSize]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the write.</del></td>
          </tr>
          <tr>
            <td><ins><var class="field">[[Storage]]</var></ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_123"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory that is written.</ins></td>
          </tr>
          <tr>
            <td><var class="field">[[Payload]]</var></td>
            <td>a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref></td>
            <td>The <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> to be read by other events.</td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <emu-table id="table-rmwsharedmemory-fields" caption="ReadModifyWriteSharedMemory Event Fields"><figure><figcaption>Table 6: <emu-xref href="#sec-memory-model-fundamentals" id="_ref_124"><a href="#sec-memory-model-fundamentals">ReadModifyWriteSharedMemory</a></emu-xref> Event Fields</figcaption>
        <table>
          <thead>
            <tr>
              <th>Field Name</th>
              <th>Value</th>
              <th>Meaning</th>
            </tr>
          </thead>
          <tbody><tr>
            <td><var class="field">[[Order]]</var></td>
            <td><emu-const>seq-cst</emu-const></td>
            <td>Read-modify-write events are always sequentially consistent.</td>
          </tr>
          <tr>
            <td><var class="field">[[NoTear]]</var></td>
            <td><emu-val>true</emu-val></td>
            <td>Read-modify-write events cannot tear.</td>
          </tr>
          <tr>
            <td><del><var class="field">[[Block]]</var></del></td>
            <td><del>a <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref></del></td>
            <td><del>The block the event operates on.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ByteIndex]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The byte address of the read-modify-write in <var class="field">[[Block]]</var>.</del></td>
          </tr>
          <tr>
            <td><del><var class="field">[[ElementSize]]</var></del></td>
            <td><del>a non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref></del></td>
            <td><del>The size of the read-modify-write.</del></td>
          </tr>
          <tr>
            <td><ins><var class="field">[[Storage]]</var></ins></td>
            <td><ins>a <emu-xref href="#sec-memory-model-fundamentals" id="_ref_125"><a href="#sec-memory-model-fundamentals">Shared Memory Storage Record</a></emu-xref></ins></td>
            <td><ins>The storage of memory of the read-modify-write.</ins></td>
          </tr>
          <tr>
            <td><var class="field">[[Payload]]</var></td>
            <td>a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref></td>
            <td>The <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> to be passed to <var class="field">[[ModifyOp]]</var>.</td>
          </tr>
          <tr>
            <td><var class="field">[[ModifyOp]]</var></td>
            <td>a <emu-xref href="#sec-arraybuffer-notation"><a href="https://tc39.es/ecma262/#sec-arraybuffer-notation">read-modify-write modification function</a></emu-xref></td>
            <td>An abstract closure that returns a modified <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> from a read <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> and <var class="field">[[Payload]]</var>.</td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <p>These events are introduced by <emu-xref href="#sec-algorithm-conventions-abstract-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-abstract-operations">abstract operations</a></emu-xref> or by methods on the Atomics object.</p>
      <p>Some operations may also introduce <dfn tabindex="-1">Synchronize</dfn> events. A <dfn variants="Synchronize events" tabindex="-1">Synchronize event</dfn> has no fields, and exists purely to directly constrain the permitted orderings of other events.</p>
      <p>In addition to <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">Shared Data Block</a></emu-xref> and Synchronize events, there are <emu-xref href="#host"><a href="https://tc39.es/ecma262/#host">host</a></emu-xref>-specific events.</p>
      <p><ins>If the <var class="field">[[Storage]]</var> field of a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event is a SharedBlockStorage, then </ins><del>L</del><ins>l</ins>et <del>the</del><ins>its</ins> range of <del>a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event</del> be the Set of contiguous <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integers</a></emu-xref> from its <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[ByteIndex]]</var> to <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[ByteIndex]]</var> + <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[ElementSize]]</var> - 1. Two events' ranges are equal when the events <ins>have a SharedBlockStorage in their <var class="field">[[Storage]]</var> field,</ins> have the same <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[Block]]</var>, and the ranges are element-wise equal. Two events' ranges are overlapping when the events have the same <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[Block]]</var>, the ranges are not equal and their intersection is non-empty. Two events' ranges are disjoint when the events do not <ins>both have a SharedBlockStorage in their <var class="field">[[Storage]]</var> field, do not</ins> have the same <ins><var class="field">[[Storage]]</var>.</ins><var class="field">[[Block]]</var><ins>,</ins> or their ranges are neither equal nor overlapping.</p>
      <p><ins>If the <var class="field">[[Storage]]</var> field of a ReadSharedMemory, WriteSharedMemory, or ReadModifyWriteSharedMemory event is a SharedStructStorage, then let its range be the value of the <var class="field">[[Storage]]</var> field. Two events' ranges are equal when the events have a SharedStructStorage in their <var class="field">[[Storage]]</var> field, have the same <var class="field">[[Storage]]</var>.<var class="field">[[Struct]]</var> and the same <var class="field">[[Storage]]</var>.<var class="field">[[Field]]</var>. Two events' ranges that both have a SharedStructStorage in their <var class="field">[[Storage]]</var> field are never overlapping. Two events' ranges are disjoint when the events do not both have a SharedStructStorage in their <var class="field">[[Storage]]</var> Field, or do not have the same <var class="field">[[Storage]]</var>.<var class="field">[[Struct]]</var> or the same <var class="field">[[Storage]]</var>.<var class="field">[[Field]]</var>.</ins></p>
    </emu-clause>
  </emu-clause>
  <p>For brevity, the refactoring of the <emu-xref href="#sec-memory-model"><a href="https://tc39.es/ecma262/#sec-memory-model">memory model</a></emu-xref> relations to use <emu-xref href="#sec-memory-model-fundamentals" id="_ref_126"><a href="#sec-memory-model-fundamentals">SharedStructStorage</a></emu-xref> and the modified definition of event ranges is omitted.</p>
</emu-clause>

<emu-clause id="sec-shared-arrays">
  <h1><span class="secnum">3</span> Shared Array Object</h1>
  <p><dfn variant="Shared Array" tabindex="-1">Shared Arrays</dfn> are a special case of <emu-xref href="#shared-struct-exotic-object" id="_ref_127"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> with array indexed properties and an immutable <emu-val>"length"</emu-val> own property. Since they are <emu-xref href="#shared-struct-exotic-object" id="_ref_128"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref>, their layout, i.e. their length, is fixed at creation time.</p>

  <ins class="block">
  <emu-clause id="sec-shared-array-constructor">
    <h1><span class="secnum">3.1</span> The SharedArray Constructor</h1>
    <p>The SharedArray <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>is <dfn tabindex="-1">%SharedArray%</dfn>.</li>
      <li>is the initial value of the <emu-val>"SharedArray"</emu-val> property of the <emu-xref href="#sec-global-object"><a href="https://tc39.es/ecma262/#sec-global-object">global object</a></emu-xref>.</li>
      <li>creates and initializes a new Shared Array when called as a <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
      <li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
      <li>is a function whose behaviour differs based upon the number and types of its arguments.</li>
    </ul>

    <emu-clause id="sec-sharedarraycreate" type="abstract operation" aoid="SharedArrayCreate">
      <h1><span class="secnum">3.1.1</span> SharedArrayCreate ( <var>length</var> )</h1>
      <p>The abstract operation SharedArrayCreate takes argument <var>length</var> (an non-negative <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref>) and returns a Shared Array. It is used to specify the creation of new <emu-xref href="#sec-shared-arrays" id="_ref_129"><a href="#sec-shared-arrays">Shared Arrays</a></emu-xref>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>length</var> ≤ 2<sup>32</sup> - 1.</li><li>Let <var>createInitializer</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with parameters (<var>newSharedArray</var>) that captures <var>length</var> and performs the following steps when called:<ol><li>Let <var>k</var> be 0.</li><li>Repeat, while <var>k</var> &lt; <var>length</var>,<ol><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>k</var>)).</li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <var>Pk</var> of object <var>newSharedArray</var> whose <var class="field">[[Value]]</var> is <emu-val>undefined</emu-val>, <var class="field">[[Writable]]</var> is <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var> is <emu-val>true</emu-val>, and <var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_130"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>newSharedArray</var>, <var>Pk</var>, <emu-val>undefined</emu-val>, <emu-const>init</emu-const>).</li></ol></li><li>Create an own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref> named <emu-val>"length"</emu-val> of object <var>newSharedArray</var> whose <var class="field">[[Value]]</var> is <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>length</var>), <var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, <var class="field">[[Enumerable]]</var> is <emu-val>false</emu-val>, and <var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="WriteSharedStructField" id="_ref_131"><a href="#sec-writesharedstructfield">WriteSharedStructField</a></emu-xref>(<var>newSharedArray</var>, <emu-val>"length"</emu-val>, <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>length</var>), <emu-const>init</emu-const>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>Return <emu-xref aoid="SharedStructCreate" id="_ref_132"><a href="#sec-sharedstructcreate">SharedStructCreate</a></emu-xref>(<var>createInitializer</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-sharedarray">
      <h1><span class="secnum">3.1.2</span> SharedArray ( ...<var>values</var> )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>EDITOR'S NOTE: Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will give <emu-xref href="#sec-shared-arrays" id="_ref_133"><a href="#sec-shared-arrays">Shared Arrays</a></emu-xref> a per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype with built-in methods.</li><li>Let <var>numberOfArgs</var> be the number of elements in <var>values</var>.</li><li>If <var>numberOfArgs</var> = 0, then<ol><li>Return <emu-xref aoid="SharedArrayCreate" id="_ref_134"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(0).</li></ol></li><li>Else if <var>numberOfArgs</var> = 1, then<ol><li>Let <var>len</var> be <var>values</var>[0].</li><li>If <var>len</var> is not an <emu-xref href="#integral-number"><a href="https://tc39.es/ecma262/#integral-number">integral Number</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>len</var> &lt; 0, throw a <emu-val>RangeError</emu-val> exception.</li><li>Let <var>lenReal</var> be <emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>len</var>).</li><li>If <var>lenReal</var> &gt; 2<sup>32</sup> - 1, throw a <emu-val>RangeError</emu-val> exception.</li><li>Return <emu-xref aoid="SharedArrayCreate" id="_ref_135"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(<var>lenReal</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>numberOfArgs</var> ≥ 2.</li><li>Let <var>array</var> be <emu-xref aoid="SharedArrayCreate" id="_ref_136"><a href="#sec-sharedarraycreate">SharedArrayCreate</a></emu-xref>(<var>numberOfArgs</var>).</li><li>Let <var>k</var> be 0.</li><li>Repeat, while <var>k</var> &lt; <var>numberOfArgs</var>,<ol><li>Let <var>Pk</var> be !&nbsp;<emu-xref aoid="ToString"><a href="https://tc39.es/ecma262/#sec-tostring">ToString</a></emu-xref>(<emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>k</var>)).</li><li>Let <var>itemK</var> be <var>values</var>[<var>k</var>].</li><li>Perform !&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw">Set</a></emu-xref>(<var>array</var>, <var>Pk</var>, <var>itemK</var>, <emu-val>true</emu-val>).</li><li>Set <var>k</var> to <var>k</var> + 1.</li></ol></li><li>Return <var>array</var>.</li></ol></li></ol></emu-alg>
    </emu-clause>
  </emu-clause>
  </ins>
</emu-clause>

<emu-clause id="sec-unsafe-block">
  <h1><span class="secnum">4</span> The <code>unsafe</code> Block</h1>
  <h2>Syntax</h2>
  <emu-grammar type="definition"><emu-production name="BlockStatement" params="Yield, Await, Return" id="prod-BlockStatement">
    <emu-nt params="Yield, Await, Return"><a href="#prod-BlockStatement">BlockStatement</a><emu-mods><emu-params>[Yield, Await, Return]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="zwpfwt4j">
        <emu-nt params="?Yield, ?Await, ?Return"><a href="https://tc39.es/ecma262/#prod-Block">Block</a><emu-mods><emu-params>[?Yield, ?Await, ?Return]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
    <ins><emu-rhs a="xnwvyu53">
        <emu-nt params="?Yield, ?Await, ?Return" id="_ref_250"><a href="#prod-UnsafeBlock">UnsafeBlock</a><emu-mods><emu-params>[?Yield, ?Await, ?Return]</emu-params></emu-mods></emu-nt>
    </emu-rhs></ins>
</emu-production>
<ins class="block"><emu-production name="UnsafeBlock" params="Yield, Await, Return" id="prod-UnsafeBlock">
    <emu-nt params="Yield, Await, Return"><a href="#prod-UnsafeBlock">UnsafeBlock</a><emu-mods><emu-params>[Yield, Await, Return]</emu-params></emu-mods></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="1zmtmren" id="prod-oQyYYq5x">
        <emu-t>unsafe</emu-t>
        <emu-gann>[no <emu-nt><a href="https://tc39.es/ecma262/#prod-LineTerminator">LineTerminator</a></emu-nt> here]</emu-gann>
        <emu-nt params="?Yield, ?Await, ?Return"><a href="https://tc39.es/ecma262/#prod-Block">Block</a><emu-mods><emu-params>[?Yield, ?Await, ?Return]</emu-params></emu-mods></emu-nt>
    </emu-rhs>
</emu-production></ins>
</emu-grammar>

  <emu-clause id="sec-isunsafe" type="abstract operation" aoid="IsUnsafe">
    <h1><span class="secnum">4.1</span> Static Semantics: IsUnsafe ( <var>node</var> )</h1>
    <p>The abstract operation IsUnsafe takes argument <var>node</var> (a <emu-xref href="#sec-syntactic-grammar"><a href="https://tc39.es/ecma262/#sec-syntactic-grammar">Parse Node</a></emu-xref>) and returns a Boolean. It performs the following steps when called:</p>
    <emu-alg><ol><li>If <var>node</var> is contained within an <emu-nt id="_ref_251"><a href="#prod-UnsafeBlock">UnsafeBlock</a></emu-nt>, return <emu-val>true</emu-val>; else return <emu-val>false</emu-val>.</li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-unsafe-block-runtime-semantics-evaluation" type="sdo">
    <h1><span class="secnum">4.2</span> Runtime Semantics: Evaluation</h1>
    <emu-grammar><emu-production name="UnsafeBlock" collapsed="">
    <emu-nt><a href="#prod-UnsafeBlock">UnsafeBlock</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="hesy_pij" id="prod-skb9MgRv">
        <emu-t>unsafe</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Block">Block</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
    <emu-alg><ol><li>Return ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-Block">Block</a></emu-nt>.</li></ol></emu-alg>
  </emu-clause>

  <emu-clause id="sec-changes-to-reference-records">
    <h1><span class="secnum">4.3</span> Changes to Reference Records</h1>

    <emu-clause id="sec-reference-record-specification-type" oldids="sec-reference-specification-type"><span id="sec-reference-specification-type"></span>
      <h1><span class="secnum">4.3.1</span> The Reference Record Specification Type</h1>
      <p>The <dfn variants="Reference Records" tabindex="-1">Reference Record</dfn> type is used to explain the behaviour of such operators as <code>delete</code>, <code>typeof</code>, the assignment operators, the <code>super</code> <emu-xref href="#sec-keywords-and-reserved-words"><a href="https://tc39.es/ecma262/#sec-keywords-and-reserved-words">keyword</a></emu-xref> and other language features. For example, the left-hand operand of an assignment is expected to produce a Reference Record.</p>
      <p>A Reference Record is a resolved name or property binding; its fields are defined by <emu-xref href="#table-reference-record-fields" id="_ref_11"><a href="#table-reference-record-fields">Table 7</a></emu-xref>.</p>

      <emu-table id="table-reference-record-fields" caption="Reference Record Fields"><figure><figcaption>Table 7: <emu-xref href="#sec-reference-record-specification-type" id="_ref_137"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> Fields</figcaption>
        <table>
          <tbody><tr>
            <th>Field Name</th>
            <th>Value</th>
            <th>Meaning</th>
          </tr>
          <tr>
            <td oldids="sec-getbase,ao-getbase"><span id="ao-getbase"></span><span id="sec-getbase"></span><var class="field">[[Base]]</var></td>
            <td>an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>, an <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref>, or <emu-const>unresolvable</emu-const></td>
            <td>The value or <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref> which holds the binding. A <var class="field">[[Base]]</var> of <emu-const>unresolvable</emu-const> indicates that the binding could not be resolved.</td>
          </tr>
          <tr>
            <td oldids="sec-getreferencedname,ao-getreferencedname"><span id="ao-getreferencedname"></span><span id="sec-getreferencedname"></span><var class="field">[[ReferencedName]]</var></td>
            <td>a String, a Symbol, or a <emu-xref href="#sec-private-names"><a href="https://tc39.es/ecma262/#sec-private-names">Private Name</a></emu-xref></td>
            <td>The name of the binding. Always a String if <var class="field">[[Base]]</var> value is an <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref>.</td>
          </tr>
          <tr>
            <td oldids="sec-isstrictreference,ao-isstrictreference"><span id="ao-isstrictreference"></span><span id="sec-isstrictreference"></span><var class="field">[[Strict]]</var></td>
            <td>a Boolean</td>
            <td><emu-val>true</emu-val> if the <emu-xref href="#sec-reference-record-specification-type" id="_ref_138"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> originated in <emu-xref href="#sec-strict-mode-code"><a href="https://tc39.es/ecma262/#sec-strict-mode-code">strict mode code</a></emu-xref>, <emu-val>false</emu-val> otherwise.</td>
          </tr>
          <tr>
            <td><ins><var class="field">[[Unsafe]]</var></ins></td>
            <td><ins>a Boolean</ins></td>
            <td><ins><emu-val>true</emu-val> if the <emu-xref href="#sec-reference-record-specification-type" id="_ref_139"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> originated in an <emu-nt id="_ref_252"><a href="#prod-UnsafeBlock">UnsafeBlock</a></emu-nt>, <emu-val>false</emu-val> otherwise.</ins></td>
          </tr>
          <tr>
            <td><var class="field">[[ThisValue]]</var></td>
            <td>an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or <emu-const>empty</emu-const></td>
            <td>If not <emu-const>empty</emu-const>, the <emu-xref href="#sec-reference-record-specification-type" id="_ref_140"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> represents a property binding that was expressed using the <code>super</code> <emu-xref href="#sec-keywords-and-reserved-words"><a href="https://tc39.es/ecma262/#sec-keywords-and-reserved-words">keyword</a></emu-xref>; it is called a <dfn id="super-reference-record" oldids="super-reference" variants="Super Reference Records" tabindex="-1"><span id="super-reference"></span>Super Reference Record</dfn> and its <var class="field">[[Base]]</var> value will never be an <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref>. In that case, the <var class="field">[[ThisValue]]</var> field holds the <emu-val>this</emu-val> value at the time the <emu-xref href="#sec-reference-record-specification-type" id="_ref_141"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> was created.</td>
          </tr>
        </tbody></table>
      </figure></emu-table>

      <p>The following <emu-xref href="#sec-algorithm-conventions-abstract-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-abstract-operations">abstract operations</a></emu-xref> are used in this specification to operate upon Reference Records:</p>

      <emu-clause id="sec-getvalue" type="abstract operation" aoid="GetValue">
        <h1><span class="secnum">4.3.1.1</span> GetValue ( <var>V</var> )</h1>
        <p>The abstract operation GetValue takes argument <var>V</var> (a <emu-xref href="#sec-reference-record-specification-type" id="_ref_142"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> or an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>If <var>V</var> is not a <emu-xref href="#sec-reference-record-specification-type" id="_ref_143"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref>, return <var>V</var>.</li><li>If <emu-xref aoid="IsUnresolvableReference"><a href="https://tc39.es/ecma262/#sec-isunresolvablereference">IsUnresolvableReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, throw a <emu-val>ReferenceError</emu-val> exception.</li><li>If <emu-xref aoid="IsPropertyReference"><a href="https://tc39.es/ecma262/#sec-ispropertyreference">IsPropertyReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, then<ol><li id="step-getvalue-toobject">Let <var>baseObj</var> be ?&nbsp;<emu-xref aoid="ToObject"><a href="https://tc39.es/ecma262/#sec-toobject">ToObject</a></emu-xref>(<var>V</var>.<var class="field">[[Base]]</var>).</li><li>If <emu-xref aoid="IsPrivateReference"><a href="https://tc39.es/ecma262/#sec-isprivatereference">IsPrivateReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, then<ol><li>Return ?&nbsp;<emu-xref aoid="PrivateGet"><a href="https://tc39.es/ecma262/#sec-privateget" class="e-user-code">PrivateGet</a></emu-xref>(<var>baseObj</var>, <var>V</var>.<var class="field">[[ReferencedName]]</var>).</li></ol></li><li>Return ?&nbsp;<span class="e-user-code"><var>baseObj</var>.<var class="field">[[Get]]</var></span>(<var>V</var>.<var class="field">[[ReferencedName]]</var>, <emu-xref aoid="GetThisValue"><a href="https://tc39.es/ecma262/#sec-getthisvalue">GetThisValue</a></emu-xref>(<var>V</var>)<ins>, <var>V</var>.<var class="field">[[Unsafe]]</var></ins>).</li></ol></li><li>Else,<ol><li>Let <var>base</var> be <var>V</var>.<var class="field">[[Base]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>base</var> is an <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref>.</li><li>Return ?&nbsp;<span class="e-user-code"><var>base</var>.GetBindingValue</span>(<var>V</var>.<var class="field">[[ReferencedName]]</var>, <var>V</var>.<var class="field">[[Strict]]</var>) (see <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">9.1</a></emu-xref>).</li></ol></li></ol></emu-alg>
        <emu-note><span class="note">Note</span><div class="note-contents">
          <p>The object that may be created in step <emu-xref href="#step-getvalue-toobject" id="_ref_12"><a href="#step-getvalue-toobject">3.a</a></emu-xref> is not accessible outside of the above abstract operation and the <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> <var class="field">[[Get]]</var> internal method. An implementation might choose to avoid the actual creation of the object.</p>
        </div></emu-note>
      </emu-clause>

      <emu-clause id="sec-putvalue" type="abstract operation" aoid="PutValue">
        <h1><span class="secnum">4.3.1.2</span> PutValue ( <var>V</var>, <var>W</var> )</h1>
        <p>The abstract operation PutValue takes arguments <var>V</var> (a <emu-xref href="#sec-reference-record-specification-type" id="_ref_144"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> or an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>W</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-const>unused</emu-const> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>If <var>V</var> is not a <emu-xref href="#sec-reference-record-specification-type" id="_ref_145"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref>, throw a <emu-val>ReferenceError</emu-val> exception.</li><li>If <emu-xref aoid="IsUnresolvableReference"><a href="https://tc39.es/ecma262/#sec-isunresolvablereference">IsUnresolvableReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, then<ol><li>If <var>V</var>.<var class="field">[[Strict]]</var> is <emu-val>true</emu-val>, throw a <emu-val>ReferenceError</emu-val> exception.</li><li>Let <var>globalObj</var> be <emu-xref aoid="GetGlobalObject"><a href="https://tc39.es/ecma262/#sec-getglobalobject">GetGlobalObject</a></emu-xref>().</li><li>Perform ?&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw" class="e-user-code">Set</a></emu-xref>(<var>globalObj</var>, <var>V</var>.<var class="field">[[ReferencedName]]</var>, <var>W</var>, <emu-val>false</emu-val>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>If <emu-xref aoid="IsPropertyReference"><a href="https://tc39.es/ecma262/#sec-ispropertyreference">IsPropertyReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, then<ol><li id="step-putvalue-toobject">Let <var>baseObj</var> be ?&nbsp;<emu-xref aoid="ToObject"><a href="https://tc39.es/ecma262/#sec-toobject">ToObject</a></emu-xref>(<var>V</var>.<var class="field">[[Base]]</var>).</li><li>If <emu-xref aoid="IsPrivateReference"><a href="https://tc39.es/ecma262/#sec-isprivatereference">IsPrivateReference</a></emu-xref>(<var>V</var>) is <emu-val>true</emu-val>, then<ol><li>Return ?&nbsp;<emu-xref aoid="PrivateSet"><a href="https://tc39.es/ecma262/#sec-privateset" class="e-user-code">PrivateSet</a></emu-xref>(<var>baseObj</var>, <var>V</var>.<var class="field">[[ReferencedName]]</var>, <var>W</var>).</li></ol></li><li>Let <var>succeeded</var> be ?&nbsp;<span class="e-user-code"><var>baseObj</var>.<var class="field">[[Set]]</var></span>(<var>V</var>.<var class="field">[[ReferencedName]]</var>, <var>W</var>, <emu-xref aoid="GetThisValue"><a href="https://tc39.es/ecma262/#sec-getthisvalue">GetThisValue</a></emu-xref>(<var>V</var>)<ins>, <var>V</var>.<var class="field">[[Unsafe]]</var></ins>).</li><li>If <var>succeeded</var> is <emu-val>false</emu-val> and <var>V</var>.<var class="field">[[Strict]]</var> is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>Else,<ol><li>Let <var>base</var> be <var>V</var>.<var class="field">[[Base]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>base</var> is an <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">Environment Record</a></emu-xref>.</li><li>Return ?&nbsp;<span class="e-user-code"><var>base</var>.SetMutableBinding</span>(<var>V</var>.<var class="field">[[ReferencedName]]</var>, <var>W</var>, <var>V</var>.<var class="field">[[Strict]]</var>) (see <emu-xref href="#sec-environment-records"><a href="https://tc39.es/ecma262/#sec-environment-records">9.1</a></emu-xref>).</li></ol></li></ol></emu-alg>
        <emu-note><span class="note">Note</span><div class="note-contents">
          <p>The object that may be created in step <emu-xref href="#step-putvalue-toobject" id="_ref_13"><a href="#step-putvalue-toobject">3.a</a></emu-xref> is not accessible outside of the above abstract operation and the <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> <var class="field">[[Set]]</var> internal method. An implementation might choose to avoid the actual creation of that object.</p>
        </div></emu-note>
      </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-the-object-type">
    <h1><span class="secnum">4.4</span> Changes to the Object Type</h1>
    <emu-clause id="sec-object-internal-methods-and-internal-slots">
      <h1><span class="secnum">4.4.1</span> Object Internal Methods and Internal Slots</h1>
      <emu-table id="table-essential-internal-methods" caption="Essential Internal Methods" oldids="table-5"><figure><figcaption>Table 8: Essential Internal Methods</figcaption><span id="table-5"></span>
        <table>
          <thead>
            <tr>
              <th>
                Internal Method
              </th>
              <th>
                Signature
              </th>
              <th>
                Description
              </th>
            </tr>
          </thead>
          <tbody><tr>
            <td>
              <var class="field">[[Get]]</var>
            </td>
            <td>
              (<var>propertyKey</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>) <b>→</b> <em>any</em>
            </td>
            <td>
              Return the value of the property whose key is <var>propertyKey</var> from this object. If any ECMAScript code must be executed to retrieve the property value, <var>Receiver</var> is used as the <emu-val>this</emu-val> value when evaluating the code. <ins>If this operation is to be performed from within an <code>unsafe</code> block, <var>unsafe</var> will be <emu-val>true</emu-val>; otherwise, <var>unsafe</var> will be <emu-val>false</emu-val>.</ins>
            </td>
          </tr>
          <tr>
            <td>
              <var class="field">[[Set]]</var>
            </td>
            <td>
              (<var>propertyKey</var>, <var>value</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>) <b>→</b> Boolean
            </td>
            <td>
              Set the value of the property whose key is <var>propertyKey</var> to <var>value</var>. If any ECMAScript code must be executed to set the property value, <var>Receiver</var> is used as the <emu-val>this</emu-val> value when evaluating the code. <ins>If this operation is to be performed from within an <code>unsafe</code> block, <var>unsafe</var> will be <emu-val>true</emu-val>; otherwise, <var>unsafe</var> will be <emu-val>false</emu-val>.</ins> Returns <emu-val>true</emu-val> if the property value was set or <emu-val>false</emu-val> if it could not be set.
            </td>
          </tr>
        </tbody></table>
      </figure></emu-table>
      <emu-note><span class="note">Note</span><div class="note-contents">
        <p>DRAFT NOTE: Except where specified, it is assumed that existing invocations of <var class="field">[[Get]]</var> or <var class="field">[[Set]]</var> that do not currently pass a value for the <var>unsafe</var> parameter are assumed to pass <emu-val>false</emu-val>. These call sites will be updated when the fully integrated specification text becomes available during Stage 2.</p>
      </div></emu-note>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-ordinary-and-exotic-objects-behaviours">
    <h1><span class="secnum">4.5</span> Changes to Ordinary and Exotic Objects Behaviours</h1>
    <emu-clause id="sec-ordinary-object-internal-methods-and-internal-slots">
      <h1><span class="secnum">4.5.1</span> Ordinary Object Internal Methods and Internal Slots</h1>

      <emu-clause id="sec-ordinary-object-internal-methods-and-internal-slots-get-p-receiver" type="internal method">
        <h1><span class="secnum">4.5.1.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The <var class="field">[[Get]]</var> internal method of an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>

        <emu-alg><ol><li>Return ?&nbsp;<emu-xref aoid="OrdinaryGet" id="_ref_146"><a href="#sec-ordinaryget" class="e-user-code">OrdinaryGet</a></emu-xref>(<var>O</var>, <var>P</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>

        <emu-clause id="sec-ordinaryget" type="abstract operation" aoid="OrdinaryGet">
          <h1><span class="secnum">4.5.1.1.1</span> OrdinaryGet ( <var>O</var>, <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The abstract operation OrdinaryGet takes arguments <var>O</var> (an Object), <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>

          <emu-alg><ol><li>Let <var>desc</var> be ?&nbsp;<span class="e-user-code"><var>O</var>.<var class="field">[[GetOwnProperty]]</var></span>(<var>P</var>).</li><li>If <var>desc</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>parent</var> be ?&nbsp;<span class="e-user-code"><var>O</var>.<var class="field">[[GetPrototypeOf]]</var></span>().</li><li>If <var>parent</var> is <emu-val>null</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Return ?&nbsp;<span class="e-user-code"><var>parent</var>.<var class="field">[[Get]]</var></span>(<var>P</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></li><li>If <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>desc</var>) is <emu-val>true</emu-val>, return <var>desc</var>.<var class="field">[[Value]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsAccessorDescriptor"><a href="https://tc39.es/ecma262/#sec-isaccessordescriptor">IsAccessorDescriptor</a></emu-xref>(<var>desc</var>) is <emu-val>true</emu-val>.</li><li>Let <var>getter</var> be <var>desc</var>.<var class="field">[[Get]]</var>.</li><li>If <var>getter</var> is <emu-val>undefined</emu-val>, return <emu-val>undefined</emu-val>.</li><li>Return ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>getter</var>, <var>Receiver</var>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-ordinary-object-internal-methods-and-internal-slots-set-p-v-receiver" type="internal method">
        <h1><span class="secnum">4.5.1.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The <var class="field">[[Set]]</var> internal method of an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>Return ?&nbsp;<emu-xref aoid="OrdinarySet" id="_ref_147"><a href="#sec-ordinaryset" class="e-user-code">OrdinarySet</a></emu-xref>(<var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>

        <emu-clause id="sec-ordinaryset" type="abstract operation" aoid="OrdinarySet">
          <h1><span class="secnum">4.5.1.2.1</span> OrdinarySet ( <var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The abstract operation OrdinarySet takes arguments <var>O</var> (an Object), <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>

          <emu-alg><ol><li>Let <var>ownDesc</var> be ?&nbsp;<span class="e-user-code"><var>O</var>.<var class="field">[[GetOwnProperty]]</var></span>(<var>P</var>).</li><li>Return ?&nbsp;<emu-xref aoid="OrdinarySetWithOwnDescriptor" id="_ref_148"><a href="#sec-ordinarysetwithowndescriptor" class="e-user-code">OrdinarySetWithOwnDescriptor</a></emu-xref>(<var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>, <var>ownDesc</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-ordinarysetwithowndescriptor" type="abstract operation" aoid="OrdinarySetWithOwnDescriptor">
          <h1><span class="secnum">4.5.1.2.2</span> OrdinarySetWithOwnDescriptor ( <var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>, <var>ownDesc</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The abstract operation OrdinarySetWithOwnDescriptor takes arguments <var>O</var> (an Object), <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>ownDesc</var> (a <emu-xref href="#sec-property-descriptor-specification-type"><a href="https://tc39.es/ecma262/#sec-property-descriptor-specification-type">Property Descriptor</a></emu-xref> or <emu-val>undefined</emu-val>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>

          <emu-alg><ol><li>If <var>ownDesc</var> is <emu-val>undefined</emu-val>, then<ol><li>Let <var>parent</var> be ?&nbsp;<span class="e-user-code"><var>O</var>.<var class="field">[[GetPrototypeOf]]</var></span>().</li><li>If <var>parent</var> is not <emu-val>null</emu-val>, then<ol><li>Return ?&nbsp;<span class="e-user-code"><var>parent</var>.<var class="field">[[Set]]</var></span>(<var>P</var>, <var>V</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></li><li>Else,<ol><li>Set <var>ownDesc</var> to the PropertyDescriptor { <var class="field">[[Value]]</var>: <emu-val>undefined</emu-val>, <var class="field">[[Writable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Enumerable]]</var>: <emu-val>true</emu-val>, <var class="field">[[Configurable]]</var>: <emu-val>true</emu-val>&nbsp;}.</li></ol></li></ol></li><li>If <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>ownDesc</var>) is <emu-val>true</emu-val>, then<ol><li>If <var>ownDesc</var>.<var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>Receiver</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref>, return <emu-val>false</emu-val>.</li><li>Let <var>existingDescriptor</var> be ?&nbsp;<span class="e-user-code"><var>Receiver</var>.<var class="field">[[GetOwnProperty]]</var></span>(<var>P</var>).</li><li>If <var>existingDescriptor</var> is not <emu-val>undefined</emu-val>, then<ol><li>If <emu-xref aoid="IsAccessorDescriptor"><a href="https://tc39.es/ecma262/#sec-isaccessordescriptor">IsAccessorDescriptor</a></emu-xref>(<var>existingDescriptor</var>) is <emu-val>true</emu-val>, return <emu-val>false</emu-val>.</li><li>If <var>existingDescriptor</var>.<var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>Let <var>valueDesc</var> be the PropertyDescriptor { <var class="field">[[Value]]</var>: <var>V</var>&nbsp;}.</li><li>Return ?&nbsp;<span class="e-user-code"><var>Receiver</var>.<var class="field">[[DefineOwnProperty]]</var></span>(<var>P</var>, <var>valueDesc</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>Receiver</var> does not currently have a property <var>P</var>.</li><li>Return ?&nbsp;<emu-xref aoid="CreateDataProperty"><a href="https://tc39.es/ecma262/#sec-createdataproperty" class="e-user-code">CreateDataProperty</a></emu-xref>(<var>Receiver</var>, <var>P</var>, <var>V</var>).</li></ol></li></ol></li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <emu-xref aoid="IsAccessorDescriptor"><a href="https://tc39.es/ecma262/#sec-isaccessordescriptor">IsAccessorDescriptor</a></emu-xref>(<var>ownDesc</var>) is <emu-val>true</emu-val>.</li><li>Let <var>setter</var> be <var>ownDesc</var>.<var class="field">[[Set]]</var>.</li><li>If <var>setter</var> is <emu-val>undefined</emu-val>, return <emu-val>false</emu-val>.</li><li>Perform ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>setter</var>, <var>Receiver</var>, « <var>V</var>&nbsp;»).</li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-built-in-exotic-object-internal-methods-and-slots">
      <h1><span class="secnum">4.5.2</span> Built-in Exotic Object Internal Methods and Slots</h1>
      <emu-clause id="sec-arguments-exotic-objects">
        <h1><span class="secnum">4.5.2.1</span> Arguments Exotic Objects</h1>
        <emu-clause id="sec-arguments-exotic-objects-get-p-receiver" type="internal method">
          <h1><span class="secnum">4.5.2.1.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Get]]</var> internal method of an <emu-xref href="#arguments-exotic-object"><a href="https://tc39.es/ecma262/#arguments-exotic-object">arguments exotic object</a></emu-xref> <var>args</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
          <emu-alg><ol><li>Let <var>map</var> be <var>args</var>.<var class="field">[[ParameterMap]]</var>.</li><li>Let <var>isMapped</var> be !&nbsp;<emu-xref aoid="HasOwnProperty"><a href="https://tc39.es/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>map</var>, <var>P</var>).</li><li>If <var>isMapped</var> is <emu-val>false</emu-val>, then<ol><li>Return ?&nbsp;<emu-xref aoid="OrdinaryGet" id="_ref_149"><a href="#sec-ordinaryget" class="e-user-code">OrdinaryGet</a></emu-xref>(<var>args</var>, <var>P</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>map</var> contains a formal parameter mapping for <var>P</var>.</li><li>Return !&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>map</var>, <var>P</var>).</li></ol></li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-arguments-exotic-objects-set-p-v-receiver" type="internal method">
          <h1><span class="secnum">4.5.2.1.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Set]]</var> internal method of an <emu-xref href="#arguments-exotic-object"><a href="https://tc39.es/ecma262/#arguments-exotic-object">arguments exotic object</a></emu-xref> <var>args</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
          <emu-alg><ol><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>args</var>, <var>Receiver</var>) is <emu-val>false</emu-val>, then<ol><li>Let <var>isMapped</var> be <emu-val>false</emu-val>.</li></ol></li><li>Else,<ol><li>Let <var>map</var> be <var>args</var>.<var class="field">[[ParameterMap]]</var>.</li><li>Let <var>isMapped</var> be !&nbsp;<emu-xref aoid="HasOwnProperty"><a href="https://tc39.es/ecma262/#sec-hasownproperty">HasOwnProperty</a></emu-xref>(<var>map</var>, <var>P</var>).</li></ol></li><li>If <var>isMapped</var> is <emu-val>true</emu-val>, then<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: The following Set will succeed, since formal parameters mapped by arguments objects are always writable.</li><li>Perform !&nbsp;<emu-xref aoid="Set"><a href="https://tc39.es/ecma262/#sec-set-o-p-v-throw">Set</a></emu-xref>(<var>map</var>, <var>P</var>, <var>V</var>, <emu-val>false</emu-val>).</li></ol></li><li>Return ?&nbsp;<emu-xref aoid="OrdinarySet" id="_ref_150"><a href="#sec-ordinaryset" class="e-user-code">OrdinarySet</a></emu-xref>(<var>args</var>, <var>P</var>, <var>V</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-typedarray-exotic-objects" oldids="sec-integer-indexed-exotic-objects"><span id="sec-integer-indexed-exotic-objects"></span>
        <h1><span class="secnum">4.5.2.2</span> TypedArray Exotic Objects</h1>
        <emu-clause id="sec-typedarray-get" oldids="sec-integer-indexed-exotic-objects-get-p-receiver" type="internal method"><span id="sec-integer-indexed-exotic-objects-get-p-receiver"></span>
          <h1><span class="secnum">4.5.2.2.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Get]]</var> internal method of a <emu-xref href="#typedarray"><a href="https://tc39.es/ecma262/#typedarray">TypedArray</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
          <emu-alg><ol><li>If <var>P</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is a String</a></emu-xref>, then<ol><li>Let <var>numericIndex</var> be <emu-xref aoid="CanonicalNumericIndexString"><a href="https://tc39.es/ecma262/#sec-canonicalnumericindexstring">CanonicalNumericIndexString</a></emu-xref>(<var>P</var>).</li><li>If <var>numericIndex</var> is not <emu-val>undefined</emu-val>, then<ol><li>Return <emu-xref aoid="TypedArrayGetElement"><a href="https://tc39.es/ecma262/#sec-typedarraygetelement">TypedArrayGetElement</a></emu-xref>(<var>O</var>, <var>numericIndex</var>).</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="OrdinaryGet" id="_ref_151"><a href="#sec-ordinaryget" class="e-user-code">OrdinaryGet</a></emu-xref>(<var>O</var>, <var>P</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
        </emu-clause>

        <emu-clause id="sec-typedarray-set" oldids="sec-integer-indexed-exotic-objects-set-p-v-receiver" type="internal method"><span id="sec-integer-indexed-exotic-objects-set-p-v-receiver"></span>
          <h1><span class="secnum">4.5.2.2.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Set]]</var> internal method of a <emu-xref href="#typedarray"><a href="https://tc39.es/ecma262/#typedarray">TypedArray</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
          <emu-alg><ol><li>If <var>P</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is a String</a></emu-xref>, then<ol><li>Let <var>numericIndex</var> be <emu-xref aoid="CanonicalNumericIndexString"><a href="https://tc39.es/ecma262/#sec-canonicalnumericindexstring">CanonicalNumericIndexString</a></emu-xref>(<var>P</var>).</li><li>If <var>numericIndex</var> is not <emu-val>undefined</emu-val>, then<ol><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>O</var>, <var>Receiver</var>) is <emu-val>true</emu-val>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="TypedArraySetElement"><a href="https://tc39.es/ecma262/#sec-typedarraysetelement" class="e-user-code">TypedArraySetElement</a></emu-xref>(<var>O</var>, <var>numericIndex</var>, <var>V</var>).</li><li>Return <emu-val>true</emu-val>.</li></ol></li><li>If <emu-xref aoid="IsValidIntegerIndex"><a href="https://tc39.es/ecma262/#sec-isvalidintegerindex">IsValidIntegerIndex</a></emu-xref>(<var>O</var>, <var>numericIndex</var>) is <emu-val>false</emu-val>, return <emu-val>true</emu-val>.</li></ol></li></ol></li><li>Return ?&nbsp;<emu-xref aoid="OrdinarySet" id="_ref_152"><a href="#sec-ordinaryset" class="e-user-code">OrdinarySet</a></emu-xref>(<var>O</var>, <var>P</var>, <var>V</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-module-namespace-exotic-objects">
        <h1><span class="secnum">4.5.2.3</span> Module Namespace Exotic Objects</h1>
        <emu-clause id="sec-module-namespace-exotic-objects-get-p-receiver" type="internal method">
          <h1><span class="secnum">4.5.2.3.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Get]]</var> internal method of a <emu-xref href="#module-namespace-exotic-object"><a href="https://tc39.es/ecma262/#module-namespace-exotic-object">module namespace exotic object</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
          <emu-alg><ol><li>If <var>P</var> <emu-xref href="#sec-ecmascript-language-types-symbol-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-symbol-type">is a Symbol</a></emu-xref>, then<ol><li>Return !&nbsp;<emu-xref aoid="OrdinaryGet" id="_ref_153"><a href="#sec-ordinaryget">OrdinaryGet</a></emu-xref>(<var>O</var>, <var>P</var>, <var>Receiver</var><ins>, <var>unsafe</var></ins>).</li></ol></li><li>Let <var>exports</var> be <var>O</var>.<var class="field">[[Exports]]</var>.</li><li>If <var>exports</var> does not contain <var>P</var>, return <emu-val>undefined</emu-val>.</li><li>Let <var>m</var> be <var>O</var>.<var class="field">[[Module]]</var>.</li><li>Let <var>binding</var> be <var>m</var>.ResolveExport(<var>P</var>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>binding</var> is a <emu-xref href="#resolvedbinding-record"><a href="https://tc39.es/ecma262/#resolvedbinding-record">ResolvedBinding Record</a></emu-xref>.</li><li>Let <var>targetModule</var> be <var>binding</var>.<var class="field">[[Module]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>targetModule</var> is not <emu-val>undefined</emu-val>.</li><li>If <var>binding</var>.<var class="field">[[BindingName]]</var> is <emu-const>namespace</emu-const>, then<ol><li>Return <emu-xref aoid="GetModuleNamespace"><a href="https://tc39.es/ecma262/#sec-getmodulenamespace">GetModuleNamespace</a></emu-xref>(<var>targetModule</var>).</li></ol></li><li>Let <var>targetEnv</var> be <var>targetModule</var>.<var class="field">[[Environment]]</var>.</li><li>If <var>targetEnv</var> is <emu-const>empty</emu-const>, throw a <emu-val>ReferenceError</emu-val> exception.</li><li>Return ?&nbsp;<var>targetEnv</var>.GetBindingValue(<var>binding</var>.<var class="field">[[BindingName]]</var>, <emu-val>true</emu-val>).</li></ol></emu-alg>
          <emu-note><span class="note">Note</span><div class="note-contents">
            <p>ResolveExport is side-effect free. Each time this operation is called with a specific <var>exportName</var>, <var>resolveSet</var> pair as arguments it must return the same result. An implementation might choose to pre-compute or cache the ResolveExport results for the <var class="field">[[Exports]]</var> of each <emu-xref href="#module-namespace-exotic-object"><a href="https://tc39.es/ecma262/#module-namespace-exotic-object">module namespace exotic object</a></emu-xref>.</p>
          </div></emu-note>
        </emu-clause>

        <emu-clause id="sec-module-namespace-exotic-objects-set-p-v-receiver" type="internal method">
          <h1><span class="secnum">4.5.2.3.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
          <p>The <var class="field">[[Set]]</var> internal method of a <emu-xref href="#module-namespace-exotic-object"><a href="https://tc39.es/ecma262/#module-namespace-exotic-object">module namespace exotic object</a></emu-xref> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> <emu-val>false</emu-val>. It performs the following steps when called:</p>
          <emu-alg><ol><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-proxy-object-internal-methods-and-internal-slots">
      <h1><span class="secnum">4.5.3</span> Proxy Object Internal Methods and Internal Slots</h1>

      <emu-clause id="sec-proxy-object-internal-methods-and-internal-slots-get-p-receiver" type="internal method">
        <h1><span class="secnum">4.5.3.1</span> <var class="field">[[Get]]</var> ( <var>P</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The <var class="field">[[Get]]</var> internal method of a <emu-xref href="#proxy-exotic-object"><a href="https://tc39.es/ecma262/#proxy-exotic-object">Proxy exotic object</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="ValidateNonRevokedProxy"><a href="https://tc39.es/ecma262/#sec-validatenonrevokedproxy">ValidateNonRevokedProxy</a></emu-xref>(<var>O</var>).</li><li>Let <var>target</var> be <var>O</var>.<var class="field">[[ProxyTarget]]</var>.</li><li>Let <var>handler</var> be <var>O</var>.<var class="field">[[ProxyHandler]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>handler</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>Let <var>trap</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod" class="e-user-code">GetMethod</a></emu-xref>(<var>handler</var>, <emu-val>"get"</emu-val>).</li><li>If <var>trap</var> is <emu-val>undefined</emu-val>, then<ol><li>Return ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[Get]]</var></span>(<var>P</var>, <var>Receiver</var><ins>, <emu-val>true</emu-val></ins>).</li></ol></li><li>Let <var>trapResult</var> be ?&nbsp;<emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>trap</var>, <var>handler</var>, « <var>target</var>, <var>P</var>, <var>Receiver</var>&nbsp;»).</li><li>Let <var>targetDesc</var> be ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[GetOwnProperty]]</var></span>(<var>P</var>).</li><li>If <var>targetDesc</var> is not <emu-val>undefined</emu-val> and <var>targetDesc</var>.<var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>, then<ol><li>If <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>targetDesc</var>) is <emu-val>true</emu-val> and <var>targetDesc</var>.<var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, then<ol><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>trapResult</var>, <var>targetDesc</var>.<var class="field">[[Value]]</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>If <emu-xref aoid="IsAccessorDescriptor"><a href="https://tc39.es/ecma262/#sec-isaccessordescriptor">IsAccessorDescriptor</a></emu-xref>(<var>targetDesc</var>) is <emu-val>true</emu-val> and <var>targetDesc</var>.<var class="field">[[Get]]</var> is <emu-val>undefined</emu-val>, then<ol><li>If <var>trapResult</var> is not <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li></ol></li><li>Return <var>trapResult</var>.</li></ol></emu-alg>
        <emu-note><span class="note">Note 1</span><div class="note-contents">
          <p><var class="field">[[Get]]</var> for Proxy objects enforces the following invariants:</p>
          <ul>
            <li>
              The value reported for a property must be the same as the value of the corresponding target object property if the target object property is a non-writable, non-configurable own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref>.
            </li>
            <li>
              The value reported for a property must be <emu-val>undefined</emu-val> if the corresponding target object property is a non-configurable own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">accessor property</a></emu-xref> that has <emu-val>undefined</emu-val> as its <var class="field">[[Get]]</var> attribute.
            </li>
          </ul>
        </div></emu-note>
        <ins class="block">
        <emu-note><span class="note">Note 2</span><div class="note-contents">
          <p>Proxies are always unsafe and permit reading from fields on <emu-xref href="#shared-struct-exotic-object" id="_ref_154"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> instances even outside of an <code>unsafe {}</code> block.</p>
        </div></emu-note>
        </ins>
      </emu-clause>

      <emu-clause id="sec-proxy-object-internal-methods-and-internal-slots-set-p-v-receiver" type="internal method">
        <h1><span class="secnum">4.5.3.2</span> <var class="field">[[Set]]</var> ( <var>P</var>, <var>V</var>, <var>Receiver</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The <var class="field">[[Set]]</var> internal method of a <emu-xref href="#proxy-exotic-object"><a href="https://tc39.es/ecma262/#proxy-exotic-object">Proxy exotic object</a></emu-xref> <var>O</var> takes arguments <var>P</var> (a <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">property key</a></emu-xref>), <var>V</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>Receiver</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a Boolean or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="ValidateNonRevokedProxy"><a href="https://tc39.es/ecma262/#sec-validatenonrevokedproxy">ValidateNonRevokedProxy</a></emu-xref>(<var>O</var>).</li><li>Let <var>target</var> be <var>O</var>.<var class="field">[[ProxyTarget]]</var>.</li><li>Let <var>handler</var> be <var>O</var>.<var class="field">[[ProxyHandler]]</var>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>handler</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is an Object</a></emu-xref>.</li><li>Let <var>trap</var> be ?&nbsp;<emu-xref aoid="GetMethod"><a href="https://tc39.es/ecma262/#sec-getmethod" class="e-user-code">GetMethod</a></emu-xref>(<var>handler</var>, <emu-val>"set"</emu-val>).</li><li>If <var>trap</var> is <emu-val>undefined</emu-val>, then<ol><li>Return ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[Set]]</var></span>(<var>P</var>, <var>V</var>, <var>Receiver</var><ins>, <emu-val>true</emu-val></ins>).</li></ol></li><li>Let <var>booleanTrapResult</var> be <emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(? <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>trap</var>, <var>handler</var>, « <var>target</var>, <var>P</var>, <var>V</var>, <var>Receiver</var>&nbsp;»)).</li><li>If <var>booleanTrapResult</var> is <emu-val>false</emu-val>, return <emu-val>false</emu-val>.</li><li>Let <var>targetDesc</var> be ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[GetOwnProperty]]</var></span>(<var>P</var>).</li><li>If <var>targetDesc</var> is not <emu-val>undefined</emu-val> and <var>targetDesc</var>.<var class="field">[[Configurable]]</var> is <emu-val>false</emu-val>, then<ol><li>If <emu-xref aoid="IsDataDescriptor"><a href="https://tc39.es/ecma262/#sec-isdatadescriptor">IsDataDescriptor</a></emu-xref>(<var>targetDesc</var>) is <emu-val>true</emu-val> and <var>targetDesc</var>.<var class="field">[[Writable]]</var> is <emu-val>false</emu-val>, then<ol><li>If <emu-xref aoid="SameValue"><a href="https://tc39.es/ecma262/#sec-samevalue">SameValue</a></emu-xref>(<var>V</var>, <var>targetDesc</var>.<var class="field">[[Value]]</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>If <emu-xref aoid="IsAccessorDescriptor"><a href="https://tc39.es/ecma262/#sec-isaccessordescriptor">IsAccessorDescriptor</a></emu-xref>(<var>targetDesc</var>) is <emu-val>true</emu-val>, then<ol><li>If <var>targetDesc</var>.<var class="field">[[Set]]</var> is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li></ol></li><li>Return <emu-val>true</emu-val>.</li></ol></emu-alg>
        <emu-note><span class="note">Note 1</span><div class="note-contents">
          <p><var class="field">[[Set]]</var> for Proxy objects enforces the following invariants:</p>
          <ul>
            <li>
              The result of <var class="field">[[Set]]</var> <emu-xref href="#sec-ecmascript-language-types-boolean-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-boolean-type">is a Boolean</a></emu-xref> value.
            </li>
            <li>
              Cannot change the value of a property to be different from the value of the corresponding target object property if the corresponding target object property is a non-writable, non-configurable own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">data property</a></emu-xref>.
            </li>
            <li>
              Cannot set the value of a property if the corresponding target object property is a non-configurable own <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">accessor property</a></emu-xref> that has <emu-val>undefined</emu-val> as its <var class="field">[[Set]]</var> attribute.
            </li>
          </ul>
        </div></emu-note>
        <ins class="block">
          <emu-note><span class="note">Note 2</span><div class="note-contents">
            <p>Proxies are always unsafe and permit writing to fields on <emu-xref href="#shared-struct-exotic-object" id="_ref_155"><a href="#shared-struct-exotic-object">Shared Struct</a></emu-xref> instances even outside of an <code>unsafe {}</code> block.</p>
          </div></emu-note>
          </ins>
        </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-changes-to-ecmascript-language-expressions">
    <h1><span class="secnum">4.6</span> Changes to Expressions</h1>
    <emu-clause id="sec-left-hand-side-expressions">
      <h1><span class="secnum">4.6.1</span> Left-Hand-Side Expressions</h1>
      <emu-clause id="sec-property-accessors">
        <h1><span class="secnum">4.6.1.1</span> Property Accessors</h1>

        <emu-clause id="sec-property-accessors-runtime-semantics-evaluation" type="sdo">
          <h1><span class="secnum">4.6.1.1.1</span> Runtime Semantics: Evaluation</h1>
          <emu-grammar><emu-production name="MemberExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="a74xd7de">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>
        <emu-t>[</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>
        <emu-t>]</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_156"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_157"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return ?&nbsp;<emu-xref aoid="EvaluatePropertyAccessWithExpressionKey" id="_ref_158"><a href="#sec-evaluate-property-access-with-expression-key" class="e-user-code">EvaluatePropertyAccessWithExpressionKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="MemberExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="frbj984t">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_159"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_160"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return <emu-xref aoid="EvaluatePropertyAccessWithIdentifierKey" id="_ref_161"><a href="#sec-evaluate-property-access-with-identifier-key">EvaluatePropertyAccessWithIdentifierKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="MemberExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="0uk9afbi">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_162"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>fieldNameString</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li><li>Return <emu-xref aoid="MakePrivateReference"><a href="https://tc39.es/ecma262/#sec-makeprivatereference">MakePrivateReference</a></emu-xref>(<var>baseValue</var>, <var>fieldNameString</var>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="CallExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="2u2urbmg">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>
        <emu-t>[</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>
        <emu-t>]</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_163"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_164"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return ?&nbsp;<emu-xref aoid="EvaluatePropertyAccessWithExpressionKey" id="_ref_165"><a href="#sec-evaluate-property-access-with-expression-key" class="e-user-code">EvaluatePropertyAccessWithExpressionKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="CallExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="u6lsbvgu">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_166"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_167"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return <emu-xref aoid="EvaluatePropertyAccessWithIdentifierKey" id="_ref_168"><a href="#sec-evaluate-property-access-with-identifier-key">EvaluatePropertyAccessWithIdentifierKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="CallExpression" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="cysjk9wh">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>baseReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-CallExpression">CallExpression</a></emu-nt>.</li><li>Let <var>baseValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_169"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>baseReference</var>).</li><li>Let <var>fieldNameString</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li><li>Return <emu-xref aoid="MakePrivateReference"><a href="https://tc39.es/ecma262/#sec-makeprivatereference">MakePrivateReference</a></emu-xref>(<var>baseValue</var>, <var>fieldNameString</var>).</li></ol></emu-alg>
        </emu-clause>
      </emu-clause>

      <emu-clause id="sec-evaluate-property-access-with-expression-key" type="abstract operation" oldids="sec-evaluate-expression-key-property-access" aoid="EvaluatePropertyAccessWithExpressionKey"><span id="sec-evaluate-expression-key-property-access"></span>
        <h1><span class="secnum">4.6.1.2</span> EvaluatePropertyAccessWithExpressionKey ( <var>baseValue</var>, <var>expression</var>, <var>strict</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The abstract operation EvaluatePropertyAccessWithExpressionKey takes arguments <var>baseValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>expression</var> (an <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt> <emu-xref href="#sec-syntactic-grammar"><a href="https://tc39.es/ecma262/#sec-syntactic-grammar">Parse Node</a></emu-xref>), <var>strict</var> (a Boolean), and <ins><var>unsafe</var> (a Boolean)</ins> and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-reference-record-specification-type" id="_ref_170"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>Let <var>propertyNameReference</var> be ?&nbsp;<emu-xref aoid="Evaluation"><a href="https://tc39.es/ecma262/#sec-evaluation" class="e-user-code">Evaluation</a></emu-xref> of <var>expression</var>.</li><li>Let <var>propertyNameValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_171"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>propertyNameReference</var>).</li><li>Let <var>propertyKey</var> be ?&nbsp;<emu-xref aoid="ToPropertyKey"><a href="https://tc39.es/ecma262/#sec-topropertykey" class="e-user-code">ToPropertyKey</a></emu-xref>(<var>propertyNameValue</var>).</li><li>Return the <emu-xref href="#sec-reference-record-specification-type" id="_ref_172"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> { <var class="field">[[Base]]</var>: <var>baseValue</var>, <var class="field">[[ReferencedName]]</var>: <var>propertyKey</var>, <var class="field">[[Strict]]</var>: <var>strict</var><ins>, <var class="field">[[Unsafe]]</var>: <var>unsafe</var></ins>, <var class="field">[[ThisValue]]</var>: <emu-const>empty</emu-const>&nbsp;}.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-evaluate-property-access-with-identifier-key" type="abstract operation" oldids="sec-evaluate-identifier-key-property-access" aoid="EvaluatePropertyAccessWithIdentifierKey"><span id="sec-evaluate-identifier-key-property-access"></span>
        <h1><span class="secnum">4.6.1.3</span> EvaluatePropertyAccessWithIdentifierKey ( <var>baseValue</var>, <var>identifierName</var>, <var>strict</var>, <ins><var>unsafe</var></ins> )</h1>
        <p>The abstract operation EvaluatePropertyAccessWithIdentifierKey takes arguments <var>baseValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>), <var>identifierName</var> (an <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt> <emu-xref href="#sec-syntactic-grammar"><a href="https://tc39.es/ecma262/#sec-syntactic-grammar">Parse Node</a></emu-xref>), <var>strict</var> (a Boolean), and <ins><var>unsafe</var> (a Boolean)</ins> and returns a <emu-xref href="#sec-reference-record-specification-type" id="_ref_173"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref>. It performs the following steps when called:</p>
        <emu-alg><ol><li>Let <var>propertyNameString</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <var>identifierName</var>.</li><li>Return the <emu-xref href="#sec-reference-record-specification-type" id="_ref_174"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref> { <var class="field">[[Base]]</var>: <var>baseValue</var>, <var class="field">[[ReferencedName]]</var>: <var>propertyNameString</var>, <var class="field">[[Strict]]</var>: <var>strict</var><ins>, <var class="field">[[Unsafe]]</var>: <var>unsafe</var></ins>, <var class="field">[[ThisValue]]</var>: <emu-const>empty</emu-const>&nbsp;}.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-optional-chains">
        <h1><span class="secnum">4.6.1.4</span> Optional Chains</h1>

        <emu-clause id="sec-optional-chaining-evaluation" type="sdo">
          <h1><span class="secnum">4.6.1.4.1</span> Runtime Semantics: Evaluation</h1>

          <emu-clause id="sec-optional-chaining-chain-evaluation" type="sdo" aoid="ChainEvaluation">
          <h1><span class="secnum">4.6.1.4.1.1</span> Runtime Semantics: ChainEvaluation</h1>
          <p>The <emu-xref href="#sec-algorithm-conventions-syntax-directed-operations"><a href="https://tc39.es/ecma262/#sec-algorithm-conventions-syntax-directed-operations">syntax-directed operation</a></emu-xref> ChainEvaluation takes arguments <var>baseValue</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and <var>baseReference</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-reference-record-specification-type" id="_ref_175"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> either an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref> or a <emu-xref href="#sec-reference-record-specification-type" id="_ref_176"><a href="#sec-reference-record-specification-type">Reference Record</a></emu-xref>, or an <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">abrupt completion</a></emu-xref>. It is defined piecewise over the following productions:</p>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="ynxeowdb">
        <emu-t>?.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>thisChain</var> be this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>tailCall</var> be <emu-xref aoid="IsInTailPosition"><a href="https://tc39.es/ecma262/#sec-isintailposition">IsInTailPosition</a></emu-xref>(<var>thisChain</var>).</li><li>Return ?&nbsp;<emu-xref aoid="EvaluateCall"><a href="https://tc39.es/ecma262/#sec-evaluatecall" class="e-user-code">EvaluateCall</a></emu-xref>(<var>baseValue</var>, <var>baseReference</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>, <var>tailCall</var>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="kktyttw7">
        <emu-t>?.</emu-t>
        <emu-t>[</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>
        <emu-t>]</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_177"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return ?&nbsp;<emu-xref aoid="EvaluatePropertyAccessWithExpressionKey" id="_ref_178"><a href="#sec-evaluate-property-access-with-expression-key" class="e-user-code">EvaluatePropertyAccessWithExpressionKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="w-4ch2am">
        <emu-t>?.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_179"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return <emu-xref aoid="EvaluatePropertyAccessWithIdentifierKey" id="_ref_180"><a href="#sec-evaluate-property-access-with-identifier-key">EvaluatePropertyAccessWithIdentifierKey</a></emu-xref>(<var>baseValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="0xlnjlpz">
        <emu-t>?.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>fieldNameString</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li><li>Return <emu-xref aoid="MakePrivateReference"><a href="https://tc39.es/ecma262/#sec-makeprivatereference">MakePrivateReference</a></emu-xref>(<var>baseValue</var>, <var>fieldNameString</var>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="eogoekck">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>optionalChain</var> be <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>newReference</var> be ?&nbsp;<emu-xref aoid="ChainEvaluation" id="_ref_181"><a href="#sec-optional-chaining-chain-evaluation" class="e-user-code">ChainEvaluation</a></emu-xref> of <var>optionalChain</var> with arguments <var>baseValue</var> and <var>baseReference</var>.</li><li>Let <var>newValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_182"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>newReference</var>).</li><li>Let <var>thisChain</var> be this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>tailCall</var> be <emu-xref aoid="IsInTailPosition"><a href="https://tc39.es/ecma262/#sec-isintailposition">IsInTailPosition</a></emu-xref>(<var>thisChain</var>).</li><li>Return ?&nbsp;<emu-xref aoid="EvaluateCall"><a href="https://tc39.es/ecma262/#sec-evaluatecall" class="e-user-code">EvaluateCall</a></emu-xref>(<var>newValue</var>, <var>newReference</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Arguments">Arguments</a></emu-nt>, <var>tailCall</var>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="jgl-kve-">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>
        <emu-t>[</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>
        <emu-t>]</emu-t>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>optionalChain</var> be <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>newReference</var> be ?&nbsp;<emu-xref aoid="ChainEvaluation" id="_ref_183"><a href="#sec-optional-chaining-chain-evaluation" class="e-user-code">ChainEvaluation</a></emu-xref> of <var>optionalChain</var> with arguments <var>baseValue</var> and <var>baseReference</var>.</li><li>Let <var>newValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_184"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>newReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_185"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return ?&nbsp;<emu-xref aoid="EvaluatePropertyAccessWithExpressionKey" id="_ref_186"><a href="#sec-evaluate-property-access-with-expression-key" class="e-user-code">EvaluatePropertyAccessWithExpressionKey</a></emu-xref>(<var>newValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-Expression">Expression</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="lf2imwfr">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>optionalChain</var> be <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>newReference</var> be ?&nbsp;<emu-xref aoid="ChainEvaluation" id="_ref_187"><a href="#sec-optional-chaining-chain-evaluation" class="e-user-code">ChainEvaluation</a></emu-xref> of <var>optionalChain</var> with arguments <var>baseValue</var> and <var>baseReference</var>.</li><li>Let <var>newValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_188"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>newReference</var>).</li><li>Let <var>strict</var> be <emu-xref aoid="IsStrict"><a href="https://tc39.es/ecma262/#sec-isstrict">IsStrict</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>).</li><li><ins>Let <var>unsafe</var> be <emu-xref aoid="IsUnsafe" id="_ref_189"><a href="#sec-isunsafe">IsUnsafe</a></emu-xref>(this <emu-nt><a href="https://tc39.es/ecma262/#prod-MemberExpression">MemberExpression</a></emu-nt>).</ins></li><li>Return <emu-xref aoid="EvaluatePropertyAccessWithIdentifierKey" id="_ref_190"><a href="#sec-evaluate-property-access-with-identifier-key">EvaluatePropertyAccessWithIdentifierKey</a></emu-xref>(<var>newValue</var>, <emu-nt><a href="https://tc39.es/ecma262/#prod-IdentifierName">IdentifierName</a></emu-nt>, <var>strict</var><ins>, <var>unsafe</var></ins>).</li></ol></emu-alg>
          <emu-grammar><emu-production name="OptionalChain" collapsed="">
    <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt> <emu-geq>:</emu-geq> <emu-rhs a="dnp-fbqk">
        <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>
        <emu-t>.</emu-t>
        <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>
    </emu-rhs>
</emu-production>
</emu-grammar>
          <emu-alg><ol><li>Let <var>optionalChain</var> be <emu-nt><a href="https://tc39.es/ecma262/#prod-OptionalChain">OptionalChain</a></emu-nt>.</li><li>Let <var>newReference</var> be ?&nbsp;<emu-xref aoid="ChainEvaluation" id="_ref_191"><a href="#sec-optional-chaining-chain-evaluation" class="e-user-code">ChainEvaluation</a></emu-xref> of <var>optionalChain</var> with arguments <var>baseValue</var> and <var>baseReference</var>.</li><li>Let <var>newValue</var> be ?&nbsp;<emu-xref aoid="GetValue" id="_ref_192"><a href="#sec-getvalue" class="e-user-code">GetValue</a></emu-xref>(<var>newReference</var>).</li><li>Let <var>fieldNameString</var> be the <emu-xref aoid="StringValue"><a href="https://tc39.es/ecma262/#sec-static-semantics-stringvalue">StringValue</a></emu-xref> of <emu-nt><a href="https://tc39.es/ecma262/#prod-PrivateIdentifier">PrivateIdentifier</a></emu-nt>.</li><li>Return <emu-xref aoid="MakePrivateReference"><a href="https://tc39.es/ecma262/#sec-makeprivatereference">MakePrivateReference</a></emu-xref>(<var>newValue</var>, <var>fieldNameString</var>).</li></ol></emu-alg>
        </emu-clause>
        </emu-clause>
      </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="changes-to-reflection">
    <h1><span class="secnum">4.7</span> Changes to Reflection</h1>
    <emu-clause id="sec-reflect-object">
      <h1><span class="secnum">4.7.1</span> The Reflect Object</h1>
      <emu-clause id="sec-reflect.get">
        <h1><span class="secnum">4.7.1.1</span> Reflect.get ( <var>target</var>, <var>propertyKey</var> [ , <var>receiver</var> ] )</h1>
        <p>This function performs the following steps when called:</p>
        <emu-alg><ol><li>If <var>target</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>key</var> be ?&nbsp;<emu-xref aoid="ToPropertyKey"><a href="https://tc39.es/ecma262/#sec-topropertykey" class="e-user-code">ToPropertyKey</a></emu-xref>(<var>propertyKey</var>).</li><li>If <var>receiver</var> is not present, then<ol><li>Set <var>receiver</var> to <var>target</var>.</li></ol></li><li>Return ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[Get]]</var></span>(<var>key</var>, <var>receiver</var><ins>, <emu-val>true</emu-val></ins>).</li></ol></emu-alg>
      </emu-clause>
      <emu-clause id="sec-reflect.set">
        <h1><span class="secnum">4.7.1.2</span> Reflect.set ( <var>target</var>, <var>propertyKey</var>, <var>V</var> [ , <var>receiver</var> ] )</h1>
        <p>This function performs the following steps when called:</p>
        <emu-alg><ol><li>If <var>target</var> <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">is not an Object</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>key</var> be ?&nbsp;<emu-xref aoid="ToPropertyKey"><a href="https://tc39.es/ecma262/#sec-topropertykey" class="e-user-code">ToPropertyKey</a></emu-xref>(<var>propertyKey</var>).</li><li>If <var>receiver</var> is not present, then<ol><li>Set <var>receiver</var> to <var>target</var>.</li></ol></li><li>Return ?&nbsp;<span class="e-user-code"><var>target</var>.<var class="field">[[Set]]</var></span>(<var>key</var>, <var>V</var>, <var>receiver</var><ins>, <emu-val>true</emu-val></ins>).</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>
</emu-clause>

<emu-clause id="sec-synchronization-primitives">
  <h1><span class="secnum">5</span> Synchronization Primitives</h1>
  <p>Mutexes and condition variables are provided as higher level abstractions, as an easier to use alternative to user-built abstractions on top of Atomics.wait and Atomics.notify. They are <emu-xref href="#shared-struct-exotic-object" id="_ref_193"><a href="#shared-struct-exotic-object">Shared Structs</a></emu-xref> with no fields.</p>

  <ins class="block">
  <emu-clause id="sec-abstract-operations-for-mutex">
    <h1><span class="secnum">5.1</span> Abstract Operations for Mutex Objects</h1>

    <emu-clause id="sec-unlocktokencreateifneeded" type="abstract operation" aoid="UnlockTokenCreateIfNeeded">
      <h1><span class="secnum">5.1.1</span> UnlockTokenCreateIfNeeded ( <var>token</var>, <var>mutex</var> )</h1>
      <p>The abstract operation UnlockTokenCreateIfNeeded takes arguments <var>token</var> (an Object or <emu-val>undefined</emu-val>) and <var>mutex</var> (an Object) and returns an Object. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>mutex</var> has a <var class="field">[[MutexWaiterList]]</var> internal slot.</li><li>If <var>token</var> is <emu-val>undefined</emu-val>, then<ol><li>Set <var>token</var> to <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-the-unlocktoken-prototype" id="_ref_194"><a href="#sec-properties-of-the-unlocktoken-prototype">%Atomics.Mutex.UnlockToken.prototype%</a></emu-xref>, « <var class="field">[[LockedMutex]]</var>&nbsp;»).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>token</var> has a <var class="field">[[LockedMutex]]</var> internal slot.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>token</var>.<var class="field">[[LockedMutex]]</var> is <emu-const>empty</emu-const>.</li></ol></li><li>Set <var>token</var>.<var class="field">[[LockedMutex]]</var> to <var>mutex</var>.</li><li>Return <var>token</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-lockmutex" type="abstract operation" aoid="LockMutex">
      <h1><span class="secnum">5.1.2</span> LockMutex ( <var>mutex</var>, <var>tMillis</var> )</h1>
      <p>The abstract operation LockMutex takes arguments <var>mutex</var> (an Object) and <var>tMillis</var> (a <emu-xref href="#mathematical-value"><a href="https://tc39.es/ecma262/#mathematical-value">mathematical value</a></emu-xref>) and returns <emu-const>acquired</emu-const>, <emu-const>deadlock</emu-const>, or <emu-const>timed-out</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>mutex</var> has a <var class="field">[[MutexWaiterList]]</var> internal slot.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: If <var>tMillis</var> is not 0, <emu-xref aoid="AgentCanSuspend"><a href="https://tc39.es/ecma262/#sec-agentcansuspend">AgentCanSuspend</a></emu-xref>() is <emu-val>true</emu-val>.</li><li>Let <var>thisAgent</var> be <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>WL</var> be <var>mutex</var>.<var class="field">[[MutexWaiterList]]</var>.</li><li>Perform <emu-xref aoid="EnterCriticalSection"><a href="https://tc39.es/ecma262/#sec-entercriticalsection">EnterCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>If <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> is <emu-const>empty</emu-const>, then<ol><li>Set <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> to <var>thisAgent</var>.</li><li>Let <var>result</var> be <emu-const>acquired</emu-const>.</li></ol></li><li>Else if <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> is <var>thisAgent</var>, then<ol><li>Let <var>result</var> be <emu-const>deadlock</emu-const>.</li></ol></li><li>Else,<ol><li>If <var>tMillis</var> is 0, return <emu-const>timed-out</emu-const>.</li><li>Let <var>now</var> be the <emu-xref href="#sec-time-values-and-time-range"><a href="https://tc39.es/ecma262/#sec-time-values-and-time-range">time value</a></emu-xref> (UTC) identifying the current time.</li><li>Let <var>additionalTimeout</var> be an <emu-xref href="#implementation-defined"><a href="https://tc39.es/ecma262/#implementation-defined">implementation-defined</a></emu-xref> non-negative <emu-xref href="#mathematical-value"><a href="https://tc39.es/ecma262/#mathematical-value">mathematical value</a></emu-xref>.</li><li>Let <var>timeoutTime</var> be <emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>now</var>) + <var>tMillis</var> + <var>additionalTimeout</var>.</li><li>NOTE: When <var>tMillis</var> is +∞, <var>timeoutTime</var> is also +∞.</li><li>Let <var>done</var> be <emu-val>false</emu-val>.</li><li>Repeat, while <var>done</var> is <emu-val>false</emu-val>,<ol><li>Let <var>waiterRecord</var> be a new <emu-xref href="#sec-waiter-record"><a href="https://tc39.es/ecma262/#sec-waiter-record">Waiter Record</a></emu-xref> { <var class="field">[[AgentSignifier]]</var>: <var>thisAgent</var>, <var class="field">[[PromiseCapability]]</var>: <emu-const>blocking</emu-const>, <var class="field">[[TimeoutTime]]</var>: <var>timeoutTime</var>, <var class="field">[[Result]]</var>: <emu-val>"ok"</emu-val>&nbsp;}.</li><li>Perform <emu-xref aoid="AddWaiter"><a href="https://tc39.es/ecma262/#sec-addwaiter">AddWaiter</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>Perform <emu-xref aoid="SuspendThisAgent"><a href="https://tc39.es/ecma262/#sec-suspendthisagent">SuspendThisAgent</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>If <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> is <emu-const>empty</emu-const>, then<ol><li>Set <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> to <var>thisAgent</var>.</li><li>Set <var>waiterRecord</var>.<var class="field">[[Result]]</var> to <emu-val>"ok"</emu-val>.</li><li>Set <var>done</var> to <emu-val>true</emu-val>.</li></ol></li><li>Else if <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"timed-out"</emu-val>, then<ol><li>Set <var>done</var> to <emu-val>true</emu-val>.</li></ol></li></ol></li><li>If <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"ok"</emu-val>, then<ol><li>Let <var>result</var> be <emu-const>acquired</emu-const>.</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"timed-out"</emu-val>.</li><li>Let <var>result</var> be <emu-const>timed-out</emu-const>.</li></ol></li></ol></li><li>Perform <emu-xref aoid="LeaveCriticalSection"><a href="https://tc39.es/ecma262/#sec-leavecriticalsection">LeaveCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Return <var>result</var>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-unlockmutex" type="abstract operation" aoid="UnlockMutex">
      <h1><span class="secnum">5.1.3</span> UnlockMutex ( <var>mutex</var> )</h1>
      <p>The abstract operation UnlockMutex takes argument <var>mutex</var> (an Object) and returns <emu-const>unused</emu-const>. It performs the following steps when called:</p>
      <emu-alg><ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>mutex</var> has a <var class="field">[[MutexWaiterList]]</var> internal slot.</li><li>Let <var>WL</var> be <var>mutex</var>.<var class="field">[[MutexWaiterList]]</var>.</li><li>Perform <emu-xref aoid="EnterCriticalSection"><a href="https://tc39.es/ecma262/#sec-entercriticalsection">EnterCriticalSection</a></emu-xref>(<var>WL</var>).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> is <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Set <var>mutex</var>.<var class="field">[[IsLockedBy]]</var> to <emu-const>empty</emu-const>.</li><li>Let <var>S</var> be <emu-xref aoid="RemoveWaiters"><a href="https://tc39.es/ecma262/#sec-removewaiters">RemoveWaiters</a></emu-xref>(<var>WL</var>, 1).</li><li>For each element <var>W</var> of <var>S</var>, do<ol><li>Perform <emu-xref aoid="NotifyWaiter"><a href="https://tc39.es/ecma262/#sec-notifywaiter">NotifyWaiter</a></emu-xref>(<var>WL</var>, <var>W</var>).</li></ol></li><li>Perform <emu-xref aoid="LeaveCriticalSection"><a href="https://tc39.es/ecma262/#sec-leavecriticalsection">LeaveCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Return <emu-const>unused</emu-const>.</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-mutex-object">
    <h1><span class="secnum">5.2</span> The Mutex Constructor</h1>
    <p>The Mutex <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>is <dfn tabindex="-1">%Atomics.Mutex%</dfn>.</li>
      <li>is the initial value of the <emu-val>"Mutex"</emu-val> property of the <emu-xref href="#sec-atomics-object"><a href="https://tc39.es/ecma262/#sec-atomics-object">%Atomics%</a></emu-xref> object.</li>
      <li>creates and initializes a new Mutex when called as <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
      <li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
    </ul>

    <emu-clause id="sec-atomics.mutex">
      <h1><span class="secnum">5.2.1</span> Atomics.Mutex ( )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>createInitializer</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with parameters (<var>newMutex</var>) that captures nothing and performs the following steps when called:<ol><li>Set <var>newMutex</var>.<var class="field">[[MutexWaiterList]]</var> to a new <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">WaiterList Record</a></emu-xref>.</li><li>Set <var>newMutex</var>.<var class="field">[[IsLockedBy]]</var> to <emu-const>empty</emu-const>.</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>Return <emu-xref aoid="SharedStructCreate" id="_ref_195"><a href="#sec-sharedstructcreate">SharedStructCreate</a></emu-xref>(<var>createInitializer</var>, « <var class="field">[[MutexWaiterList]]</var>, <var class="field">[[IsLockedBy]]</var>&nbsp;»).</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-properties-of-the-mutex-constructor">
    <h1><span class="secnum">5.3</span> Properties of the Mutex Constructor</h1>
    <p>The Mutex <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>has a <var class="field">[[Prototype]]</var> internal slot whose value is <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li>
      <li>has the following properties:</li>
    </ul>

    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will give Mutexes a per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype with built-in methods instead of static methods.</p>
    </div></emu-note>

    <emu-clause id="sec-atomics.mutex.unlocktoken-prop">
      <h1><span class="secnum">5.3.1</span> Atomics.Mutex.UnlockToken ( )</h1>
      <p>See <emu-xref href="#sec-atomics.mutex.unlocktoken" id="_ref_14"><a href="#sec-atomics.mutex.unlocktoken">5.4.1.1</a></emu-xref>.</p>
    </emu-clause>

    <emu-clause id="sec-atomics.mutex.lock">
      <h1><span class="secnum">5.3.2</span> Atomics.Mutex.lock ( <var>mutex</var> [ , <var>unlockToken</var> ] )</h1>
      <p>This function puts the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> in a wait queue and suspends it until the mutex is unlocked.</p>
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>mutex</var>, <var class="field">[[MutexWaiterList]]</var>).</li><li>If <var>unlockToken</var> not <emu-val>undefined</emu-val>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>unlockToken</var>, <var class="field">[[LockedMutex]]</var>).</li><li>If <var>unlockToken</var>.<var class="field">[[LockedMutex]]</var> is not <emu-const>empty</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>If <emu-xref aoid="AgentCanSuspend"><a href="https://tc39.es/ecma262/#sec-agentcansuspend">AgentCanSuspend</a></emu-xref>() is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be <emu-xref aoid="LockMutex" id="_ref_196"><a href="#sec-lockmutex">LockMutex</a></emu-xref>(<var>mutex</var>, +∞).</li><li>If <var>result</var> is <emu-const>deadlock</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>result</var> is <emu-const>acquired</emu-const>.</li><li>Return <emu-xref aoid="UnlockTokenCreateIfNeeded" id="_ref_197"><a href="#sec-unlocktokencreateifneeded">UnlockTokenCreateIfNeeded</a></emu-xref>(<var>unlockToken</var>, <var>mutex</var>).</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.mutex.lockifavailable">
      <h1><span class="secnum">5.3.3</span> Atomics.Mutex.lockIfAvailable ( <var>mutex</var>, <var>timeout</var> [ , <var>unlockToken</var> ] )</h1>
      <p>This function puts the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> in a wait queue and suspends it until the mutex is unlocked, or until the wait times out. If <var>timeout</var> is 0, this function can be called in <emu-xref href="#agent"><a href="https://tc39.es/ecma262/#agent">agents</a></emu-xref> that cannot suspend.</p>
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>mutex</var>, <var class="field">[[MutexWaiterList]]</var>).</li><li>If <var>unlockToken</var> not <emu-val>undefined</emu-val>, then<ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>unlockToken</var>, <var class="field">[[LockedMutex]]</var>).</li><li>If <var>unlockToken</var>.<var class="field">[[LockedMutex]]</var> is not <emu-const>empty</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li></ol></li><li>If <var>timeout</var> <emu-xref href="#sec-ecmascript-language-types-number-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-number-type">is not a Number</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>timeout</var> is either <emu-val>NaN</emu-val> or <emu-val>+∞</emu-val><sub>𝔽</sub>, let <var>tMillis</var> be +∞; else if <var>timeout</var> is <emu-val>-∞</emu-val><sub>𝔽</sub>, let <var>tMillis</var> be 0; else let <var>tMillis</var> be <emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(<emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>timeout</var>), 0).</li><li>If <var>tMillis</var> is not 0 and <emu-xref aoid="AgentCanSuspend"><a href="https://tc39.es/ecma262/#sec-agentcansuspend">AgentCanSuspend</a></emu-xref>() is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>result</var> be <emu-xref aoid="LockMutex" id="_ref_198"><a href="#sec-lockmutex">LockMutex</a></emu-xref>(<var>mutex</var>, <var>tMillis</var>).</li><li>If <var>result</var> is <emu-const>deadlock</emu-const>, then<ol><li>Throw <emu-val>TypeError</emu-val> exception.</li></ol></li><li>Else if <var>result</var> is <emu-const>acquired</emu-const>, then<ol><li>Return <emu-xref aoid="UnlockTokenCreateIfNeeded" id="_ref_199"><a href="#sec-unlocktokencreateifneeded">UnlockTokenCreateIfNeeded</a></emu-xref>(<var>unlockToken</var>, <var>mutex</var>).</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>result</var> is <emu-const>timed-out</emu-const>.</li><li>Return <emu-val>null</emu-val>.</li><li>NOTE: The return value of the timed-out case is an open design question. Specifically, whether the return value ought to throw when attempted to be used with the <code>using</code> syntax.</li></ol></li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-unlocktoken-objects">
    <h1><span class="secnum">5.4</span> UnlockToken Objects</h1>
    <p>An UnlockToken is the unlock capability returned when a Mutex's lock is acquired. It can be reused. An uninitialized UnlockToken can be created by using the Atomics.Mutex.UnlockToken <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</p>

    <emu-clause id="sec-unlocktoken-constructor">
      <h1><span class="secnum">5.4.1</span> The UnlockToken Constructor</h1>
      <p>The UnlockToken <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
      <ul>
        <li>is <dfn tabindex="-1">%Atomics.Mutex.UnlockToken%</dfn>.</li>
        <li>is the initial value of the <emu-val>"UnlockToken"</emu-val> property of the <emu-xref href="#sec-mutex-object" id="_ref_200"><a href="#sec-mutex-object">%Atomics.Mutex%</a></emu-xref> object.</li>
        <li>creates and initializes a new UnlockToken when called as a <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
        <li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
      </ul>

      <emu-clause id="sec-atomics.mutex.unlocktoken">
        <h1><span class="secnum">5.4.1.1</span> Atomics.Mutex.UnlockToken ( )</h1>
        <p>This function performs the following steps when called:</p>
        <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>token</var> be <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-xref href="#sec-properties-of-the-unlocktoken-prototype" id="_ref_201"><a href="#sec-properties-of-the-unlocktoken-prototype">%Atomics.Mutex.UnlockToken.prototype%</a></emu-xref>, « <var class="field">[[LockedMutex]]</var>&nbsp;»).</li><li>Set <var>token</var>.<var class="field">[[LockedMutex]]</var> to <emu-const>empty</emu-const>.</li><li>Return <var>token</var>.</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-properties-of-the-unlocktoken-constructor">
      <h1><span class="secnum">5.4.2</span> Properties of the UnlockToken Constructor</h1>
      <p>The UnlockToken <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
      <ul>
        <li>has a <var class="field">[[Prototype]]</var> internal slot whose value is <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li>
        <li>has the following properties:</li>
      </ul>

      <emu-clause id="sec-atomics.mutex.unlocktoken.prototype">
        <h1><span class="secnum">5.4.2.1</span> Atomics.Mutex.UnlockToken.prototype</h1>
        <p>The initial value of <code>Atomics.Mutex.UnlockToken.prototype</code> is the <emu-xref href="#sec-properties-of-the-unlocktoken-prototype" id="_ref_202"><a href="#sec-properties-of-the-unlocktoken-prototype">UnlockToken prototype</a></emu-xref> object.</p>
        <p>This property has the attributes { <var class="field">[[Writable]]</var>: <emu-val>false</emu-val>, <var class="field">[[Enumerable]]</var>: <emu-val>false</emu-val>, <var class="field">[[Configurable]]</var>: <emu-val>false</emu-val> }.</p>
      </emu-clause>
    </emu-clause>

    <emu-clause id="sec-properties-of-the-unlocktoken-prototype">
      <h1><span class="secnum">5.4.3</span> Properties of the UnlockToken Prototype Object</h1>
      <p>The <dfn tabindex="-1">UnlockToken prototype</dfn> object:</p>
      <ul>
        <li>is <dfn tabindex="-1">%Atomics.Mutex.UnlockToken.prototype%</dfn>.</li>
        <li>has a <var class="field">[[Prototype]]</var> internal slot whose value is <emu-xref href="#sec-properties-of-the-object-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-object-prototype-object">%Object.prototype%</a></emu-xref>.</li>
        <li>is an <emu-xref href="#ordinary-object"><a href="https://tc39.es/ecma262/#ordinary-object">ordinary object</a></emu-xref>.</li>
        <li>does not have a <var class="field">[[LockedMutex]]</var> internal slot.</li>
        <li>has the following properties:</li>
      </ul>

      <emu-clause id="sec-get-atomics.mutex.unlocktoken.prototype.locked">
        <h1><span class="secnum">5.4.3.1</span> get Atomics.Mutex.UnlockToken.prototype.locked</h1>
        <p><code>Atomics.Mutex.UnlockToken.locked</code> is an <emu-xref href="#sec-object-type"><a href="https://tc39.es/ecma262/#sec-object-type">accessor property</a></emu-xref> whose set accessor is <emu-val>undefined</emu-val>. Its get accessor function performs the following steps when called:</p>
        <emu-alg><ol><li>Let <var>token</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>token</var>, <var class="field">[[LockedMutex]]</var>).</li><li>If <var>token</var>.<var class="field">[[LockedMutex]]</var> is <emu-const>empty</emu-const>, return <emu-val>false</emu-val>; else return <emu-val>true</emu-val>.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-atomics.mutex.unlocktoken.prototype.unlock">
        <h1><span class="secnum">5.4.3.2</span> Atomics.Mutex.UnlockToken.prototype.unlock ( )</h1>
        <p>This function performs the following steps when called:</p>
        <emu-alg><ol><li>Let <var>token</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>token</var>, <var class="field">[[LockedMutex]]</var>).</li><li>Let <var>mutex</var> be <var>token</var>.<var class="field">[[LockedMutex]]</var>.</li><li>If <var>mutex</var> is not <emu-const>empty</emu-const>, then<ol><li>Set <var>token</var>.<var class="field">[[LockedMutex]]</var> to <emu-const>empty</emu-const>.</li><li>Perform <emu-xref aoid="UnlockMutex" id="_ref_203"><a href="#sec-unlockmutex">UnlockMutex</a></emu-xref>(<var>mutex</var>).</li><li>Return <emu-val>true</emu-val>.</li></ol></li><li>Return <emu-val>false</emu-val>.</li></ol></emu-alg>
      </emu-clause>

      <emu-clause id="sec-atomics.mutex.unlocktoken.prototype.%symbol.dispose%">
        <h1><span class="secnum">5.4.3.3</span> Atomics.Mutex.UnlockToken.prototype [ %Symbol.dispose% ] ( )</h1>
        <p>This function performs the following steps when called:</p>
        <emu-alg><ol><li>Let <var>token</var> be the <emu-val>this</emu-val> value.</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>token</var>, <var class="field">[[LockedMutex]]</var>).</li><li>Let <var>mutex</var> be <var>token</var>.<var class="field">[[LockedMutex]]</var>.</li><li>If <var>mutex</var> is not <emu-const>empty</emu-const>, then<ol><li>Set <var>token</var>.<var class="field">[[LockedMutex]]</var> to <emu-const>empty</emu-const>.</li><li>Perform <emu-xref aoid="UnlockMutex" id="_ref_204"><a href="#sec-unlockmutex">UnlockMutex</a></emu-xref>(<var>mutex</var>).</li></ol></li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
      </emu-clause>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-condition-object">
    <h1><span class="secnum">5.5</span> The Condition Constructor</h1>
    <p>The Condition <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>is <dfn tabindex="-1">%Atomics.Condition%</dfn>.</li>
      <li>is the initial value of the <emu-val>"Condition"</emu-val> property of the <emu-xref href="#sec-atomics-object"><a href="https://tc39.es/ecma262/#sec-atomics-object">%Atomics%</a></emu-xref> object.</li>
      <li>creates and initializes a new Condition when called as <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>.</li>
      <li>is not intended to be called as a function and will throw an exception when called in that manner.</li>
    </ul>

    <emu-clause id="sec-atomics.condition">
      <h1><span class="secnum">5.5.1</span> Atomics.Condition ( )</h1>
      <p>This function performs the following steps when called:</p>
      <emu-alg><ol><li>If NewTarget is <emu-val>undefined</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>createInitializer</var> be a new <emu-xref href="#sec-abstract-closure"><a href="https://tc39.es/ecma262/#sec-abstract-closure">Abstract Closure</a></emu-xref> with parameters (<var>newCV</var>) that captures nothing and performs the following steps when called:<ol><li>Set <var>newCV</var>.<var class="field">[[ConditionWaiterList]]</var> to a new <emu-xref href="#sec-waiterlist-records"><a href="https://tc39.es/ecma262/#sec-waiterlist-records">WaiterList Record</a></emu-xref>.</li><li>Return <emu-const>unused</emu-const>.</li></ol></li><li>Return <emu-xref aoid="SharedStructCreate" id="_ref_205"><a href="#sec-sharedstructcreate">SharedStructCreate</a></emu-xref>(<var>createInitializer</var>, « <var class="field">[[ConditionWaiterList]]</var>&nbsp;»).</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>

  <emu-clause id="sec-properties-of-the-condition-constructor">
    <h1><span class="secnum">5.6</span> Properties of the Condition Constructor</h1>
    <p>The Condition <emu-xref href="#constructor"><a href="https://tc39.es/ecma262/#constructor">constructor</a></emu-xref>:</p>
    <ul>
      <li>has a <var class="field">[[Prototype]]</var> internal slot whose value is <emu-xref href="#sec-properties-of-the-function-prototype-object"><a href="https://tc39.es/ecma262/#sec-properties-of-the-function-prototype-object">%Function.prototype%</a></emu-xref>.</li>
      <li>has the following properties:</li>
    </ul>

    <emu-note><span class="note">Note</span><div class="note-contents">
      <p>Per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototypes, which is currently an open design question and not included in this draft, will give Conditions a per-<emu-xref href="#realm"><a href="https://tc39.es/ecma262/#realm">Realm</a></emu-xref> prototype with built-in methods instead of static methods.</p>
    </div></emu-note>

    <emu-clause id="sec-atomics.condition.wait">
      <h1><span class="secnum">5.6.1</span> Atomics.Condition.wait ( <var>cv</var>, <var>mutexUnlockToken</var> )</h1>
      <p>This function atomically unlocks <var>mutexUnlockToken</var> and puts the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> in a wait queue and suspends it until the condition variable is notified.</p>
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>cv</var>, <var class="field">[[ConditionWaiterList]]</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>mutexUnlockToken</var>, <var class="field">[[LockedMutex]]</var>).</li><li>Let <var>mutex</var> be <var>mutexUnlockToken</var>.<var class="field">[[LockedMutex]]</var>.</li><li>If <var>mutex</var> is <emu-const>empty</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <emu-xref aoid="AgentCanSuspend"><a href="https://tc39.es/ecma262/#sec-agentcansuspend">AgentCanSuspend</a></emu-xref>() is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>thisAgent</var> be <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>WL</var> be <var>cv</var>.<var class="field">[[ConditionWaiterList]]</var>.</li><li>Perform <emu-xref aoid="EnterCriticalSection"><a href="https://tc39.es/ecma262/#sec-entercriticalsection">EnterCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>waiterRecord</var> be a new <emu-xref href="#sec-waiter-record"><a href="https://tc39.es/ecma262/#sec-waiter-record">Waiter Record</a></emu-xref> { <var class="field">[[AgentSignifier]]</var>: <var>thisAgent</var>, <var class="field">[[PromiseCapability]]</var>: <emu-const>blocking</emu-const>, <var class="field">[[TimeoutTime]]</var>: +∞, <var class="field">[[Result]]</var>: <emu-val>"ok"</emu-val>&nbsp;}.</li><li>Perform <emu-xref aoid="AddWaiter"><a href="https://tc39.es/ecma262/#sec-addwaiter">AddWaiter</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>Perform <emu-xref aoid="UnlockMutex" id="_ref_206"><a href="#sec-unlockmutex">UnlockMutex</a></emu-xref>(<var>mutex</var>).</li><li>Perform <emu-xref aoid="SuspendThisAgent"><a href="https://tc39.es/ecma262/#sec-suspendthisagent">SuspendThisAgent</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>Perform <emu-xref aoid="LeaveCriticalSection"><a href="https://tc39.es/ecma262/#sec-leavecriticalsection">LeaveCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>lockResult</var> be <emu-xref aoid="LockMutex" id="_ref_207"><a href="#sec-lockmutex">LockMutex</a></emu-xref>(<var>mutex</var>, +∞).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>lockResult</var> is <emu-const>acquired</emu-const>.</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"ok"</emu-val>.</li><li>Return <emu-val>undefined</emu-val>.</li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.condition.waitFor">
      <h1><span class="secnum">5.6.2</span> Atomics.Condition.waitFor ( <var>cv</var>, <var>mutexUnlockToken</var>, <var>timeout</var> [ , <var>predicate</var> ] )</h1>
      <p>If <var>predicate</var> is <emu-val>undefined</emu-val>, this function atomically unlocks <var>mutexUnlockToken</var> and puts the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> in a wait queue and suspends it until the condition variable is notified or until the wait times out, returning <emu-val>true</emu-val> for the former and <emu-val>false</emu-val> for the latter.</p>
      <p>If a <var>predicate</var> is passed and calling it returns <emu-val>false</emu-val>, this function atomically unlocks <var>mutexUnlockToken</var> and puts the <emu-xref href="#surrounding-agent"><a href="https://tc39.es/ecma262/#surrounding-agent">surrounding agent</a></emu-xref> in a wait queue and suspends it until <var>predicate</var> returns <emu-val>true</emu-val>, or until the wait times out. Whenever <var>predicate</var> is executing, the lock on the underlying mutex of <var>mutexUnlockToken</var> is acquired. Returns return value of the final call to <var>predicate</var>.</p>
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>cv</var>, <var class="field">[[ConditionWaiterList]]</var>).</li><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>mutexUnlockToken</var>, <var class="field">[[LockedMutex]]</var>).</li><li>Let <var>mutex</var> be <var>mutexUnlockToken</var>.<var class="field">[[LockedMutex]]</var>.</li><li>If <var>mutex</var> is <emu-const>empty</emu-const>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>timeout</var> <emu-xref href="#sec-ecmascript-language-types-number-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-number-type">is not a Number</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>timeout</var> is either <emu-val>NaN</emu-val> or <emu-val>+∞</emu-val><sub>𝔽</sub>, let <var>tMillis</var> be +∞; else if <var>timeout</var> is <emu-val>-∞</emu-val><sub>𝔽</sub>, let <var>tMillis</var> be 0; else let <var>tMillis</var> be <emu-xref aoid="max"><a href="https://tc39.es/ecma262/#eqn-max">max</a></emu-xref>(<emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>timeout</var>), 0).</li><li>If <var>predicate</var> is not <emu-val>undefined</emu-val> and <emu-xref aoid="IsCallable"><a href="https://tc39.es/ecma262/#sec-iscallable">IsCallable</a></emu-xref>(<var>predicate</var>) is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <emu-xref aoid="AgentCanSuspend"><a href="https://tc39.es/ecma262/#sec-agentcansuspend">AgentCanSuspend</a></emu-xref>() is <emu-val>false</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>timeBeforeWaitLoop</var> be the <emu-xref href="#sec-time-values-and-time-range"><a href="https://tc39.es/ecma262/#sec-time-values-and-time-range">time value</a></emu-xref> (UTC) identifying the current time.</li><li>Let <var>additionalTimeout</var> be an <emu-xref href="#implementation-defined"><a href="https://tc39.es/ecma262/#implementation-defined">implementation-defined</a></emu-xref> non-negative <emu-xref href="#mathematical-value"><a href="https://tc39.es/ecma262/#mathematical-value">mathematical value</a></emu-xref>.</li><li>Let <var>timeoutTime</var> be <emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>timeBeforeWaitLoop</var>) + <var>tMillis</var> + <var>additionalTimeout</var>.</li><li>NOTE: When <var>tMillis</var> is +∞, <var>timeoutTime</var> is also +∞.</li><li>Let <var>thisAgent</var> be <emu-xref aoid="AgentSignifier"><a href="https://tc39.es/ecma262/#sec-agentsignifier">AgentSignifier</a></emu-xref>().</li><li>Let <var>WL</var> be <var>cv</var>.<var class="field">[[ConditionWaiterList]]</var>.</li><li>Let <var>satisfied</var> be <emu-val>false</emu-val>.</li><li>Repeat,<ol><li>If <var>predicate</var> is not <emu-val>undefined</emu-val>, then<ol><li>Set <var>satisfied</var> to <emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(? <emu-xref aoid="Call"><a href="https://tc39.es/ecma262/#sec-call" class="e-user-code">Call</a></emu-xref>(<var>predicate</var>, <emu-val>undefined</emu-val>)).</li></ol></li><li>If <var>satisfied</var> is <emu-val>true</emu-val>, return <emu-val>true</emu-val>.</li><li>Let <var>now</var> be the <emu-xref href="#sec-time-values-and-time-range"><a href="https://tc39.es/ecma262/#sec-time-values-and-time-range">time value</a></emu-xref> (UTC) identifying the current time.</li><li>If <var>now</var> ≥ <var>timeoutTime</var>, return <emu-val>false</emu-val>.</li><li>Perform <emu-xref aoid="EnterCriticalSection"><a href="https://tc39.es/ecma262/#sec-entercriticalsection">EnterCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>waiterRecord</var> be a new <emu-xref href="#sec-waiter-record"><a href="https://tc39.es/ecma262/#sec-waiter-record">Waiter Record</a></emu-xref> { <var class="field">[[AgentSignifier]]</var>: <var>thisAgent</var>, <var class="field">[[PromiseCapability]]</var>: <emu-const>blocking</emu-const>, <var class="field">[[TimeoutTime]]</var>: <var>timeoutTime</var>, <var class="field">[[Result]]</var>: <emu-val>"ok"</emu-val>&nbsp;}.</li><li>Perform <emu-xref aoid="AddWaiter"><a href="https://tc39.es/ecma262/#sec-addwaiter">AddWaiter</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>Perform <emu-xref aoid="UnlockMutex" id="_ref_208"><a href="#sec-unlockmutex">UnlockMutex</a></emu-xref>(<var>mutex</var>).</li><li>Perform <emu-xref aoid="SuspendThisAgent"><a href="https://tc39.es/ecma262/#sec-suspendthisagent">SuspendThisAgent</a></emu-xref>(<var>WL</var>, <var>waiterRecord</var>).</li><li>Perform <emu-xref aoid="LeaveCriticalSection"><a href="https://tc39.es/ecma262/#sec-leavecriticalsection">LeaveCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>lockResult</var> be <emu-xref aoid="LockMutex" id="_ref_209"><a href="#sec-lockmutex">LockMutex</a></emu-xref>(<var>mutex</var>, +∞).</li><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>lockResult</var> is <emu-const>acquired</emu-const>.</li><li>If <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"ok"</emu-val>, then<ol><li>Set <var>satisfied</var> to <emu-val>true</emu-val>.</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>waiterRecord</var>.<var class="field">[[Result]]</var> is <emu-val>"timed-out"</emu-val>.</li><li>Set <var>satisfied</var> to <emu-val>false</emu-val>.</li></ol></li></ol></li></ol></emu-alg>
    </emu-clause>

    <emu-clause id="sec-atomics.condition.notify">
      <h1><span class="secnum">5.6.3</span> Atomics.Condition.notify ( <var>cv</var> [ , <var>count</var> ] )</h1>
      <p>It performs the following steps when called:</p>
      <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>cv</var>, <var class="field">[[ConditionWaiterList]]</var>).</li><li>If <var>count</var> is <emu-val>undefined</emu-val>, set <var>count</var> to <emu-val>+∞</emu-val><sub>𝔽</sub>.</li><li>If <var>count</var> is not an <emu-xref href="#integral-number"><a href="https://tc39.es/ecma262/#integral-number">integral Number</a></emu-xref> or is not <emu-val>+∞</emu-val><sub>𝔽</sub>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>WL</var> be <var>cv</var>.<var class="field">[[ConditionWaiterList]]</var>.</li><li>Perform <emu-xref aoid="EnterCriticalSection"><a href="https://tc39.es/ecma262/#sec-entercriticalsection">EnterCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>S</var> be <emu-xref aoid="RemoveWaiters"><a href="https://tc39.es/ecma262/#sec-removewaiters">RemoveWaiters</a></emu-xref>(<var>WL</var>, <emu-xref aoid="ℝ"><a href="https://tc39.es/ecma262/#ℝ">ℝ</a></emu-xref>(<var>count</var>)).</li><li>For each element <var>W</var> of <var>S</var>, do<ol><li>Perform <emu-xref aoid="NotifyWaiter"><a href="https://tc39.es/ecma262/#sec-notifywaiter">NotifyWaiter</a></emu-xref>(<var>WL</var>, <var>W</var>).</li></ol></li><li>Perform <emu-xref aoid="LeaveCriticalSection"><a href="https://tc39.es/ecma262/#sec-leavecriticalsection">LeaveCriticalSection</a></emu-xref>(<var>WL</var>).</li><li>Let <var>n</var> be the number of elements in <var>S</var>.</li><li>Return <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>n</var>).</li></ol></emu-alg>
    </emu-clause>
  </emu-clause>
  </ins>
</emu-clause><emu-annex id="sec-copyright-and-software-license">
      <h1><span class="secnum">A</span> Copyright &amp; Software License</h1>
      
      <h2>Copyright Notice</h2>
      <p>© 2024 Shu-yu Guo</p>

      <h2>Software License</h2>
      <p>All Software contained in this document ("Software") is protected by copyright and is being made available under the "BSD License", included below. This Software may be subject to third party rights (rights from parties other than Ecma International), including patent rights, and no licenses under such third party rights are granted under this license even if the third party concerned is a member of Ecma International. SEE THE ECMA CODE OF CONDUCT IN PATENT MATTERS AVAILABLE AT <a href="https://ecma-international.org/memento/codeofconduct.htm">https://ecma-international.org/memento/codeofconduct.htm</a> FOR INFORMATION REGARDING THE LICENSING OF PATENT CLAIMS THAT ARE REQUIRED TO IMPLEMENT ECMA INTERNATIONAL STANDARDS.</p>

<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>

<ol>
  <li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
  <li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
  <li>Neither the name of the authors nor Ecma International may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ol>

<p>THIS SOFTWARE IS PROVIDED BY THE ECMA INTERNATIONAL "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL ECMA INTERNATIONAL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

    </emu-annex>
</div></body>